<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ENIGMA â€“ Laboratory Manager v11.0</title>
  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAABhUlEQVRYhe2XsU7DMBCGv0gMiIWBgQEJiYGFhYkn4AF4AJ6AZ2BhYWFgYGBgYGBgQEJiYGFhYGAA8QCMdJJxnThxYqdS+0mWZNu5+3N3vvgMGzZs+K8xAk6BZ+AbeBrLrCpCWRE7ALdAM0ReF+UywB1wLu7dAo1QoSbwFHgFroAjcRkiTQI8AE/AJbAvLl8VYSJhPQbugedx2C/Awdj9HXAK3I/fL4E9YAe4Bq6BO+BWlH0E9sVzW8AdcCPKPgNHwCGwA1wBV8A1cAvci7LPwBFwIOZnA9fAJXAHPIiyL8CRmN8WcA1ciPm9A6fAIbANXAAXwA3wIMq+AkfAgShzAlwA58ADcCrKvgFHYn4bcA6ci/k9AqfAIbAFnAPnwA3wKMq+A0dibhtwBpyJ+T0Bp8AhsAWcAWfADfAkyr4DR2JuG3AKnIr5PQOnwCGwBZwCp8AN8CzKvgNHYm4bcAKciPm9AGfAIbAJnAAn4/d34Aw4A86BF1H2HTgSc/8B/gH8b0ChWYgAAAAASUVORK5CYII=">
  <style>
    :root {
      --bg: #1a1510;
      --panel: rgba(30, 25, 20, 0.95);
      --panel2: rgba(40, 35, 28, 0.9);
      --text: #f5f0e8;
      --muted: #a09080;
      --accent: #d4a853;
      --accent-light: #f0d78c;
      --gold: #c9a227;
      --gold-light: #e8d48b;
      --success: #7cb342;
      --danger: #d84315;
      --line: rgba(212,168,83,0.15);
      --chip: rgba(212,168,83,0.2);
      --glow: 0 0 30px rgba(212,168,83,0.4);
      color-scheme: dark;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    /* Hide scrollbar flicker */
    html {
      overflow-y: scroll;
      scrollbar-width: thin;
      scrollbar-color: var(--accent) transparent;
    }
    
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--gold-light);
    }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: 
        linear-gradient(180deg, rgba(26,21,16,0.75) 0%, rgba(15,13,10,0.80) 50%, rgba(26,21,16,0.75) 100%),
        url('data:image/jpeg;base64,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') center center / cover no-repeat fixed;
      background-color: #1a1510;
      background-attachment: fixed;
      min-height: 100vh;
      color: var(--text);
      line-height: 1.5;
    }

    /* Background overlay removed - using image background */

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px 24px 60px;
      position: relative;
      z-index: 1;
    }

    /* Header */
    header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 16px 24px;
      margin-bottom: 24px;
      background: linear-gradient(135deg, rgba(30,25,20,0.98), rgba(40,35,28,0.95));
      border: 1px solid var(--line);
      border-radius: 16px;
      box-shadow: var(--glow), 0 4px 20px rgba(0,0,0,0.3);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .brand-logo {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      border: 2px solid var(--accent);
      box-shadow: var(--glow);
      background: linear-gradient(135deg, #2a2520, #1a1510);
      padding: 4px;
    }

    .brand h1 {
      font-size: 2rem;
      font-weight: 300;
      color: var(--accent);
      letter-spacing: 8px;
      text-shadow: 0 0 40px rgba(212,168,83,0.6);
      font-family: 'Times New Roman', serif;
    }

    .brand p {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 2px;
      letter-spacing: 2px;
      text-transform: uppercase;
    }

    .header-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    .sync-indicator {
      font-size: 1.2rem;
      padding: 8px;
      border-radius: 8px;
      cursor: help;
      transition: all 0.3s;
    }
    
    .sync-indicator.syncing {
      animation: spin 1s linear infinite;
    }
    
    .sync-indicator.synced {
      color: var(--success);
    }
    
    .sync-indicator.error {
      color: var(--danger);
    }
    
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Buttons */
    .btn {
      padding: 10px 18px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.04);
      color: var(--text);
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn:hover { background: rgba(255,255,255,0.08); }
    .btn:active { transform: scale(0.98); }

    .btn.primary {
      background: rgba(212,168,83,0.2);
      border-color: rgba(212,168,83,0.4);
      color: var(--accent-light);
    }

    .btn.success {
      background: rgba(34,197,94,0.15);
      border-color: rgba(34,197,94,0.35);
      color: #4ade80;
    }

    .btn.danger {
      background: rgba(239,68,68,0.12);
      border-color: rgba(239,68,68,0.3);
      color: #f87171;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 24px;
    }

    .tab {
      padding: 12px 20px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.03);
      color: var(--text);
      border-radius: 999px;
      cursor: pointer;
      font-weight: 700;
      font-size: 0.95rem;
      transition: all 0.2s;
    }

    .tab:hover { border-color: rgba(212,168,83,0.3); }

    .tab.active {
      border-color: rgba(212,168,83,0.5);
      background: rgba(212,168,83,0.12);
      color: var(--accent-light);
    }

    /* Grid Layout */
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    @media (max-width: 900px) {
      .grid { grid-template-columns: 1fr; }
    }

    /* Cards */
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.25);
    }

    .card h2 {
      font-size: 1.2rem;
      margin-bottom: 16px;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Forms */
    .field {
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-width: 150px;
      flex: 1;
    }

    label {
      font-size: 0.8rem;
      color: var(--muted);
      font-weight: 600;
    }

    input, select, textarea {
      width: 100%;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--line);
      color: var(--text);
      border-radius: 10px;
      padding: 10px 14px;
      font-size: 0.95rem;
      outline: none;
      transition: border-color 0.2s;
    }

    input:focus, select:focus, textarea:focus {
      border-color: var(--accent);
    }

    textarea { min-height: 100px; resize: vertical; }

    select {
      background: rgba(18,22,31,0.95) !important;
      cursor: pointer;
    }

    select option {
      background: #12161f;
      color: var(--text);
    }

    .row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .row.between { justify-content: space-between; }

    /* Chips & Pills */
    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: var(--chip);
      font-size: 0.8rem;
      font-weight: 700;
      color: var(--accent-light);
    }

    .pill {
      padding: 6px 12px;
      border: 1px solid var(--line);
      border-radius: 999px;
      color: var(--muted);
      font-size: 0.85rem;
    }

    /* Stats */
    .stats {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin: 16px 0;
    }

    .stat {
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 12px 16px;
      min-width: 140px;
    }

    .stat .k {
      font-size: 0.75rem;
      color: var(--muted);
      font-weight: 700;
      margin-bottom: 4px;
    }

    .stat .v {
      font-size: 1.3rem;
      font-weight: 800;
    }

    /* Progress Bar */
    .bar {
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.08);
      overflow: hidden;
      border: 1px solid var(--line);
      margin-top: 6px;
    }

    .bar > div {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--success));
      transition: width 0.3s;
    }

    .bar.over > div {
      background: linear-gradient(90deg, var(--danger), #f97316);
    }

    /* Tables */
    .table-wrap {
      overflow-x: auto;
      margin-top: 16px;
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 8px;
    }

    th {
      text-align: right;
      font-size: 0.8rem;
      color: var(--muted);
      font-weight: 700;
      padding: 8px 12px;
    }

    .tr {
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
    }

    .tr td {
      padding: 12px;
      border-top: 1px solid var(--line);
      border-bottom: 1px solid var(--line);
    }

    .tr td:first-child {
      border-right: 1px solid var(--line);
      border-top-right-radius: 12px;
      border-bottom-right-radius: 12px;
    }

    .tr td:last-child {
      border-left: 1px solid var(--line);
      border-top-left-radius: 12px;
      border-bottom-left-radius: 12px;
    }

    /* Toggles */
    .toggles {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }

    .toggle-btn {
      padding: 8px 12px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.03);
      color: var(--muted);
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 600;
      transition: all 0.2s;
    }

    .toggle-btn.on {
      background: rgba(34,197,94,0.15);
      border-color: rgba(34,197,94,0.35);
      color: #4ade80;
    }

    /* Hr */
    .hr {
      height: 1px;
      background: var(--line);
      margin: 16px 0;
    }

    /* Text helpers */
    .muted { color: var(--muted); }
    .mono { font-family: ui-monospace, 'SF Mono', monospace; }
    .small { font-size: 0.8rem; color: var(--muted); }
    .warn { color: var(--danger); font-weight: 700; }
    .ok { color: var(--success); font-weight: 700; }
    .hidden { display: none !important; }

    /* Modals */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 1000;
    }

    .overlay.show { display: flex; }

    .modal {
      width: min(900px, 95vw);
      max-height: 85vh;
      overflow: auto;
      background: linear-gradient(180deg, rgba(18,22,31,0.98), rgba(10,13,20,0.98));
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      box-shadow: 0 25px 80px rgba(0,0,0,0.5);
      padding: 20px;
      margin: 10px;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-bottom: 16px;
      margin-bottom: 16px;
      border-bottom: 1px solid var(--line);
    }

    .modal-header h3 {
      font-size: 1.2rem;
      color: var(--accent);
    }

    .close-btn {
      background: none;
      border: none;
      color: var(--text);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 8px;
    }

    .close-btn:hover { background: rgba(255,255,255,0.1); }

    /* Full Page View */
    .fullpage {
      position: fixed;
      inset: 0;
      background: rgba(10,13,20,0.98);
      backdrop-filter: blur(8px);
      display: none;
      flex-direction: column;
      z-index: 2000;
      overflow: hidden;
    }

    .fullpage.show { display: flex; }

    .fullpage-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      background: rgba(18,22,31,0.9);
      border-bottom: 1px solid var(--line);
    }

    .fullpage-body {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    /* Category sections in formula */
    .cat-section {
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .cat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .cat-row {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 0;
      border-bottom: 1px dashed var(--line);
    }

    .cat-row:last-child { border-bottom: none; }

    .cat-row .name { flex: 2; font-weight: 600; min-width: 180px; }
    .cat-row .ml-col { width: 100px; }
    .cat-row .pct-col { width: 80px; text-align: center; }
    .cat-row .cost-col { width: 100px; text-align: left; }
    .cat-row .action-col { width: 80px; }

    /* Section title */
    .section-title {
      font-size: 0.95rem;
      color: var(--muted);
      font-weight: 800;
      margin: 20px 0 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Responsive */
    @media (max-width: 600px) {
      .container { padding: 12px; }
      header { flex-direction: column; text-align: center; }
      .brand h1 { font-size: 1.5rem; }
      .tabs { justify-content: center; flex-wrap: wrap; }
      .tab { flex: 1; text-align: center; min-width: 70px; padding: 8px 4px; font-size: 0.75rem; }
      .modal { 
        padding: 12px; 
        width: 95vw;
        max-height: 80vh;
        margin: 5px;
      }
      .modal .row {
        flex-direction: column;
        gap: 8px;
      }
      .modal .field {
        width: 100%;
      }
      .modal input, .modal select, .modal textarea {
        width: 100%;
        font-size: 16px; /* Prevents zoom on iOS */
      }
      .header-actions {
        justify-content: center;
      }
      .header-actions .btn {
        padding: 8px 10px;
        font-size: 0.8rem;
      }
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 4px; }

    /* Login Screen */
    .login-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }
    .login-overlay.hidden { display: none; }
    .login-box {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 40px;
      width: 90%;
      max-width: 360px;
      text-align: center;
    }
    .login-logo h1 {
      color: var(--accent-light);
      font-size: 2rem;
      margin: 16px 0 4px 0;
      letter-spacing: 4px;
    }
    .login-logo p {
      color: var(--muted);
      font-size: 0.9rem;
      margin: 0;
    }
    .login-form {
      margin-top: 32px;
      text-align: right;
    }
    .login-form .field {
      margin-bottom: 16px;
    }
    .login-form input {
      width: 100%;
      padding: 12px;
      font-size: 1rem;
      text-align: right;
    }
    .login-error {
      color: #f87171;
      font-size: 0.9rem;
      margin-top: 12px;
      min-height: 24px;
    }
    /* User badge in header */
    .user-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: rgba(212,168,83,0.15);
      border: 1px solid rgba(212,168,83,0.3);
      border-radius: 20px;
      font-size: 0.85rem;
      color: var(--accent-light);
    }
    .user-badge.guest {
      background: rgba(100,100,100,0.15);
      border-color: rgba(100,100,100,0.3);
      color: var(--muted);
    }
    /* Undo toast */
    .undo-toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--panel);
      border: 1px solid var(--accent);
      border-radius: 12px;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
      box-shadow: var(--glow);
      z-index: 9999;
      opacity: 0;
      transition: transform 0.3s, opacity 0.3s;
    }
    .undo-toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
    .undo-toast .undo-btn {
      background: var(--accent);
      color: var(--bg);
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
    }
    .undo-toast .undo-btn:hover {
      background: var(--accent-light);
    }
    /* Offline indicator */
    .offline-banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: var(--danger);
      color: white;
      text-align: center;
      padding: 8px;
      font-size: 0.9rem;
      z-index: 9999;
      transform: translateY(-100%);
      transition: transform 0.3s;
    }
    .offline-banner.show {
      transform: translateY(0);
    }
    /* Keyboard shortcuts help */
    .shortcuts-help {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 16px;
      font-size: 0.85rem;
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s, visibility 0.2s;
    }
    .shortcuts-help.show {
      opacity: 1;
      visibility: visible;
    }
    .shortcuts-help kbd {
      background: rgba(255,255,255,0.1);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
    }
    /* Print button in fullpage */
    .print-btn {
      background: var(--panel2);
      border: 1px solid var(--line);
      color: var(--text);
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .print-btn:hover {
      background: var(--accent);
      color: var(--bg);
    }
    /* Print styles */
    @media print {
      body {
        background: white !important;
        color: black !important;
        font-size: 12pt;
      }
      .container, header, .tabs, .grid, .overlay, .login-overlay,
      .undo-toast, .offline-banner, .shortcuts-help, .fullpage-header button {
        display: none !important;
      }
      .fullpage {
        position: static !important;
        background: white !important;
        color: black !important;
        padding: 20px !important;
      }
      .fullpage.show {
        display: block !important;
      }
      .fullpage-body {
        max-height: none !important;
        overflow: visible !important;
      }
      .card, .cat-section {
        background: white !important;
        border: 1px solid #ccc !important;
        box-shadow: none !important;
        page-break-inside: avoid;
      }
      .chip {
        background: #eee !important;
        color: black !important;
        border: 1px solid #ccc !important;
      }
      .stats {
        border: 1px solid #ccc !important;
        background: #f9f9f9 !important;
      }
      .stat {
        border-color: #ccc !important;
      }
      .cat-row {
        border-bottom: 1px solid #eee !important;
      }
      * {
        color: black !important;
      }
    }

    /* ==================== WIZARD STYLES V10 ==================== */
    .wizard-container { max-width: 900px; margin: 0 auto; }
    .wizard-progress { display: flex; justify-content: space-between; margin-bottom: 24px; flex-wrap: wrap; gap: 8px; }
    .wizard-step { display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 20px; background: var(--panel2); opacity: 0.5; transition: all 0.3s; font-size: 0.85rem; }
    .wizard-step.active { opacity: 1; background: linear-gradient(135deg, var(--accent), var(--gold)); color: var(--bg); font-weight: 600; }
    .wizard-step.completed { opacity: 0.8; background: var(--success); color: white; }
    .wizard-step-num { width: 20px; height: 20px; border-radius: 50%; background: rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; font-size: 0.75rem; }
    .wizard-content { background: var(--panel); border-radius: 12px; padding: 24px; border: 1px solid var(--line); }
    .wizard-title { font-size: 1.3rem; color: var(--accent); margin-bottom: 20px; }
    .preference-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 20px; }
    .preference-group { background: var(--panel2); padding: 14px; border-radius: 8px; border: 1px solid var(--line); }
    .preference-group h4 { color: var(--accent); margin-bottom: 10px; font-size: 0.9rem; }
    .preference-options { display: flex; flex-wrap: wrap; gap: 6px; }
    .pref-btn { padding: 6px 12px; border: 1px solid var(--line); border-radius: 16px; background: var(--panel); color: var(--text); cursor: pointer; transition: all 0.2s; font-size: 0.85rem; }
    .pref-btn:hover { border-color: var(--accent); background: rgba(212,168,83,0.1); }
    .pref-btn.selected { background: linear-gradient(135deg, var(--accent), var(--gold)); color: var(--bg); border-color: var(--accent); font-weight: 600; }
    .material-picker { display: flex; flex-direction: column; gap: 10px; max-height: 320px; overflow-y: auto; padding-left: 8px; }
    .material-item { background: var(--panel2); border: 1px solid var(--line); border-radius: 8px; padding: 12px; transition: all 0.2s; }
    .material-item:hover { border-color: var(--accent); }
    .material-item.selected { border-color: var(--success); background: rgba(124,179,66,0.1); }
    .material-item.incompatible { opacity: 0.4; border-color: var(--danger); }
    .material-header { display: flex; justify-content: space-between; align-items: center; }
    .material-name { font-weight: 600; color: var(--accent-light); display: flex; align-items: center; gap: 8px; cursor: pointer; }
    .material-checkbox { width: 18px; height: 18px; accent-color: var(--success); }
    .material-desc { font-size: 0.8rem; color: var(--muted); margin-top: 4px; }
    .material-synergy { font-size: 0.75rem; color: var(--success); margin-top: 4px; }
    .material-warning { font-size: 0.75rem; color: var(--danger); margin-top: 4px; }
    .material-slider-row { display: flex; align-items: center; gap: 10px; margin-top: 8px; }
    .material-slider { flex: 1; height: 6px; -webkit-appearance: none; background: var(--line); border-radius: 3px; }
    .material-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; border-radius: 50%; background: var(--accent); cursor: pointer; }
    .material-ml { min-width: 50px; text-align: left; font-weight: 600; color: var(--accent); font-size: 0.9rem; }
    .percent-hint { font-size: 0.7rem; color: var(--muted); }
    .wizard-summary { background: var(--panel2); border-radius: 8px; padding: 14px; margin-top: 16px; border: 1px solid var(--line); }
    .wizard-summary h4 { color: var(--accent); margin-bottom: 10px; font-size: 0.95rem; }
    .summary-row { display: flex; justify-content: space-between; padding: 4px 0; font-size: 0.9rem; border-bottom: 1px solid var(--line); }
    .summary-row:last-child { border-bottom: none; }
    .summary-total { font-weight: 700; color: var(--success); font-size: 1rem; margin-top: 8px; padding-top: 8px; border-top: 2px solid var(--accent); }
    .wizard-nav { display: flex; justify-content: space-between; margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--line); }
    .fixatives-auto { background: linear-gradient(135deg, rgba(212,168,83,0.1), rgba(124,179,66,0.1)); border: 1px dashed var(--accent); border-radius: 8px; padding: 14px; margin-top: 16px; }
    .fixatives-auto h4 { color: var(--accent); margin-bottom: 10px; font-size: 0.95rem; }
    .fixative-row { display: flex; justify-content: space-between; padding: 6px 0; font-size: 0.9rem; border-bottom: 1px solid var(--line); }
    .fixative-row:last-child { border-bottom: none; }
    .fixative-name { color: var(--muted); }
    .fixative-value { font-weight: 600; color: var(--accent); }
    .final-actions { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
    .final-actions .btn { flex: 1; min-width: 120px; padding: 12px 16px; }
    .wizard-formula-preview { background: var(--bg); border: 1px solid var(--line); border-radius: 8px; padding: 14px; font-family: monospace; font-size: 0.8rem; white-space: pre-wrap; max-height: 250px; overflow-y: auto; margin-top: 12px; }
    .no-materials-msg { text-align: center; padding: 40px; color: var(--muted); }

    /* Category Guidelines */
    .category-guide { background: linear-gradient(135deg, rgba(212,168,83,0.08), rgba(212,168,83,0.02)); border: 1px solid var(--line); border-radius: 8px; padding: 12px; margin-bottom: 16px; }
    .category-guide h4 { color: var(--accent); margin-bottom: 8px; font-size: 0.9rem; display: flex; align-items: center; gap: 6px; }
    .category-guide table { width: 100%; font-size: 0.8rem; border-collapse: collapse; }
    .category-guide td { padding: 4px 8px; border-bottom: 1px solid var(--line); }
    .category-guide td:first-child { color: var(--accent); font-weight: 600; width: 60px; }
    .category-guide td:nth-child(2) { color: var(--muted); width: 80px; }
    .category-guide tr:last-child td { border-bottom: none; }
    .category-guide .tip { margin-top: 8px; padding: 6px 10px; background: rgba(124,179,66,0.15); border-radius: 6px; font-size: 0.75rem; color: var(--success); }
    .guide-toggle { cursor: pointer; user-select: none; }
    .guide-toggle::after { content: ' â–¼'; font-size: 0.7rem; }
    .guide-toggle.collapsed::after { content: ' â–¶'; }
    .guide-content { overflow: hidden; transition: max-height 0.3s; }
    .guide-content.collapsed { max-height: 0 !important; }

    /* Scent Profile */
    .scent-profile-panel { background: var(--panel2); border-radius: 8px; padding: 14px; margin-top: 16px; border: 1px solid var(--line); }
    .scent-profile-panel h4 { color: var(--accent); margin-bottom: 12px; font-size: 0.9rem; }
    .scent-bars { display: flex; flex-direction: column; gap: 6px; }
    .scent-bar { display: flex; align-items: center; gap: 8px; font-size: 0.8rem; }
    .scent-label { width: 70px; color: var(--muted); }
    .scent-track { flex: 1; height: 8px; background: var(--line); border-radius: 4px; overflow: hidden; }
    .scent-fill { height: 100%; border-radius: 4px; transition: width 0.3s; }
    .scent-fill.floral { background: #e91e63; }
    .scent-fill.woody { background: #795548; }
    .scent-fill.fresh { background: #4caf50; }
    .scent-fill.sweet { background: #ff9800; }
    .scent-fill.spicy { background: #f44336; }
    .scent-fill.powdery { background: #9c27b0; }
    .scent-fill.musky { background: #607d8b; }
    .scent-fill.oriental { background: #ff5722; }
    .scent-percent { width: 35px; text-align: left; color: var(--accent); font-weight: 600; }
    .scent-description { margin-top: 10px; padding: 8px; background: rgba(212,168,83,0.1); border-radius: 6px; font-size: 0.85rem; color: var(--accent-light); text-align: center; }

    /* Material Effect */
    .material-effect { font-size: 0.75rem; color: var(--accent-light); margin-top: 6px; padding: 6px 8px; background: rgba(212,168,83,0.1); border-radius: 4px; font-style: italic; }

    /* Progress Bar */
    .formula-progress { background: var(--panel2); border-radius: 8px; padding: 14px; margin-top: 16px; border: 1px solid var(--line); }
    .formula-progress .progress-label { color: var(--accent); font-size: 0.85rem; margin-bottom: 8px; font-weight: 600; }
    .progress-bar-container { height: 24px; background: var(--bg); border-radius: 12px; overflow: hidden; display: flex; border: 1px solid var(--line); }
    .progress-segment { height: 100%; transition: width 0.3s ease; }
    .progress-segment.concentrates { background: linear-gradient(90deg, #e74c3c, #c0392b); }
    .progress-segment.oils { background: linear-gradient(90deg, #27ae60, #1e8449); }
    .progress-segment.aromachems { background: linear-gradient(90deg, #f1c40f, #d4ac0d); }
    .progress-segment.fixatives { background: linear-gradient(90deg, #9b59b6, #7d3c98); }
    .progress-segment.alcohol { background: linear-gradient(90deg, #3498db, #2980b9); }
    .progress-legend { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; justify-content: center; }
    .legend-item { display: flex; align-items: center; gap: 4px; font-size: 0.75rem; color: var(--muted); }
    .legend-dot { width: 10px; height: 10px; border-radius: 2px; }
    .legend-dot.conc { background: #e74c3c; }
    .legend-dot.oils { background: #27ae60; }
    .legend-dot.aroma { background: #f1c40f; }
    .legend-dot.fix { background: #9b59b6; }
    .legend-dot.alc { background: #3498db; }

    /* Compatible Materials */
    .compatible-materials { font-size: 0.75rem; color: var(--muted); margin-top: 4px; }
    .compat-label { color: var(--success); }
    .compat-list { color: var(--text); opacity: 0.8; }

    /* V10: Intensity Buttons */
    .intensity-selector { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 8px; }
    .intensity-btn { padding: 4px 8px; font-size: 0.7rem; border: 1px solid var(--line); border-radius: 12px; background: var(--panel); color: var(--muted); cursor: pointer; transition: all 0.2s; }
    .intensity-btn:hover { border-color: var(--accent); color: var(--text); }
    .intensity-btn.active { background: var(--accent); color: var(--bg); border-color: var(--accent); }
    .manual-slider-label { font-size: 0.7rem; color: var(--muted); margin-top: 6px; }

    /* V10: Recommendation Banner */
    .recommendation-banner { display: flex; align-items: center; gap: 10px; padding: 10px 14px; background: linear-gradient(90deg, rgba(124,179,66,0.15), rgba(212,168,83,0.1)); border-radius: 8px; margin-bottom: 12px; border: 1px solid rgba(124,179,66,0.3); }
    .rec-icon { font-size: 1.2rem; }
    .rec-text { flex: 1; font-size: 0.85rem; color: var(--text); }
    .rec-current { font-weight: 600; color: var(--accent); font-size: 0.85rem; padding: 4px 10px; background: var(--panel2); border-radius: 12px; }
    .rec-current.warning { color: var(--danger); background: rgba(216,67,21,0.2); }
    .rec-current.good { color: var(--success); background: rgba(124,179,66,0.2); }

    /* V10: Concentration Warning */
    .concentration-warning { padding: 12px; background: rgba(216,67,21,0.15); border: 1px solid var(--danger); border-radius: 8px; margin-top: 12px; }
    .concentration-warning .warning-icon { font-size: 1.2rem; }
    .concentration-warning .warning-text { color: var(--danger); font-weight: 600; }
    .concentration-warning .warning-tip { color: var(--muted); font-size: 0.8rem; margin-top: 4px; }

    /* V10: Pairing Suggestions */
    .pairing-suggestions { background: var(--panel2); border-radius: 8px; padding: 12px; margin-top: 12px; border: 1px solid var(--line); }
    .pairing-suggestions h4 { color: var(--accent); font-size: 0.85rem; margin-bottom: 10px; }
    .suggestion-chips { display: flex; flex-wrap: wrap; gap: 8px; }
    .suggestion-chip { display: flex; align-items: center; gap: 6px; padding: 6px 10px; background: var(--panel); border: 1px solid var(--line); border-radius: 16px; font-size: 0.75rem; }
    .suggestion-chip:hover { border-color: var(--accent); }
    .chip-name { color: var(--accent-light); font-weight: 600; }
    .chip-add { padding: 2px 6px; background: var(--success); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 0.7rem; }
    .chip-add:hover { filter: brightness(1.1); }

    /* V10: Secret Concentrate Display */
    .material-code { font-weight: 700; color: var(--gold); }

  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <svg class="brand-logo" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="dropGrad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#d4a853"/>
              <stop offset="100%" style="stop-color:#8b7355"/>
            </linearGradient>
          </defs>
          <path d="M32 4C32 4 16 24 16 40C16 48.8 23.2 56 32 56C40.8 56 48 48.8 48 40C48 24 32 4 32 4Z" 
                stroke="url(#dropGrad)" stroke-width="2" fill="none"/>
          <path d="M32 16C32 16 24 28 24 36C24 40.4 27.6 44 32 44C36.4 44 40 40.4 40 36C40 28 32 16 32 16Z" 
                stroke="url(#dropGrad)" stroke-width="1.5" fill="none" opacity="0.6"/>
          <ellipse cx="32" cy="52" rx="4" ry="2" stroke="url(#dropGrad)" stroke-width="1.5" fill="none"/>
        </svg>
        <div>
          <h1>ENIGMA</h1>
          <p>Mystery in Every Drop</p>
        </div>
      </div>
      <div class="header-actions">
        <span id="userBadge" class="user-badge">ðŸ‘¤ Admin</span>
        <span id="syncIndicator" class="sync-indicator" title="×ž×¦×‘ ×¡× ×›×¨×•×Ÿ">ðŸ’¾</span>
        <button class="btn" id="btnExport">ðŸ“¤ ×™×™×¦×•×</button>
        <button class="btn" id="btnImportMenu">ðŸ“¥ ×™×™×‘×•×</button>
        <button class="btn" id="btnSaveCloud">â˜ï¸ ×©×ž×•×¨</button>
        <button class="btn" id="btnLoadCloud">â˜ï¸ ×˜×¢×Ÿ</button>
        <button class="btn" id="btnLogout">ðŸšª ×™×¦×™××”</button>
      </div>
      <input type="file" id="importFile" accept=".json" style="display:none">
      <input type="file" id="importFormulasFile" accept=".json" style="display:none">
      <input type="file" id="importMaterialsFile" accept=".json" style="display:none">
    </header>

    <div class="tabs" id="tabs">
      <div class="tab active" data-tab="materials">ðŸ“¦ ×—×•×ž×¨×™ ×’×œ×</div>
      <div class="tab" data-tab="dev">ðŸ§ª ×¤×™×ª×•×—×™×</div>
      <div class="tab" data-tab="final">âœ¨ ×‘×©×ž×™× ×¡×•×¤×™×™×</div>
      <div class="tab" data-tab="pricing">ðŸ’° ×ª×ž×—×•×¨</div>
      <div class="tab" data-tab="wizard">ðŸ§™ ××©×£ ×‘× ×™×™×”</div>
      <div class="tab" data-tab="candle">ðŸ”„ ×”×ž×¨×•×ª</div>
      <div class="tab" data-tab="aibuilder">ðŸ”® ×‘× ×” ×œ×¤×™ ×”×©×¨××”</div>
      <div class="tab" data-tab="settings">âš™ï¸ ×”×’×“×¨×•×ª</div>
    </div>

    <div class="grid">
      <div class="card" id="leftPanel"></div>
      <div class="card" id="rightPanel"></div>
    </div>
  </div>

  <!-- Modal -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 id="modalTitle">×—×œ×•×Ÿ</h3>
        <button class="close-btn" id="modalClose">Ã—</button>
      </div>
      <div id="modalBody"></div>
    </div>
  </div>

  <!-- Full Page View -->
  <div class="fullpage" id="fullpage">
    <div class="fullpage-header">
      <button class="btn" id="fpClose">âœ• ×¡×’×•×¨</button>
      <button class="print-btn" id="fpPrint" onclick="window.print()">ðŸ–¨ï¸ ×”×“×¤×¡</button>
      <h3 id="fpTitle">×¦×¤×™×™×”</h3>
      <div class="pill" id="fpPill"></div>
    </div>
    <div class="fullpage-body" id="fpBody"></div>
  </div>

  <!-- Login Screen -->
  <div class="login-overlay" id="loginOverlay">
    <div class="login-box">
      <div class="login-logo">
        <svg viewBox="0 0 100 100" width="80" height="80">
          <defs>
            <linearGradient id="loginGold" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#D4A853"/>
              <stop offset="50%" style="stop-color:#F4D58D"/>
              <stop offset="100%" style="stop-color:#BF8A30"/>
            </linearGradient>
          </defs>
          <circle cx="50" cy="50" r="45" fill="none" stroke="url(#loginGold)" stroke-width="2"/>
          <text x="50" y="58" text-anchor="middle" fill="url(#loginGold)" font-size="28" font-weight="bold" font-family="serif">E</text>
        </svg>
        <h1>ENIGMA</h1>
        <p>Parfume Manager</p>
      </div>
      <div class="login-form">
        <div class="field">
          <label>×©× ×ž×©×ª×ž×©</label>
          <input type="text" id="loginUser" placeholder="×”×›× ×¡ ×©× ×ž×©×ª×ž×©" autocomplete="username">
        </div>
        <div class="field">
          <label>×¡×™×¡×ž×”</label>
          <input type="password" id="loginPass" placeholder="×”×›× ×¡ ×¡×™×¡×ž×”" autocomplete="current-password">
        </div>
        <button class="btn primary" id="loginBtn" style="width:100%;padding:14px;font-size:1.1rem;margin-top:12px">
          ðŸ” ×”×ª×—×‘×¨
        </button>
        <div id="loginError" class="login-error"></div>
      </div>
    </div>
  </div>

  <!-- Offline indicator -->
  <div class="offline-banner" id="offlineBanner">
    âš ï¸ ××™×Ÿ ×—×™×‘×•×¨ ×œ××™× ×˜×¨× ×˜ - ×¢×•×‘×“ ×‘×ž×¦×‘ ×œ× ×ž×§×•×•×Ÿ
  </div>

  <!-- Undo toast -->
  <div class="undo-toast" id="undoToast">
    <span id="undoMessage">×”×¤×¢×•×œ×” ×‘×•×˜×œ×”</span>
    <button class="undo-btn" id="undoBtn">â†©ï¸ ×‘×˜×œ</button>
    <button class="btn" id="undoDismiss" style="padding:4px 8px">âœ•</button>
  </div>

  <!-- Keyboard shortcuts help -->
  <div class="shortcuts-help" id="shortcutsHelp">
    <div style="font-weight:700;margin-bottom:8px;color:var(--accent)">âŒ¨ï¸ ×§×™×¦×•×¨×™ ×ž×§×œ×“×ª</div>
    <div><kbd>Ctrl+S</kbd> ×©×ž×•×¨ ×œ×¢× ×Ÿ</div>
    <div><kbd>Ctrl+Z</kbd> ×‘×˜×œ ×¤×¢×•×œ×” ××—×¨×•× ×”</div>
    <div><kbd>Ctrl+N</kbd> ×¤×•×¨×ž×•×œ×” ×—×“×©×”</div>
    <div><kbd>Ctrl+E</kbd> ×™×™×¦×•×</div>
    <div><kbd>?</kbd> ×”×¦×’/×”×¡×ª×¨ ×¢×–×¨×” ×–×•</div>
    <div><kbd>Esc</kbd> ×¡×’×•×¨ ×—×œ×•×Ÿ</div>
  </div>

<script>
(() => {
  "use strict";

  // Utilities
  const uid = () => Math.random().toString(36).slice(2,10) + Date.now().toString(36);
  const clamp = (n, min, max) => Math.min(max, Math.max(min, n));
  const num = (v, d = 0) => {
    const n = Number(String(v).replace(",", "."));
    return Number.isFinite(n) ? n : d;
  };
  const fmt = (n, d = 2) => {
    const rounded = Math.round((num(n, 0) + Number.EPSILON) * Math.pow(10, d)) / Math.pow(10, d);
    return rounded.toLocaleString("he-IL", { maximumFractionDigits: d });
  };
  const todayISO = () => new Date().toISOString().slice(0, 10);
  const escapeHtml = (s) => String(s ?? "").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");

  // Categories
  const CATEGORIES = ["×ª×ž×¦×™×•×ª", "×©×ž× ×™×", "××¨×•×ž×›×™×ž×™×§×œ×™×", "×§×‘×•×¢×™×", "×ª×•×¡×¤×•×ª"];

  // ==================== WIZARD DATA V10 ====================
  const WIZARD_DATA = {
    categories: {
      floral: { nameHe: "×¤×¨×—×•× ×™", concentrates: ["MAT_00021", "MAT_00020", "MAT_00029", "MAT_00014", "MAT_00011", "MAT_00017", "MAT_00018", "MAT_00023"], oils: ["MAT_00060", "MAT_00074", "MAT_00058", "MAT_00043"], aromachems: ["MAT_00118", "MAT_00087", "MAT_00080", "MAT_00092", "MAT_00116"] },
      woody: { nameHe: "×¢×¦×™", concentrates: ["MAT_00008", "MAT_00022", "MAT_00026", "MAT_00006"], oils: ["MAT_00058", "MAT_00036", "MAT_00059", "MAT_00053"], aromachems: ["MAT_00091", "MAT_00094", "MAT_ISO"] },
      fresh: { nameHe: "×¨×¢× ×Ÿ/×¦×™×˜×¨×•×¡×™", concentrates: ["MAT_00010", "MAT_00015", "MAT_00012", "MAT_00013"], oils: ["MAT_00069", "MAT_00046", "MAT_00065", "MAT_00034", "MAT_00070"], aromachems: ["MAT_00087", "MAT_00100", "MAT_00113"] },
      gourmand: { nameHe: "×’×•×¨×ž× ×“", concentrates: ["MAT_00019", "MAT_00009", "MAT_00024", "MAT_00028"], oils: ["MAT_00031", "MAT_00058"], aromachems: ["MAT_00089", "MAT_00088", "MAT_00081", "MAT_00098", "MAT_00099"] },
      oriental: { nameHe: "×ž×–×¨×—×™", concentrates: ["MAT_00022", "MAT_00008", "MAT_00028", "MAT_00027"], oils: ["MAT_00041", "MAT_00031", "MAT_00049", "MAT_00058"], aromachems: ["MAT_00122", "MAT_00091", "MAT_00087"] },
      oud: { nameHe: "××•×“", concentrates: ["MAT_00022"], oils: ["MAT_00041", "MAT_00031", "MAT_00058", "MAT_00035"], aromachems: ["MAT_00122", "MAT_00121", "MAT_00123", "MAT_00124", "MAT_00118"] }
    },
    intensity: {
      light: { label: "×§×œ (×™×•× ×™×•×)", concentrateRange: [6, 10], isoE: 5, description: "×‘×•×©× ×¢×“×™×Ÿ" },
      medium: { label: "×‘×™× ×•× ×™ (×¨×‘ ×©×™×ž×•×©×™)", concentrateRange: [10, 14], isoE: 6, description: "×‘×•×©× ×ž××•×–×Ÿ" },
      strong: { label: "×—×–×§ (×¢×¨×‘)", concentrateRange: [14, 18], isoE: 7, description: "×‘×•×©× ×¢×•×¦×ž×ª×™" }
    },
    compatibility: {
      "MAT_00020": { pairsWith: ["MAT_00118", "MAT_00025", "MAT_00087", "MAT_00058", "MAT_00080"], avoidWith: [] },
      "MAT_00021": { pairsWith: ["MAT_00081", "MAT_00025", "MAT_00091", "MAT_00080"], avoidWith: [] },
      "MAT_00022": { pairsWith: ["MAT_00122", "MAT_00041", "MAT_00031", "MAT_00087", "MAT_ISO"], avoidWith: [] },
      "MAT_00014": { pairsWith: ["MAT_00053", "MAT_00118", "MAT_00087", "MAT_00081"], avoidWith: [] },
      "MAT_00019": { pairsWith: ["MAT_00088", "MAT_00089", "MAT_00081", "MAT_00031", "MAT_00091", "MAT_00098"], avoidWith: [] },
      "MAT_00010": { pairsWith: ["MAT_00069", "MAT_00087", "MAT_00059"], avoidWith: ["MAT_00122"] },
      "MAT_00008": { pairsWith: ["MAT_00058", "MAT_00031", "MAT_00081", "MAT_00091"], avoidWith: [] },
      "MAT_00011": { pairsWith: ["MAT_00118", "MAT_00060", "MAT_00087"], avoidWith: [] },
      "MAT_00027": { pairsWith: ["MAT_00045", "MAT_00088", "MAT_00087"], avoidWith: [] },
      "MAT_00029": { pairsWith: ["MAT_00025", "MAT_00089", "MAT_00118", "MAT_00080"], avoidWith: [] },
      "MAT_00006": { pairsWith: ["MAT_ISO", "MAT_00058", "MAT_00087"], avoidWith: [] },
      "MAT_00013": { pairsWith: ["MAT_00069", "MAT_00088", "MAT_00025"], avoidWith: [] },
      "MAT_00012": { pairsWith: ["MAT_00069", "MAT_00091", "MAT_00025"], avoidWith: [] },
      "MAT_00058": { pairsWith: ["MAT_00118", "MAT_00088", "MAT_00060", "MAT_00122"], avoidWith: [] },
      "MAT_00069": { pairsWith: ["MAT_00087", "MAT_00046", "MAT_00055"], avoidWith: [] },
      "MAT_00053": { pairsWith: ["MAT_00088", "MAT_00118", "MAT_00031"], avoidWith: [] },
      "MAT_00041": { pairsWith: ["MAT_00049", "MAT_00122", "MAT_00031"], avoidWith: [] },
      "MAT_00031": { pairsWith: ["MAT_00088", "MAT_00041", "MAT_00058", "MAT_00081"], avoidWith: [] },
      "MAT_00060": { pairsWith: ["MAT_00058", "MAT_00087", "MAT_00118"], avoidWith: [] },
      "MAT_00035": { pairsWith: ["MAT_00118", "MAT_00122", "MAT_00058"], avoidWith: [] },
      "MAT_00059": { pairsWith: ["MAT_00069", "MAT_00036", "MAT_ISO"], avoidWith: [] },
      "MAT_00087": { pairsWith: ["MAT_00069", "MAT_00118", "MAT_00060"], avoidWith: [] },
      "MAT_00118": { pairsWith: ["MAT_00058", "MAT_00122", "MAT_00087", "MAT_00020"], avoidWith: [] },
      "MAT_00122": { pairsWith: ["MAT_00118", "MAT_00041", "MAT_00058"], avoidWith: ["MAT_00069"] },
      "MAT_00088": { pairsWith: ["MAT_00081", "MAT_00031", "MAT_00053", "MAT_00019"], avoidWith: [] },
      "MAT_00089": { pairsWith: ["MAT_00088", "MAT_00081", "MAT_00098", "MAT_00019"], avoidWith: [] },
      "MAT_00081": { pairsWith: ["MAT_00088", "MAT_00089", "MAT_00091", "MAT_00019"], avoidWith: [] },
      "MAT_00091": { pairsWith: ["MAT_00058", "MAT_00081", "MAT_ISO", "MAT_00008"], avoidWith: [] },
      "MAT_00080": { pairsWith: ["MAT_00118", "MAT_00021", "MAT_00087", "MAT_00020"], avoidWith: [] },
      "MAT_00017": { pairsWith: ["MAT_00118", "MAT_00087", "MAT_00060", "MAT_00080", "MAT_00058"], avoidWith: [] },
      "MAT_00018": { pairsWith: ["MAT_00087", "MAT_00118", "MAT_00069", "MAT_00060"], avoidWith: [] },
      "MAT_00023": { pairsWith: ["MAT_00087", "MAT_00118", "MAT_00060", "MAT_00069", "MAT_00058"], avoidWith: [] },
      "MAT_00015": { pairsWith: ["MAT_00069", "MAT_00087", "MAT_00046", "MAT_00070", "MAT_00065"], avoidWith: ["MAT_00122"] },
      "MAT_00026": { pairsWith: ["MAT_00091", "MAT_00058", "MAT_ISO", "MAT_00087", "MAT_00094"], avoidWith: [] },
      "MAT_00009": { pairsWith: ["MAT_00088", "MAT_00089", "MAT_00081", "MAT_00031", "MAT_00058"], avoidWith: [] },
      "MAT_00024": { pairsWith: ["MAT_00088", "MAT_00081", "MAT_00118", "MAT_00089"], avoidWith: [] },
      "MAT_00028": { pairsWith: ["MAT_00122", "MAT_00041", "MAT_00088", "MAT_00091", "MAT_00031"], avoidWith: [] }
    },
    maxMl: { "MAT_00076": 0.15, "MAT_00077": 0.15, "MAT_00078": 0.15, "MAT_00079": 0.25, "MAT_00080": 0.15, "MAT_00037": 0.25, "MAT_00038": 0.2, "MAT_00042": 0.25, "MAT_00045": 0.3, "MAT_00030": 0.1, "MAT_00089": 0.5 },
    defaultMax: { "×ª×ž×¦×™×•×ª": 12, "×©×ž× ×™×": 3, "××¨×•×ž×›×™×ž×™×§×œ×™×": 2 },
    scentTags: {
      "MAT_00020": { floral: 60, musky: 30, powdery: 10 }, "MAT_00021": { powdery: 50, floral: 30, musky: 20 },
      "MAT_00022": { oriental: 50, woody: 30, sweet: 20 }, "MAT_00014": { floral: 50, sweet: 30, powdery: 20 },
      "MAT_00019": { sweet: 70, powdery: 20, musky: 10 }, "MAT_00010": { fresh: 70, spicy: 20, woody: 10 },
      "MAT_00008": { woody: 50, powdery: 30, sweet: 20 }, "MAT_00011": { floral: 70, sweet: 20, fresh: 10 },
      "MAT_00027": { floral: 40, fresh: 30, sweet: 30 }, "MAT_00029": { floral: 50, sweet: 30, fresh: 20 },
      "MAT_00006": { musky: 60, woody: 30, fresh: 10 }, "MAT_00013": { fresh: 50, sweet: 30, musky: 20 },
      "MAT_00012": { fresh: 50, woody: 30, musky: 20 }, "MAT_00015": { fresh: 70, sweet: 20, floral: 10 },
      "MAT_00017": { floral: 50, sweet: 30, oriental: 20 }, "MAT_00018": { floral: 60, fresh: 25, woody: 15 },
      "MAT_00023": { floral: 50, fresh: 30, woody: 20 }, "MAT_00024": { sweet: 50, floral: 30, musky: 20 },
      "MAT_00025": { musky: 80, powdery: 15, fresh: 5 }, "MAT_00026": { woody: 60, spicy: 25, musky: 15 },
      "MAT_00028": { sweet: 50, oriental: 30, woody: 20 }, "MAT_00009": { sweet: 60, floral: 25, fresh: 15 },
      "MAT_00058": { woody: 70, sweet: 20, powdery: 10 }, "MAT_00069": { fresh: 80, floral: 15, spicy: 5 },
      "MAT_00053": { woody: 50, oriental: 30, sweet: 20 }, "MAT_00041": { oriental: 60, woody: 25, spicy: 15 },
      "MAT_00031": { sweet: 50, oriental: 30, woody: 20 }, "MAT_00060": { floral: 70, sweet: 20, oriental: 10 },
      "MAT_00036": { woody: 80, fresh: 15, spicy: 5 }, "MAT_00059": { woody: 50, fresh: 30, spicy: 20 },
      "MAT_00035": { spicy: 50, sweet: 30, oriental: 20 }, "MAT_00046": { fresh: 85, spicy: 10, floral: 5 },
      "MAT_00065": { fresh: 75, spicy: 15, sweet: 10 }, "MAT_00034": { fresh: 60, sweet: 30, floral: 10 },
      "MAT_00070": { fresh: 80, spicy: 15, floral: 5 }, "MAT_00074": { floral: 50, fresh: 30, spicy: 20 },
      "MAT_00043": { floral: 40, woody: 35, fresh: 25 }, "MAT_00049": { oriental: 60, woody: 25, spicy: 15 },
      "MAT_00087": { floral: 50, fresh: 40, sweet: 10 }, "MAT_00118": { floral: 70, oriental: 20, sweet: 10 },
      "MAT_00122": { oriental: 60, woody: 30, sweet: 10 }, "MAT_00088": { sweet: 80, powdery: 15, floral: 5 },
      "MAT_00089": { sweet: 90, powdery: 10 }, "MAT_00081": { sweet: 50, powdery: 40, floral: 10 },
      "MAT_00091": { musky: 50, woody: 35, powdery: 15 }, "MAT_00080": { floral: 60, powdery: 30, fresh: 10 },
      "MAT_00098": { sweet: 60, musky: 30, powdery: 10 }, "MAT_00099": { sweet: 70, fresh: 20, musky: 10 },
      "MAT_ISO": { woody: 50, musky: 35, powdery: 15 }
    },
    // V10: Intensity levels for quick selection
    intensityLevels: {
      concentrates: { hint: 1, subtle: 2, medium: 4, strong: 6, leading: 9 },
      oils: { hint: 0.3, subtle: 0.5, medium: 1, strong: 1.5, leading: 2.5 },
      aromachems: { hint: 0.2, subtle: 0.4, medium: 0.7, strong: 1, leading: 1.5 }
    },
    intensityLabels: { hint: '×¨×ž×–', subtle: '×¢×“×™×Ÿ', medium: '×‘×™× ×•× ×™', strong: '×“×•×ž×™× × ×˜×™', leading: '×ž×•×‘×™×œ' },
    // V10: Recommended ranges
    recommendedRanges: {
      concentrates: { min: 8, max: 15, label: '×ª×ž×¦×™×•×ª' },
      oils: { min: 2, max: 4, label: '×©×ž× ×™×' },
      aromachems: { min: 4, max: 7, label: '××¨×•×ž×›×™×ž×™×§×œ×™×' }
    }
  };

  let wizardState = { step: 0, preferences: { gender: null, category: null, intensity: null, season: null }, selectedMaterials: { concentrates: {}, oils: {}, aromachems: {} }, guideCollapsed: false };

  const resetWizard = () => { wizardState = { step: 0, preferences: { gender: null, category: null, intensity: null, season: null }, selectedMaterials: { concentrates: {}, oils: {}, aromachems: {} }, guideCollapsed: false }; };

  const getWizardMaterial = (id) => state.materials.find(m => m.id === id);

  const getWizardMaxMl = (material) => WIZARD_DATA.maxMl[material.id] || WIZARD_DATA.defaultMax[material.category] || 5;

  // V10: Get display name (secret for concentrates)
  const getDisplayName = (m) => {
    if (m.category === '×ª×ž×¦×™×•×ª') {
      const code = m.code || m.name.match(/\d+/)?.[0] || m.id.replace('MAT_000', '');
      return `×ª×ž×¦×™×ª #${code}`;
    }
    return m.name;
  };

  const isWizardCompatible = (materialId, selectedIds) => {
    if (selectedIds.length === 0) return true;
    const compat = WIZARD_DATA.compatibility[materialId];
    if (!compat) return true;
    for (const selId of selectedIds) {
      if (compat.avoidWith?.includes(selId)) return false;
      const selCompat = WIZARD_DATA.compatibility[selId];
      if (selCompat?.avoidWith?.includes(materialId)) return false;
    }
    return true;
  };

  const getWizardSynergy = (materialId, selectedIds) => {
    const synergies = [];
    const compat = WIZARD_DATA.compatibility[materialId];
    if (compat?.pairsWith) {
      for (const selId of selectedIds) {
        if (compat.pairsWith.includes(selId)) {
          const mat = getWizardMaterial(selId);
          if (mat) synergies.push(getDisplayName(mat));
        }
      }
    }
    return synergies;
  };

  const getCompatibleFromInventory = (materialId) => {
    const compat = WIZARD_DATA.compatibility[materialId];
    if (!compat?.pairsWith) return [];
    return compat.pairsWith.map(id => getWizardMaterial(id)).filter(m => m).map(m => getDisplayName(m)).slice(0, 4);
  };

  // V10: Get pairing suggestions
  const getPairingSuggestions = (type) => {
    const catData = WIZARD_DATA.categories[wizardState.preferences.category];
    if (!catData) return [];
    const allSelected = [...Object.keys(wizardState.selectedMaterials.concentrates), ...Object.keys(wizardState.selectedMaterials.oils), ...Object.keys(wizardState.selectedMaterials.aromachems)];
    if (allSelected.length === 0) return [];
    const suggestions = new Set();
    allSelected.forEach(id => {
      const compat = WIZARD_DATA.compatibility[id];
      if (compat?.pairsWith) {
        compat.pairsWith.forEach(compId => {
          if (!allSelected.includes(compId) && catData[type]?.includes(compId)) suggestions.add(compId);
        });
      }
    });
    return Array.from(suggestions).slice(0, 4).map(id => getWizardMaterial(id)).filter(m => m);
  };

  const calcScentProfile = () => {
    const profile = { floral: 0, woody: 0, fresh: 0, sweet: 0, spicy: 0, powdery: 0, musky: 0, oriental: 0 };
    let totalWeight = 0;
    for (const type of ['concentrates', 'oils', 'aromachems']) {
      for (const [id, ml] of Object.entries(wizardState.selectedMaterials[type])) {
        const tags = WIZARD_DATA.scentTags[id];
        if (tags) {
          for (const [tag, weight] of Object.entries(tags)) profile[tag] = (profile[tag] || 0) + weight * ml;
          totalWeight += ml * 100;
        }
      }
    }
    if (totalWeight > 0) for (const key in profile) profile[key] = Math.round(profile[key] / totalWeight * 100);
    return profile;
  };

  const generateScentDesc = (profile) => {
    const names = { floral: '×¤×¨×—×•× ×™', woody: '×¢×¦×™', fresh: '×¨×¢× ×Ÿ', sweet: '×ž×ª×•×§', spicy: '×ª×‘×œ×™× ×™', powdery: '××‘×§×ª×™', musky: '×ž×•×¡×§×™', oriental: '×ž×–×¨×—×™' };
    const sorted = Object.entries(profile).sort((a, b) => b[1] - a[1]).filter(([k, v]) => v > 8);
    if (sorted.length === 0) return '×‘×—×¨ ×—×•×ž×¨×™× ×›×“×™ ×œ×¨××•×ª ×¤×¨×•×¤×™×œ';
    if (sorted.length === 1) return `×‘×•×©× ${names[sorted[0][0]]}`;
    if (sorted.length === 2) return `×‘×•×©× ${names[sorted[0][0]]}-${names[sorted[1][0]]}`;
    return `×‘×•×©× ${names[sorted[0][0]]}-${names[sorted[1][0]]} ×¢× × ×’×™×¢×•×ª ${names[sorted[2][0]]}`;
  };

  const getMaterialEffect = (id, ml) => {
    const percent = (ml / 50) * 100;
    const m = getWizardMaterial(id);
    if (!m) return '';
    if (m.category === '×ª×ž×¦×™×•×ª') {
      if (percent < 4) return `×™×ª×Ÿ ×¨×ž×– ×¢×“×™×Ÿ`;
      if (percent < 8) return `×™×”×™×” ×ž×•×¨×’×© ×”×™×˜×‘`;
      if (percent < 12) return `×™×”×™×” ×“×•×ž×™× × ×˜×™`;
      return `×™×©×œ×•×˜ ×‘×‘×•×©×`;
    } else if (m.category === '×©×ž× ×™×') {
      if (percent < 1) return `× ×’×™×¢×” ×¢×“×™× ×”`;
      if (percent < 2) return `× ×•×›×—×•×ª ×‘×™× ×•× ×™×ª`;
      return `×ª×• ×‘×•×œ×˜`;
    } else {
      if (percent < 0.5) return `××¤×§×˜ ×¢×“×™×Ÿ`;
      if (percent < 1) return `××¤×§×˜ ×‘×¨×•×¨`;
      return `××¤×§×˜ ×—×–×§`;
    }
  };

  // V10: Get intensity level for current ml
  const getIntensityLevel = (type, ml) => {
    const levels = WIZARD_DATA.intensityLevels[type];
    if (ml <= levels.hint) return 'hint';
    if (ml <= levels.subtle) return 'subtle';
    if (ml <= levels.medium) return 'medium';
    if (ml <= levels.strong) return 'strong';
    return 'leading';
  };

  const calcWizardTotals = () => {
    let totalConc = 0, totalOils = 0, totalAroma = 0, dpgFromDiluted = 0;
    for (const [id, ml] of Object.entries(wizardState.selectedMaterials.concentrates)) totalConc += ml;
    for (const [id, ml] of Object.entries(wizardState.selectedMaterials.oils)) {
      totalOils += ml;
      const mat = getWizardMaterial(id);
      if (mat?.diluted && mat.dilutionPercent) dpgFromDiluted += ml * (1 - mat.dilutionPercent / 100);
    }
    for (const [id, ml] of Object.entries(wizardState.selectedMaterials.aromachems)) {
      totalAroma += ml;
      const mat = getWizardMaterial(id);
      if (mat?.diluted && mat.dilutionPercent) dpgFromDiluted += ml * (1 - mat.dilutionPercent / 100);
    }
    const intensity = WIZARD_DATA.intensity[wizardState.preferences.intensity] || WIZARD_DATA.intensity.medium;
    const isoE = intensity.isoE;
    const dpgToAdd = Math.max(0, 2 - dpgFromDiluted);
    const usedMl = totalConc + totalOils + totalAroma + isoE + dpgToAdd;
    const alcohol = Math.max(15, 50 - usedMl);
    return { concentrates: totalConc, oils: totalOils, aromachems: totalAroma, dpgFromDiluted, dpgToAdd, isoE, alcohol, total: usedMl + alcohol };
  };

  // V10: Check concentration warning
  const checkConcentrationWarning = () => {
    const totals = calcWizardTotals();
    const alcoholPercent = (totals.alcohol / 50) * 100;
    if (alcoholPercent < 55) return { warning: true, message: `××œ×›×•×”×•×œ ×¨×§ ${fmt(alcoholPercent)}% (×ž×•×ž×œ×¥ ×ž×™× ×™×ž×•× 55%)` };
    return { warning: false };
  };

  const generateWizardJSON = (name) => {
    const totals = calcWizardTotals();
    const rows = [];
    let rowNum = 1;
    for (const [id, ml] of Object.entries(wizardState.selectedMaterials.concentrates)) if (ml > 0) rows.push({ id: `row${String(rowNum++).padStart(3, '0')}`, materialId: id, ml, catHint: "×ª×ž×¦×™×•×ª" });
    for (const [id, ml] of Object.entries(wizardState.selectedMaterials.oils)) if (ml > 0) rows.push({ id: `row${String(rowNum++).padStart(3, '0')}`, materialId: id, ml, catHint: "×©×ž× ×™×" });
    for (const [id, ml] of Object.entries(wizardState.selectedMaterials.aromachems)) if (ml > 0) rows.push({ id: `row${String(rowNum++).padStart(3, '0')}`, materialId: id, ml, catHint: "××¨×•×ž×›×™×ž×™×§×œ×™×" });
    rows.push({ id: `row${String(rowNum++).padStart(3, '0')}`, materialId: "MAT_ISO", ml: totals.isoE, catHint: "×§×‘×•×¢×™×" });
    if (totals.dpgToAdd > 0) rows.push({ id: `row${String(rowNum++).padStart(3, '0')}`, materialId: "MAT_DPG", ml: Math.round(totals.dpgToAdd * 100) / 100, catHint: "×§×‘×•×¢×™×" });
    rows.push({ id: `row${String(rowNum++).padStart(3, '0')}`, materialId: "MAT_ALC", ml: Math.round(totals.alcohol * 100) / 100, catHint: "×§×‘×•×¢×™×" });
    const catData = WIZARD_DATA.categories[wizardState.preferences.category];
    const profile = calcScentProfile();
    return { id: uid() + "-" + uid(), name: name || "Wizard Creation", code: "#AF-" + Math.floor(Math.random() * 9000 + 1000), inspiredBy: "", date: todayISO(), updatedAt: todayISO(), qtyMl: 50, notes: `× ×•×¦×¨ ×‘××©×£ | ${catData?.nameHe || ''} | ${generateScentDesc(profile)}`, marketingText: generateScentDesc(profile), notesTop: "", notesHeart: "", notesBase: "", rows };
  };

  const renderProgressBar = () => {
    const totals = calcWizardTotals();
    const concP = (totals.concentrates / 50) * 100;
    const oilsP = (totals.oils / 50) * 100;
    const aromaP = (totals.aromachems / 50) * 100;
    const fixP = ((totals.isoE + totals.dpgToAdd) / 50) * 100;
    const alcP = (totals.alcohol / 50) * 100;
    return `<div class="formula-progress">
      <div class="progress-label">ðŸ§ª ×ž×™×œ×•×™ ×”×‘×§×‘×•×§ (50ml)</div>
      <div class="progress-bar-container">
        <div class="progress-segment concentrates" style="width:${concP}%"></div>
        <div class="progress-segment oils" style="width:${oilsP}%"></div>
        <div class="progress-segment aromachems" style="width:${aromaP}%"></div>
        <div class="progress-segment fixatives" style="width:${fixP}%"></div>
        <div class="progress-segment alcohol" style="width:${alcP}%"></div>
      </div>
      <div class="progress-legend">
        <span class="legend-item"><span class="legend-dot conc"></span> ×ª×ž×¦×™×•×ª ${fmt(totals.concentrates)}ml</span>
        <span class="legend-item"><span class="legend-dot oils"></span> ×©×ž× ×™× ${fmt(totals.oils)}ml</span>
        <span class="legend-item"><span class="legend-dot aroma"></span> ×›×™×ž×™×§×œ×™× ${fmt(totals.aromachems)}ml</span>
        <span class="legend-item"><span class="legend-dot fix"></span> ×§×‘×•×¢×™× ${fmt(totals.isoE + totals.dpgToAdd)}ml</span>
        <span class="legend-item"><span class="legend-dot alc"></span> ××œ×›×•×”×•×œ ${fmt(totals.alcohol)}ml</span>
      </div>
    </div>`;
  };

  const renderScentProfile = () => {
    const profile = calcScentProfile();
    const bars = [['ðŸŒ¸', '×¤×¨×—×•× ×™', 'floral'], ['ðŸªµ', '×¢×¦×™', 'woody'], ['ðŸƒ', '×¨×¢× ×Ÿ', 'fresh'], ['ðŸ¯', '×ž×ª×•×§', 'sweet'], ['ðŸŒ¶ï¸', '×ª×‘×œ×™× ×™', 'spicy'], ['ðŸ’œ', '××‘×§×ª×™', 'powdery'], ['ðŸ¤', '×ž×•×¡×§×™', 'musky'], ['ðŸ•Œ', '×ž×–×¨×—×™', 'oriental']];
    return `<div class="scent-profile-panel"><h4>ðŸŽ¨ ×¤×¨×•×¤×™×œ ×¨×™×—</h4><div class="scent-bars">${bars.map(([icon, name, key]) => `<div class="scent-bar"><span class="scent-label">${icon} ${name}</span><div class="scent-track"><div class="scent-fill ${key}" style="width:${profile[key]}%"></div></div><span class="scent-percent">${profile[key]}%</span></div>`).join('')}</div><div class="scent-description">${generateScentDesc(profile)}</div></div>`;
  };

  // V10: Recommendation Banner
  const renderRecommendationBanner = (type) => {
    const range = WIZARD_DATA.recommendedRanges[type];
    const totals = calcWizardTotals();
    const current = totals[type];
    const status = current < range.min ? 'warning' : (current > range.max ? 'warning' : 'good');
    const statusText = current === 0 ? '' : (current < range.min ? '(×ž×¢×˜)' : (current > range.max ? '(×”×¨×‘×”)' : 'âœ“'));
    return `<div class="recommendation-banner"><span class="rec-icon">ðŸ’¡</span><span class="rec-text">×ž×•×ž×œ×¥: ${range.min}-${range.max}ml ${range.label} (${range.min*2}-${range.max*2}%)</span><span class="rec-current ${status}">× ×•×›×—×™: ${fmt(current)}ml ${statusText}</span></div>`;
  };

  // V10: Concentration Warning
  const renderConcentrationWarning = () => {
    const check = checkConcentrationWarning();
    if (!check.warning) return '';
    return `<div class="concentration-warning"><span class="warning-icon">âš ï¸</span><span class="warning-text">×”×‘×•×©× ×ž×¨×•×›×– ×ž×“×™! ${check.message}</span><p class="warning-tip">×”×¤×—×ª ×›×ž×•×ª ×—×•×ž×¨×™× ××• ×‘×—×¨ ×¤×—×•×ª ×¨×›×™×‘×™×</p></div>`;
  };

  // V10: Pairing Suggestions
  const renderPairingSuggestions = (type) => {
    const suggestions = getPairingSuggestions(type);
    if (suggestions.length === 0) return '';
    return `<div class="pairing-suggestions"><h4>ðŸ’¡ ×ž×•×ž×œ×¥ ×œ×©×œ×‘ ×¢× ×”×‘×—×™×¨×•×ª ×©×œ×š:</h4><div class="suggestion-chips">${suggestions.map(m => `<div class="suggestion-chip"><span class="chip-name">${getDisplayName(m)}</span><button class="chip-add" data-type="${type}" data-id="${m.id}">+ ×”×•×¡×£</button></div>`).join('')}</div></div>`;
  };

  const getCategoryGuide = (type) => {
    const collapsed = wizardState.guideCollapsed ? 'collapsed' : '';
    if (type === 'concentrates') {
      return `<div class="category-guide"><h4 class="guide-toggle ${collapsed}" onclick="wizardState.guideCollapsed=!wizardState.guideCollapsed;renderWizard();">ðŸ’¡ ×”× ×—×™×•×ª ×œ×ª×ž×¦×™×•×ª</h4><div class="guide-content ${collapsed}" style="max-height:200px"><table><tr><td>2-4%</td><td>(1-2ml)</td><td>×¨×ž×– ×¢×“×™×Ÿ</td></tr><tr><td>5-8%</td><td>(2.5-4ml)</td><td>× ×•×›×—×•×ª ×‘×™× ×•× ×™×ª</td></tr><tr><td>9-12%</td><td>(4.5-6ml)</td><td>×“×•×ž×™× × ×˜×™</td></tr><tr><td>13-18%</td><td>(6.5-9ml)</td><td>×ž××•×“ ×—×–×§</td></tr></table></div></div>`;
    } else if (type === 'oils') {
      return `<div class="category-guide"><h4 class="guide-toggle ${collapsed}" onclick="wizardState.guideCollapsed=!wizardState.guideCollapsed;renderWizard();">ðŸ’¡ ×”× ×—×™×•×ª ×œ×©×ž× ×™×</h4><div class="guide-content ${collapsed}" style="max-height:200px"><table><tr><td>×¦×™×˜×¨×•×¡</td><td>0.5-1%</td><td>(0.25-0.5ml)</td></tr><tr><td>×¤×¨×—×•× ×™</td><td>0.5-1%</td><td>(0.25-0.5ml)</td></tr><tr><td>×¢×¦×™</td><td>1-3%</td><td>(0.5-1.5ml)</td></tr><tr><td>×ª×‘×œ×™× ×™×</td><td>0.2-0.5%</td><td>âš ï¸ ×–×”×™×¨×•×ª</td></tr></table></div></div>`;
    } else {
      return `<div class="category-guide"><h4 class="guide-toggle ${collapsed}" onclick="wizardState.guideCollapsed=!wizardState.guideCollapsed;renderWizard();">ðŸ’¡ ×”× ×—×™×•×ª ×œ××¨×•×ž×›×™×ž×™×§×œ×™×</h4><div class="guide-content ${collapsed}" style="max-height:200px"><table><tr><td>×ž×•×¡×§×™×</td><td>2-5%</td><td>(1-2.5ml)</td></tr><tr><td>Hedione</td><td>3-10%</td><td>(1.5-5ml)</td></tr><tr><td>××œ×“×”×™×“×™×</td><td>0.01-0.3%</td><td>âš ï¸ ×–×”×™×¨×•×ª!</td></tr></table></div></div>`;
    }
  };

  const renderWizard = () => {
    const left = $("leftPanel");
    const right = $("rightPanel");
    left.innerHTML = `<div class="wizard-container"><h2 style="color:var(--accent);margin-bottom:12px">ðŸ§™ ××©×£ ×‘× ×™×™×ª ×‘×•×©×</h2><p class="muted" style="margin-bottom:16px">×‘× ×” ×‘×•×©× ×ž×•×ª×× ××™×©×™×ª ×¦×¢×“ ××—×¨ ×¦×¢×“</p><div class="wizard-progress">${[['×”×¢×“×¤×•×ª', 0], ['×ª×ž×¦×™×•×ª', 1], ['×©×ž× ×™×', 2], ['×›×™×ž×™×§×œ×™×', 3], ['×¡×™×›×•×', 4]].map(([label, i]) => `<div class="wizard-step ${wizardState.step === i ? 'active' : wizardState.step > i ? 'completed' : ''}"><span class="wizard-step-num">${wizardState.step > i ? 'âœ“' : i + 1}</span><span>${label}</span></div>`).join('')}</div>${wizardState.step > 0 ? renderProgressBar() : ''}${wizardState.step > 0 ? renderConcentrationWarning() : ''}${wizardState.step > 0 ? renderScentProfile() : ''}${renderWizardSummary()}</div>`;
    right.innerHTML = `<div class="wizard-container">${renderWizardStep()}</div>`;
    wireWizardEvents();
  };

  const renderWizardSummary = () => {
    if (wizardState.step === 0) return '';
    const totals = calcWizardTotals();
    const catData = WIZARD_DATA.categories[wizardState.preferences.category];
    const fragrance = totals.concentrates + totals.oils + totals.aromachems;
    return `<div class="wizard-summary"><h4>ðŸ“Š ×¡×™×›×•× ×‘×™× ×™×™×</h4>${catData ? `<div class="summary-row"><span>×§×˜×’×•×¨×™×”:</span><span>${catData.nameHe}</span></div>` : ''}${totals.concentrates > 0 ? `<div class="summary-row"><span>×ª×ž×¦×™×•×ª:</span><span>${fmt(totals.concentrates)}ml</span></div>` : ''}${totals.oils > 0 ? `<div class="summary-row"><span>×©×ž× ×™×:</span><span>${fmt(totals.oils)}ml</span></div>` : ''}${totals.aromachems > 0 ? `<div class="summary-row"><span>×›×™×ž×™×§×œ×™×:</span><span>${fmt(totals.aromachems)}ml</span></div>` : ''}${fragrance > 0 ? `<div class="summary-total">×¡×”"×› ×¨×™×—: ${fmt(fragrance)}ml (${fmt(fragrance/50*100)}%)</div>` : ''}</div>`;
  };

  const renderWizardStep = () => {
    switch (wizardState.step) {
      case 0: return renderWizardStep0();
      case 1: return renderWizardMaterialStep('concentrates', '×ª×ž×¦×™×•×ª', '×©×ž× ×™×');
      case 2: return renderWizardMaterialStep('oils', '×©×ž× ×™×', '××¨×•×ž×›×™×ž×™×§×œ×™×');
      case 3: return renderWizardMaterialStep('aromachems', '××¨×•×ž×›×™×ž×™×§×œ×™×', '×¡×™×›×•×');
      case 4: return renderWizardStep4();
      default: return '';
    }
  };

  const renderWizardStep0 = () => {
    const prefs = [
      { key: 'gender', label: '×ž×™×Ÿ', options: [['women', 'ðŸ‘© × ×©×™×'], ['men', 'ðŸ‘¨ ×’×‘×¨×™×'], ['unisex', 'âš§ ×™×•× ×™×¡×§×¡']] },
      { key: 'category', label: '×§×˜×’×•×¨×™×”', options: [['floral', 'ðŸŒ¸ ×¤×¨×—×•× ×™'], ['woody', 'ðŸªµ ×¢×¦×™'], ['fresh', 'ðŸŠ ×¨×¢× ×Ÿ'], ['gourmand', 'ðŸ® ×’×•×¨×ž× ×“'], ['oriental', 'ðŸ•Œ ×ž×–×¨×—×™'], ['oud', 'â¬› ××•×“']] },
      { key: 'intensity', label: '×¢×•×¦×ž×”', options: [['light', 'â˜€ï¸ ×§×œ'], ['medium', 'ðŸŒ¤ï¸ ×‘×™× ×•× ×™'], ['strong', 'ðŸŒ™ ×—×–×§']] },
      { key: 'season', label: '×¢×•× ×”', options: [['summer', 'â˜€ï¸ ×§×™×¥'], ['winter', 'â„ï¸ ×—×•×¨×£'], ['all', 'ðŸ”„ ×›×œ ×”×©× ×”']] }
    ];
    return `<h3 class="wizard-title">ðŸ“ ×©×œ×‘ 1: ×‘×—×¨ ×”×¢×“×¤×•×ª</h3><div class="preference-grid">${prefs.map(p => `<div class="preference-group"><h4>${p.label}</h4><div class="preference-options">${p.options.map(([val, lbl]) => `<button class="pref-btn ${wizardState.preferences[p.key] === val ? 'selected' : ''}" data-pref="${p.key}" data-value="${val}">${lbl}</button>`).join('')}</div></div>`).join('')}</div><div class="wizard-nav"><button class="btn" id="wizardReset">ðŸ”„ ×”×ª×—×œ ×ž×—×“×©</button><button class="btn primary" id="wizardNext" ${Object.values(wizardState.preferences).some(v => !v) ? 'disabled' : ''}>×”×ž×©×š ×œ×ª×ž×¦×™×•×ª â†</button></div>`;
  };

  const renderWizardMaterialStep = (type, title, nextTitle) => {
    const catData = WIZARD_DATA.categories[wizardState.preferences.category];
    if (!catData) return '<p>×©×’×™××”</p>';
    const ids = catData[type] || [];
    const allSelectedIds = [...Object.keys(wizardState.selectedMaterials.concentrates), ...Object.keys(wizardState.selectedMaterials.oils), ...Object.keys(wizardState.selectedMaterials.aromachems)];
    const mats = ids.map(id => getWizardMaterial(id)).filter(m => m);
    if (mats.length === 0) return `<h3 class="wizard-title">ðŸ”´ ${title}</h3><div class="no-materials-msg"><p>××™×Ÿ ×—×•×ž×¨×™× ×ž×ª××™×ž×™× ×‘×ž×œ××™</p></div><div class="wizard-nav"><button class="btn" id="wizardPrev">â† ×—×–×•×¨</button><button class="btn primary" id="wizardNext">×”×ž×©×š ×œ${nextTitle} â†</button></div>`;
    const defaults = { concentrates: 4, oils: 1, aromachems: 0.5 };
    const icons = { concentrates: 'ðŸ”´', oils: 'ðŸŸ¢', aromachems: 'ðŸŸ¡' };
    const levels = WIZARD_DATA.intensityLevels[type];
    const labels = WIZARD_DATA.intensityLabels;
    return `<h3 class="wizard-title">${icons[type]} ×©×œ×‘ ${wizardState.step + 1}: ×‘×—×¨ ${title}</h3>
      ${renderRecommendationBanner(type)}
      ${getCategoryGuide(type)}
      ${renderPairingSuggestions(type)}
      <div class="material-picker">${mats.map(m => {
        const selected = wizardState.selectedMaterials[type][m.id] !== undefined;
        const ml = wizardState.selectedMaterials[type][m.id] || defaults[type];
        const compatible = isWizardCompatible(m.id, allSelectedIds.filter(id => id !== m.id));
        const synergies = getWizardSynergy(m.id, allSelectedIds.filter(id => id !== m.id));
        const maxAllowed = getWizardMaxMl(m);
        const dilutionInfo = m.diluted ? ` (${m.dilutionPercent}%)` : '';
        const compatList = getCompatibleFromInventory(m.id);
        const currentLevel = selected ? getIntensityLevel(type, ml) : null;
        return `<div class="material-item ${selected ? 'selected' : ''} ${!compatible ? 'incompatible' : ''}">
          <div class="material-header">
            <label class="material-name"><input type="checkbox" class="material-checkbox" data-type="${type}" data-id="${m.id}" ${selected ? 'checked' : ''} ${!compatible ? 'disabled' : ''}> <span class="material-code">${getDisplayName(m)}</span>${dilutionInfo}</label>
            ${selected ? `<span class="material-ml">${fmt(ml)}ml</span>` : ''}
          </div>
          <div class="material-desc">${escapeHtml(m.desc || '')}</div>
          ${compatList.length > 0 ? `<div class="compatible-materials"><span class="compat-label">âœ¨ ×”×•×œ×š ×˜×•×‘ ×¢×: </span><span class="compat-list">${compatList.join(', ')}</span></div>` : ''}
          ${synergies.length > 0 ? `<div class="material-synergy">ðŸ”— ×¡×™× ×¨×’×™×”: ${synergies.slice(0, 2).join(', ')}</div>` : ''}
          ${!compatible ? `<div class="material-warning">âš ï¸ ×œ× ×ž×ª××™×</div>` : ''}
          ${selected ? `
            <div class="intensity-selector">${Object.entries(levels).map(([lvl, val]) => `<button class="intensity-btn ${currentLevel === lvl ? 'active' : ''}" data-type="${type}" data-id="${m.id}" data-ml="${val}">${labels[lvl]} (${val}ml)</button>`).join('')}</div>
            <div class="manual-slider-label">××• ×”×ª××ž×” ×™×“× ×™×ª:</div>
            <div class="material-slider-row"><input type="range" class="material-slider" data-type="${type}" data-id="${m.id}" min="0.1" max="${maxAllowed}" step="0.1" value="${ml}"><span class="percent-hint">${fmt(ml/50*100)}%</span></div>
            <div class="material-effect">ðŸ“ ${getMaterialEffect(m.id, ml)}</div>
          ` : ''}
        </div>`;
      }).join('')}</div>
      <div class="wizard-nav"><button class="btn" id="wizardPrev">â† ×—×–×•×¨</button><button class="btn primary" id="wizardNext">×”×ž×©×š ×œ${nextTitle} â†</button></div>`;
  };

  const renderWizardStep4 = () => {
    const totals = calcWizardTotals();
    const catData = WIZARD_DATA.categories[wizardState.preferences.category];
    const profile = calcScentProfile();
    const buildList = (type, label) => {
      const items = wizardState.selectedMaterials[type];
      if (Object.keys(items).length === 0) return '';
      return `<div style="margin-top:8px"><strong>${label}:</strong><ul style="margin:4px 0 0 16px;font-size:0.85rem">${Object.entries(items).map(([id, ml]) => { const m = getWizardMaterial(id); return m ? `<li>${getDisplayName(m)} - ${fmt(ml)}ml (${fmt(ml/50*100)}%)</li>` : ''; }).join('')}</ul></div>`;
    };
    return `<h3 class="wizard-title">âœ… ×©×œ×‘ 5: ×¡×™×›×•× ×•×§×‘×•×¢×™×</h3>
      ${renderConcentrationWarning()}
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
        <div><h4 style="color:var(--accent);margin-bottom:8px">ðŸ“‹ ×¤×¨×˜×™ ×”×‘×•×©×</h4>
          <div class="summary-row"><span>×§×˜×’×•×¨×™×”:</span><span>${catData?.nameHe || ''}</span></div>
          <div class="summary-row"><span>××•×¤×™:</span><span>${generateScentDesc(profile)}</span></div>
          ${buildList('concentrates', 'ðŸ”´ ×ª×ž×¦×™×•×ª')}${buildList('oils', 'ðŸŸ¢ ×©×ž× ×™×')}${buildList('aromachems', 'ðŸŸ¡ ×›×™×ž×™×§×œ×™×')}
        </div>
        <div>
          <div class="fixatives-auto"><h4>ðŸ”§ ×§×‘×•×¢×™× (××•×˜×•×ž×˜×™)</h4>
            <div class="fixative-row"><span class="fixative-name">ISO E Super</span><span class="fixative-value">${fmt(totals.isoE)}ml (${fmt(totals.isoE/50*100)}%)</span></div>
            <div class="fixative-row"><span class="fixative-name">DPG ×œ×”×•×¡×¤×”</span><span class="fixative-value">${fmt(totals.dpgToAdd)}ml</span></div>
            <div class="fixative-row"><span class="fixative-name">DPG ×ž×—×•×ž×¨×™×</span><span class="fixative-value">${fmt(totals.dpgFromDiluted)}ml</span></div>
            <div class="fixative-row"><span class="fixative-name">Alcohol 99%</span><span class="fixative-value">${fmt(totals.alcohol)}ml (${fmt(totals.alcohol/50*100)}%)</span></div>
          </div>
          <div class="wizard-summary" style="margin-top:12px"><h4>ðŸ“Š ×¡×™×›×•× ×¡×•×¤×™</h4>
            <div class="summary-row"><span>×¨×™×›×•×– ×›×•×œ×œ:</span><span>${fmt((totals.concentrates+totals.oils+totals.aromachems)/50*100)}%</span></div>
            <div class="summary-row"><span>××œ×›×•×”×•×œ:</span><span>${fmt(totals.alcohol/50*100)}%</span></div>
            <div class="summary-total" ${Math.abs(totals.total - 50) > 0.1 ? 'style="color:var(--danger)"' : ''}>×¡×”"×›: ${fmt(totals.total)}ml ${Math.abs(totals.total - 50) <= 0.1 ? 'âœ…' : 'âš ï¸'}</div>
          </div>
        </div>
      </div>
      <div style="margin-top:16px"><label style="display:block;margin-bottom:6px;color:var(--accent)">×©× ×”×‘×•×©×:</label><input type="text" id="wizardPerfumeName" style="width:100%;padding:10px;background:var(--panel2);border:1px solid var(--line);border-radius:8px;color:var(--text)" placeholder="×”×›× ×¡ ×©×..."></div>
      <div class="final-actions"><button class="btn" id="wizardPrev">â† ×—×–×•×¨</button><button class="btn" id="wizardCopyJSON">ðŸ“‹ ×”×¢×ª×§ JSON</button><button class="btn primary" id="wizardSaveDev">ðŸ’¾ ×©×ž×•×¨ ×œ×¤×™×ª×•×—×™×</button></div>
      <details style="margin-top:16px"><summary style="cursor:pointer;color:var(--accent)">ðŸ“„ ×”×¦×’ JSON</summary><div class="wizard-formula-preview">${escapeHtml(JSON.stringify(generateWizardJSON("×‘×•×©× ×—×“×©"), null, 2))}</div></details>`;
  };

  const wireWizardEvents = () => {
    document.querySelectorAll('.pref-btn').forEach(btn => { btn.onclick = () => { wizardState.preferences[btn.getAttribute('data-pref')] = btn.getAttribute('data-value'); renderWizard(); }; });
    document.querySelectorAll('.material-checkbox').forEach(cb => {
      cb.onchange = () => {
        const type = cb.getAttribute('data-type'), id = cb.getAttribute('data-id');
        const defaults = { concentrates: 4, oils: 1, aromachems: 0.5 };
        if (cb.checked) wizardState.selectedMaterials[type][id] = defaults[type]; else delete wizardState.selectedMaterials[type][id];
        renderWizard();
      };
    });
    // V10: Intensity buttons
    document.querySelectorAll('.intensity-btn').forEach(btn => {
      btn.onclick = () => {
        const type = btn.getAttribute('data-type'), id = btn.getAttribute('data-id'), ml = parseFloat(btn.getAttribute('data-ml'));
        wizardState.selectedMaterials[type][id] = ml;
        renderWizard();
      };
    });
    // V10: Suggestion chip add buttons
    document.querySelectorAll('.chip-add').forEach(btn => {
      btn.onclick = () => {
        const type = btn.getAttribute('data-type'), id = btn.getAttribute('data-id');
        const defaults = { concentrates: 4, oils: 1, aromachems: 0.5 };
        wizardState.selectedMaterials[type][id] = defaults[type];
        renderWizard();
      };
    });
    document.querySelectorAll('.material-slider').forEach(slider => {
      slider.oninput = () => {
        const type = slider.getAttribute('data-type'), id = slider.getAttribute('data-id');
        wizardState.selectedMaterials[type][id] = parseFloat(slider.value);
        const item = slider.closest('.material-item');
        const mlSpan = item.querySelector('.material-ml'), hintSpan = slider.parentElement.querySelector('.percent-hint'), effectDiv = item.querySelector('.material-effect');
        if (mlSpan) mlSpan.textContent = fmt(slider.value) + 'ml';
        if (hintSpan) hintSpan.textContent = fmt(slider.value/50*100) + '%';
        if (effectDiv) effectDiv.innerHTML = 'ðŸ“ ' + getMaterialEffect(id, slider.value);
        // Update intensity button highlights
        const currentLevel = getIntensityLevel(type, slider.value);
        item.querySelectorAll('.intensity-btn').forEach(b => b.classList.toggle('active', b.getAttribute('data-ml') == WIZARD_DATA.intensityLevels[type][currentLevel]));
      };
    });
    const resetBtn = $("wizardReset"), prevBtn = $("wizardPrev"), nextBtn = $("wizardNext");
    if (resetBtn) resetBtn.onclick = () => { resetWizard(); renderWizard(); };
    if (prevBtn) prevBtn.onclick = () => { wizardState.step = Math.max(0, wizardState.step - 1); renderWizard(); };
    if (nextBtn) nextBtn.onclick = () => { wizardState.step = Math.min(4, wizardState.step + 1); renderWizard(); };
    const copyBtn = $("wizardCopyJSON"), saveBtn = $("wizardSaveDev");
    if (copyBtn) copyBtn.onclick = () => { const name = $("wizardPerfumeName")?.value.trim() || "Wizard Creation"; navigator.clipboard.writeText(JSON.stringify(generateWizardJSON(name), null, 2)); alert("âœ… JSON ×”×•×¢×ª×§!"); };
    if (saveBtn) saveBtn.onclick = () => {
      const name = $("wizardPerfumeName")?.value.trim();
      if (!name) { alert("×× × ×”×›× ×¡ ×©× ×œ×‘×•×©×"); return; }
      state.perfumesDev.unshift(generateWizardJSON(name));
      saveState();
      alert(`âœ… ×”×‘×•×©× "${name}" × ×©×ž×¨ ×‘×”×¦×œ×—×”!`);
      resetWizard();
      state.ui.tab = "dev";
      render();
    };
  };


  const STORAGE_KEY = "enigma_v6_state";

  // Default State
  const defaultState = () => ({
    ui: {
      tab: "materials",
      showCodes: false,
      hideEssences: false,
      hideInspired: false,
      hidePrices: false,
      debugMode: false,
      sortMaterials: "new",
      sortDev: "new",
      sortFinal: "new"
    },
    auth: {
      adminPassword: "admin123",
      guestUser: "guest",
      guestPassword: "guest123",
      guestPermissions: {
        viewDev: true,
        viewFinal: true,
        viewMaterials: false,
        viewPricing: false,
        showCodesOnly: true,
        canEdit: false
      }
    },
    defaultQty: 50,
    materials: [
      { id: "MAT_ISO", name: "ISO E Super", code: "ISO", category: "×§×‘×•×¢×™×", desc: "×ž×•×“×•×œ×˜×•×¨ ×¢×™×§×¨×™", pricePerKg: null, pricePerMl: null, diluted: false, dilutionPercent: null },
      { id: "MAT_CIT", name: "Citrofol F", code: "CIT", category: "×§×‘×•×¢×™×", desc: "Triethyl Citrate - ×§×™×‘×•×¢ ×•×©×™×¤×•×¨ ×”×§×¨× ×”", pricePerKg: null, pricePerMl: null, diluted: false, dilutionPercent: null },
      { id: "MAT_DPG", name: "DPG", code: "DPG", category: "×§×‘×•×¢×™×", desc: "Dipropylene Glycol - ×ž×ž×¡ ×•×ž×“×œ×œ", pricePerKg: null, pricePerMl: null, diluted: false, dilutionPercent: null },
      { id: "MAT_ALC", name: "××œ×›×•×”×•×œ", code: "ALC", category: "×§×‘×•×¢×™×", desc: "Perfumers Alcohol 96%", pricePerKg: null, pricePerMl: null, diluted: false, dilutionPercent: null }
    ],
    perfumesDev: [],
    perfumesFinal: []
  });

  // DOM selector shorthand (needed early for auth functions)
  const $ = (id) => document.getElementById(id);

  // Current user session (not persisted)
  let currentUser = null; // null = not logged in, "admin" or "guest"

  // Auth functions
  const isAdmin = () => currentUser === "admin";
  const isGuest = () => currentUser === "guest";
  const isLoggedIn = () => currentUser !== null;

  const canView = (section) => {
    if (isAdmin()) return true;
    if (!isGuest()) return false;
    const p = state.auth?.guestPermissions || {};
    switch(section) {
      case "materials": return p.viewMaterials !== false;
      case "dev": return p.viewDev !== false;
      case "final": return p.viewFinal !== false;
      case "pricing": return p.viewPricing !== false;
      case "settings": return false; // Guest never sees settings
      default: return false;
    }
  };

  const canEdit = () => isAdmin() || (isGuest() && state.auth?.guestPermissions?.canEdit);
  const showCodesOnly = () => isGuest() && state.auth?.guestPermissions?.showCodesOnly;

  const login = (username, password) => {
    // Ensure auth exists
    if (!state.auth) {
      state.auth = defaultState().auth;
    }
    const auth = state.auth;
    const userLower = username.toLowerCase();
    const passLower = password.toLowerCase();

    // Check admin (case-insensitive username AND password)
    if (userLower === "admin" && passLower === auth.adminPassword.toLowerCase()) {
      currentUser = "admin";
      return true;
    }

    // Check guest (case-insensitive username AND password)
    if (userLower === (auth.guestUser || "").toLowerCase() && passLower === (auth.guestPassword || "").toLowerCase()) {
      currentUser = "guest";
      return true;
    }

    return false;
  };

  const logout = () => {
    currentUser = null;
    showLoginScreen();
  };

  const showLoginScreen = () => {
    $("loginOverlay").classList.remove("hidden");
    $("loginUser").value = "";
    $("loginPass").value = "";
    $("loginError").textContent = "";
    $("loginUser").focus();
  };

  const hideLoginScreen = () => {
    $("loginOverlay").classList.add("hidden");
    updateUserBadge();
    render();
  };

  const updateUserBadge = () => {
    const badge = $("userBadge");
    if (isAdmin()) {
      badge.textContent = "ðŸ‘‘ Admin";
      badge.className = "user-badge";
    } else if (isGuest()) {
      badge.textContent = "ðŸ‘¤ " + (state.auth?.guestUser || "Guest");
      badge.className = "user-badge guest";
    }
  };

  // ==================== FIREBASE CONFIG ====================
  const FIREBASE_CONFIG = {
    apiKey: "AIzaSyBVLibR90kjeGkSmWdHsv6MeMvYf6atkKs",
    authDomain: "enigma-58ba8.firebaseapp.com",
    projectId: "enigma-58ba8",
    storageBucket: "enigma-58ba8.firebasestorage.app",
    messagingSenderId: "509680849725",
    appId: "1:509680849725:web:440348128898bc1df3ab54"
  };

  // Firebase will be loaded dynamically
  let db = null;
  let firebaseReady = false;
  let syncStatus = "local"; // "local", "syncing", "synced", "error"

  const initFirebase = async () => {
    try {
      // Load Firebase scripts dynamically
      await loadScript("https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js");
      await loadScript("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js");
      
      firebase.initializeApp(FIREBASE_CONFIG);
      db = firebase.firestore();
      firebaseReady = true;
      console.log("Firebase initialized successfully");
      
      // Try to load from cloud
      await loadFromCloud();
      updateSyncIndicator();
    } catch (e) {
      console.warn("Firebase init failed, using local storage:", e);
      firebaseReady = false;
      updateSyncIndicator();
    }
  };

  const loadScript = (src) => {
    return new Promise((resolve, reject) => {
      if (document.querySelector(`script[src="${src}"]`)) {
        resolve();
        return;
      }
      const script = document.createElement("script");
      script.src = src;
      script.onload = resolve;
      script.onerror = reject;
      document.head.appendChild(script);
    });
  };

  const loadFromCloud = async () => {
    if (!firebaseReady || !db) return false;
    try {
      syncStatus = "syncing";
      updateSyncIndicator();
      
      const doc = await db.collection("enigma").doc("main").get();
      if (doc.exists) {
        const cloudData = doc.data();
        if (cloudData && cloudData.state) {
          const cloudState = JSON.parse(cloudData.state);
          // Check if cloud data is newer
          const localTime = state._lastModified || 0;
          const cloudTime = cloudState._lastModified || 0;
          
          console.log("Local time:", localTime, "Cloud time:", cloudTime);
          
          if (cloudTime >= localTime) {
            // Apply cloud state
            const newState = { ...defaultState(), ...cloudState };
            newState.ui = { ...defaultState().ui, ...(cloudState.ui || {}) };
            
            // Ensure arrays exist
            if (!Array.isArray(newState.materials)) newState.materials = defaultState().materials;
            if (!Array.isArray(newState.perfumesDev)) newState.perfumesDev = [];
            if (!Array.isArray(newState.perfumesFinal)) newState.perfumesFinal = [];
            
            // Update global state
            state = newState;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            console.log("Loaded from cloud - materials:", state.materials.length, "dev:", state.perfumesDev.length);
          }
        }
      } else {
        console.log("No cloud data found - first sync will create it");
      }
      syncStatus = "synced";
      updateSyncIndicator();
      return true;
    } catch (e) {
      console.warn("Cloud load failed:", e);
      syncStatus = "error";
      updateSyncIndicator();
      return false;
    }
  };

  const saveToCloud = async () => {
    if (!firebaseReady || !db) return false;
    try {
      syncStatus = "syncing";
      updateSyncIndicator();
      
      state._lastModified = Date.now();
      await db.collection("enigma").doc("main").set({
        state: JSON.stringify(state),
        updatedAt: new Date().toISOString()
      });
      
      syncStatus = "synced";
      updateSyncIndicator();
      console.log("Saved to cloud");
      return true;
    } catch (e) {
      console.warn("Cloud save failed:", e);
      syncStatus = "error";
      updateSyncIndicator();
      return false;
    }
  };

  let lastSyncTime = null;

  const updateSyncIndicator = () => {
    const indicator = document.getElementById("syncIndicator");
    if (!indicator) return;

    const icons = {
      local: "ðŸ’¾",
      syncing: "ðŸ”„",
      synced: "â˜ï¸",
      error: "âš ï¸"
    };
    const titles = {
      local: "×ž×¦×‘ ×ž×§×•×ž×™ ×‘×œ×‘×“",
      syncing: "×ž×¡× ×›×¨×Ÿ...",
      synced: "×ž×¡×•× ×›×¨×Ÿ ×œ×¢× ×Ÿ",
      error: "×©×’×™××ª ×¡× ×›×¨×•×Ÿ"
    };

    if (syncStatus === "synced") lastSyncTime = new Date();
    const timeStr = lastSyncTime ? ` (${lastSyncTime.toLocaleTimeString("he-IL")})` : "";

    indicator.textContent = icons[syncStatus] || "ðŸ’¾";
    indicator.title = (titles[syncStatus] || "") + timeStr;
    indicator.className = `sync-indicator ${syncStatus}`;
  };

  // Load/Save State
  const loadState = () => {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return defaultState();
      const s = JSON.parse(raw);
      s.ui = { ...defaultState().ui, ...(s.ui || {}) };
      // Ensure auth settings exist
      s.auth = { ...defaultState().auth, ...(s.auth || {}) };
      s.auth.guestPermissions = { ...defaultState().auth.guestPermissions, ...(s.auth.guestPermissions || {}) };
      if (!Array.isArray(s.materials)) s.materials = defaultState().materials;
      if (!Array.isArray(s.perfumesDev)) s.perfumesDev = [];
      if (!Array.isArray(s.perfumesFinal)) s.perfumesFinal = [];
      s.defaultQty = num(s.defaultQty, 50);
      // Ensure fixed materials exist
      const ids = new Set(s.materials.map(m => m.id));
      if (!ids.has("MAT_DPG")) s.materials.unshift({ id: "MAT_DPG", name: "DPG", code: "DPG", category: "×§×‘×•×¢×™×", desc: "Dipropylene Glycol", pricePerKg: null, pricePerMl: null, diluted: false, dilutionPercent: null });
      return s;
    } catch (e) {
      console.warn("Load error:", e);
      return defaultState();
    }
  };

  let state = loadState();
  
  // Debounce cloud save
  let cloudSaveTimeout = null;
  const saveState = () => {
    state._lastModified = Date.now();
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));

    // Debounce cloud save (save after 2 seconds of no changes)
    if (cloudSaveTimeout) clearTimeout(cloudSaveTimeout);
    cloudSaveTimeout = setTimeout(() => {
      saveToCloud();
    }, 2000);
  };

  // ==================== UNDO SYSTEM ====================
  const undoStack = [];
  const MAX_UNDO = 10;
  let undoTimeout = null;

  const pushUndo = (action, description) => {
    undoStack.push({
      action,
      description,
      state: JSON.stringify(state),
      timestamp: Date.now()
    });
    if (undoStack.length > MAX_UNDO) undoStack.shift();
    showUndoToast(description);
  };

  const performUndo = () => {
    if (undoStack.length === 0) {
      alert("××™×Ÿ ×¤×¢×•×œ×•×ª ×œ×‘×™×˜×•×œ");
      return;
    }
    const item = undoStack.pop();
    const restored = JSON.parse(item.state);
    Object.assign(state, restored);
    saveState();
    render();
    hideUndoToast();
    alert("âœ… ×”×¤×¢×•×œ×” ×‘×•×˜×œ×”!");
  };

  const showUndoToast = (message) => {
    const toast = $("undoToast");
    const msg = $("undoMessage");
    if (toast && msg) {
      msg.textContent = message || "×¤×¢×•×œ×” ×‘×•×¦×¢×”";
      toast.classList.add("show");
      if (undoTimeout) clearTimeout(undoTimeout);
      undoTimeout = setTimeout(hideUndoToast, 8000);
    }
  };

  const hideUndoToast = () => {
    const toast = $("undoToast");
    if (toast) toast.classList.remove("show");
    if (undoTimeout) clearTimeout(undoTimeout);
  };

  // Wire undo toast buttons
  setTimeout(() => {
    const undoBtn = $("undoBtn");
    const undoDismiss = $("undoDismiss");
    if (undoBtn) undoBtn.onclick = performUndo;
    if (undoDismiss) undoDismiss.onclick = hideUndoToast;
  }, 100);

  // ==================== OFFLINE DETECTION ====================
  const updateOnlineStatus = () => {
    const banner = $("offlineBanner");
    if (banner) {
      banner.classList.toggle("show", !navigator.onLine);
    }
  };

  window.addEventListener("online", updateOnlineStatus);
  window.addEventListener("offline", updateOnlineStatus);
  updateOnlineStatus();

  // ==================== KEYBOARD SHORTCUTS ====================
  document.addEventListener("keydown", (e) => {
    // Don't trigger shortcuts when typing in inputs
    if (e.target.tagName === "INPUT" || e.target.tagName === "TEXTAREA" || e.target.tagName === "SELECT") {
      return;
    }

    // Ctrl+S - Save to cloud
    if (e.ctrlKey && e.key === "s") {
      e.preventDefault();
      const btn = $("btnSaveCloud");
      if (btn && btn.style.display !== "none") btn.click();
    }

    // Ctrl+Z - Undo
    if (e.ctrlKey && e.key === "z") {
      e.preventDefault();
      performUndo();
    }

    // Ctrl+N - New formula
    if (e.ctrlKey && e.key === "n") {
      e.preventDefault();
      const tab = state.ui.tab;
      if ((tab === "dev" || tab === "final") && canEdit()) {
        const btn = $("btnAddPerf");
        if (btn) btn.click();
      }
    }

    // Ctrl+E - Export
    if (e.ctrlKey && e.key === "e") {
      e.preventDefault();
      const btn = $("btnExport");
      if (btn && btn.style.display !== "none") btn.click();
    }

    // ? - Toggle shortcuts help
    if (e.key === "?" && !e.ctrlKey && !e.altKey) {
      const help = $("shortcutsHelp");
      if (help) help.classList.toggle("show");
    }
  });

  // DOM Elements ($ already defined above)
  const overlay = $("overlay");
  const modalBody = $("modalBody");
  const modalTitle = $("modalTitle");
  const fullpage = $("fullpage");
  const fpBody = $("fpBody");
  const fpTitle = $("fpTitle");
  const fpPill = $("fpPill");

  // Modal functions
  const openModal = ({ title, body }) => {
    modalTitle.textContent = title || "×—×œ×•×Ÿ";
    modalBody.innerHTML = body || "";
    overlay.classList.add("show");
  };

  const closeModal = () => {
    overlay.classList.remove("show");
    modalBody.innerHTML = "";
  };

  overlay.addEventListener("click", (e) => { if (e.target === overlay) closeModal(); });
  $("modalClose").addEventListener("click", closeModal);
  document.addEventListener("keydown", (e) => { if (e.key === "Escape" && overlay.classList.contains("show")) closeModal(); });

  // Full page functions
  const openFullPage = ({ title, pill, body }) => {
    fpTitle.textContent = title || "×¦×¤×™×™×”";
    fpPill.textContent = pill || "";
    fpPill.classList.toggle("hidden", !pill);
    fpBody.innerHTML = body || "";
    fullpage.classList.add("show");
    document.body.style.overflow = "hidden";
  };

  const closeFullPage = () => {
    fullpage.classList.remove("show");
    fpBody.innerHTML = "";
    document.body.style.overflow = "";
  };

  $("fpClose").addEventListener("click", closeFullPage);
  document.addEventListener("keydown", (e) => { if (e.key === "Escape" && fullpage.classList.contains("show")) closeFullPage(); });

  // Material helpers
  const getMaterial = (id) => state.materials.find(m => m.id === id) || null;
  const getDPG = () => getMaterial("MAT_DPG");

  // Price calculations
  const basePricePerMl = (mat) => {
    if (!mat) return null;
    if (mat.pricePerMl != null && String(mat.pricePerMl).trim() !== "") return num(mat.pricePerMl, 0);
    if (mat.pricePerKg != null && String(mat.pricePerKg).trim() !== "") return num(mat.pricePerKg, 0) / 1000;
    return null;
  };

  const effectivePricePerMl = (mat) => {
    if (!mat) return null;
    const price = basePricePerMl(mat);
    if (price == null) return null;
    if (mat.diluted) {
      const oilPct = clamp(num(mat.dilutionPercent, 100), 0, 100) / 100;
      const dpg = getDPG();
      const dpgPrice = basePricePerMl(dpg) ?? 0;
      return (oilPct * price) + ((1 - oilPct) * dpgPrice);
    }
    return price;
  };

  // Essence code display
  const extractDigits = (s) => {
    const matches = String(s || "").match(/\d+/g);
    return matches ? matches.join(" ") : "";
  };

  const getEssenceCode = (m) => {
    if (!m) return "";
    const code = String(m.code || "").trim();
    if (code && /^[0-9\s]+$/.test(code)) return code;
    if (code) {
      const dig = extractDigits(code);
      if (dig) return dig;
    }
    return extractDigits(m.name);
  };

  const materialDisplayName = (m, ctx = "default") => {
    if (!m) return "";
    // Guest with showCodesOnly sees only codes for essences
    const forceCodesOnly = showCodesOnly() && m.category === "×ª×ž×¦×™×•×ª";
    if ((state.ui.showCodes || forceCodesOnly) && m.category === "×ª×ž×¦×™×•×ª") {
      const ec = getEssenceCode(m);
      return ec || m.name;
    }
    if (ctx === "list" && m.code) return `${m.name} â€¢ ${m.code}`;
    return m.name;
  };

  // Formula calculations
  const computeFormula = (perf) => {
    const qty = clamp(num(perf.qtyMl, 50), 0, 100000);
    let totalMl = 0, totalCost = 0, costKnown = true;
    (perf.rows || []).forEach(r => {
      const ml = clamp(num(r.ml, 0), 0, 100000);
      totalMl += ml;
      const mat = getMaterial(r.materialId);
      const eff = effectivePricePerMl(mat);
      if (eff == null) costKnown = false;
      else totalCost += ml * eff;
    });
    const totalPct = qty > 0 ? (totalMl / qty) * 100 : 0;
    return {
      qty,
      totalMl,
      totalPct,
      totalCost: costKnown ? totalCost : null,
      costKnown,
      costPerMl: (costKnown && qty > 0) ? (totalCost / qty) : null
    };
  };

  // Group rows by category
  const groupRowsByCategory = (rows) => {
    const groups = {};
    (rows || []).forEach(r => {
      const m = getMaterial(r.materialId);
      const cat = (m && m.category) ? m.category : (r.catHint || "××—×¨");
      if (!groups[cat]) groups[cat] = [];
      groups[cat].push(r);
    });
    const ordered = {};
    CATEGORIES.forEach(c => { if (groups[c]) ordered[c] = groups[c]; });
    Object.keys(groups).forEach(k => { if (!ordered[k]) ordered[k] = groups[k]; });
    return ordered;
  };

  // Toggles HTML
  const renderToggles = () => {
    // Guest doesn't see toggles at all
    if (!isAdmin()) return '';
    
    return `
    <div class="toggles">
      <button class="toggle-btn ${state.ui.showCodes ? 'on' : ''}" data-toggle="showCodes">ðŸ”¢ ×§×•×“×™× ×œ×ª×ž×¦×™×•×ª</button>
      <button class="toggle-btn ${state.ui.hideEssences ? 'on' : ''}" data-toggle="hideEssences">ðŸ™ˆ ×”×¡×ª×¨ ×ª×ž×¦×™×•×ª</button>
      <button class="toggle-btn ${state.ui.hideInspired ? 'on' : ''}" data-toggle="hideInspired">ðŸ’­ ×”×¡×ª×¨ ×‘×”×©×¨××ª</button>
      <button class="toggle-btn ${state.ui.hidePrices ? 'on' : ''}" data-toggle="hidePrices">ðŸ’° ×”×¡×ª×¨ ×ž×—×™×¨×™×</button>
      <button class="toggle-btn ${state.ui.debugMode ? 'on' : ''}" data-toggle="debugMode">ðŸ”§ ×ž×¦×‘ ×˜×›× ×™</button>
    </div>
  `;
  };

  const wireToggles = (container) => {
    (container || document).querySelectorAll("[data-toggle]").forEach(btn => {
      btn.onclick = () => {
        const key = btn.getAttribute("data-toggle");
        state.ui[key] = !state.ui[key];
        saveState();
        render();
      };
    });
  };

  // Category options for select
  const categoryOptions = (selected) => CATEGORIES.map(c => 
    `<option value="${c}" ${c === selected ? "selected" : ""}>${c}</option>`
  ).join("");

  // Build select options for materials in a category
  const buildMaterialOptions = (category, selectedId) => {
    const mats = state.materials
      .filter(m => m.category === category)
      .sort((a, b) => materialDisplayName(a).localeCompare(materialDisplayName(b), "he", { numeric: true }));
    let html = `<option value="">â€” ×‘×—×¨ â€”</option>`;
    mats.forEach(m => {
      const label = escapeHtml(materialDisplayName(m, "list"));
      html += `<option value="${m.id}" ${m.id === selectedId ? "selected" : ""}>${label}</option>`;
    });
    return html;
  };

  // ==================== MATERIALS PAGE ====================
  const renderMaterials = () => {
    const left = $("leftPanel");
    const right = $("rightPanel");
    const cat = state._matCat || "×”×›×œ";
    const q = (state._matQ || "").toLowerCase();

    let filtered = state.materials.filter(m => cat === "×”×›×œ" || m.category === cat);
    if (q) filtered = filtered.filter(m => 
      ((m.name || "") + " " + (m.code || "") + " " + (m.desc || "")).toLowerCase().includes(q)
    );

    // Sorting
    const sort = state.ui.sortMaterials || "new";
    if (sort === "old") filtered.reverse();
    else if (sort === "az") filtered.sort((a, b) => (a.name || "").localeCompare(b.name || "", "he"));
    else if (sort === "za") filtered.sort((a, b) => (b.name || "").localeCompare(a.name || "", "he"));

    const needsFullRender = !$("matQ") || !$("matListBody");

    if (needsFullRender) {
      left.innerHTML = `
        <h2>ðŸ“¦ ×ž×¡×“ × ×ª×•× ×™× â€“ ×—×•×ž×¨×™ ×’×œ×</h2>
        ${renderToggles()}
        <div class="hr"></div>
        <div class="row">
          <div class="field" style="flex:2">
            <label>×—×™×¤×•×©</label>
            <input id="matQ" placeholder="×©×, ×§×•×“ ××• ×ª×™××•×¨..." value="${escapeHtml(state._matQ || "")}">
          </div>
          <div class="field">
            <label>×§×˜×’×•×¨×™×”</label>
            <select id="matCat">
              <option value="×”×›×œ" ${cat === "×”×›×œ" ? "selected" : ""}>×”×›×œ</option>
              ${categoryOptions(cat)}
            </select>
          </div>
          <div class="field">
            <label>×ž×™×•×Ÿ</label>
            <select id="matSort">
              <option value="new" ${sort === "new" ? "selected" : ""}>×ž×”×—×“×©</option>
              <option value="old" ${sort === "old" ? "selected" : ""}>×ž×”×™×©×Ÿ</option>
              <option value="az" ${sort === "az" ? "selected" : ""}>×-×ª</option>
              <option value="za" ${sort === "za" ? "selected" : ""}>×ª-×</option>
            </select>
          </div>
        </div>
        <div class="row" style="margin-top:12px">
          ${canEdit() ? `<button class="btn primary" id="btnAddMat">+ ×”×•×¡×£ ×—×•×ž×¨ ×’×œ×</button>` : ''}
          <div class="pill" id="matCount">×¡×”"×›: ${filtered.length}</div>
        </div>
      `;

      right.innerHTML = `
        <h2>×¨×©×™×ž×ª ×—×•×ž×¨×™×</h2>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th style="width:40%">×©×</th>
                <th style="width:15%">×§×˜×’×•×¨×™×”</th>
                <th class="${state.ui.hidePrices ? 'hidden' : ''}" style="width:15%">×ž×—×™×¨/ml</th>
                <th style="width:12%">×“×™×œ×•×œ</th>
                <th style="width:18%">×¤×¢×•×œ×•×ª</th>
              </tr>
            </thead>
            <tbody id="matListBody"></tbody>
          </table>
        </div>
      `;
    }

    // Update count
    if ($("matCount")) $("matCount").textContent = `×¡×”"×›: ${filtered.length}`;

    // Update list
    $("matListBody").innerHTML = filtered.map(m => `
      <tr class="tr">
        <td>
          <div style="font-weight:700">${escapeHtml(materialDisplayName(m, "list"))}</div>
          <div class="small">${escapeHtml(m.desc || "")}</div>
        </td>
        <td><span class="chip">${escapeHtml(m.category)}</span></td>
        <td class="${state.ui.hidePrices ? 'hidden' : ''}">
          ${basePricePerMl(m) == null ? '<span class="muted">â€”</span>' : `<span class="mono">â‚ª${fmt(basePricePerMl(m), 4)}</span>`}
        </td>
        <td>
          ${m.diluted ? `<span class="chip">DPG ${fmt(m.dilutionPercent || 0, 0)}%</span>` : '<span class="muted">â€”</span>'}
        </td>
        <td>
          ${canEdit() ? `
          <div class="row" style="gap:6px">
            <button class="btn" data-edit="${m.id}">âœï¸</button>
            <button class="btn danger" data-del="${m.id}">ðŸ—‘ï¸</button>
          </div>
          ` : ''}
        </td>
      </tr>
    `).join("");

    if (needsFullRender) {
      wireToggles(left);
      $("matQ").oninput = (e) => { state._matQ = e.target.value; renderMaterials(); };
      $("matCat").onchange = (e) => { state._matCat = e.target.value; renderMaterials(); };
      $("matSort").onchange = (e) => { state.ui.sortMaterials = e.target.value; saveState(); renderMaterials(); };
      if ($("btnAddMat")) $("btnAddMat").onclick = () => openMaterialEditor();
    }

    $("matListBody").querySelectorAll("[data-edit]").forEach(btn => {
      btn.onclick = () => openMaterialEditor(btn.getAttribute("data-edit"));
    });
    $("matListBody").querySelectorAll("[data-del]").forEach(btn => {
      btn.onclick = () => deleteMaterial(btn.getAttribute("data-del"));
    });
  };

  const openMaterialEditor = (id = null) => {
    const isNew = !id;
    const m = isNew ? {
      id: uid(),
      name: "",
      code: "",
      category: "×ª×ž×¦×™×•×ª",
      desc: "",
      pricePerKg: null,
      pricePerMl: null,
      diluted: false,
      dilutionPercent: 50
    } : { ...getMaterial(id) };

    if (!m) return;

    const renderMaterialForm = () => {
      fpBody.innerHTML = `
        <div class="row">
          <div class="field" style="flex:2"><label>×©×</label><input id="m_name" value="${escapeHtml(m.name)}" placeholder="×©× ×”×—×•×ž×¨"></div>
          <div class="field"><label>×§×•×“ (××•×¤×¦×™×•× ×œ×™)</label><input id="m_code" value="${escapeHtml(m.code || "")}" placeholder="×§×•×“ ×–×™×”×•×™"></div>
        </div>
        <div class="row" style="margin-top:12px">
          <div class="field"><label>×§×˜×’×•×¨×™×”</label><select id="m_cat">${categoryOptions(m.category)}</select></div>
        </div>
        <div class="row" style="margin-top:12px">
          <div class="field ${state.ui.hidePrices ? 'hidden' : ''}">
            <label>×ž×—×™×¨ â‚ª ×œ×§"×’</label>
            <input id="m_priceKg" inputmode="decimal" value="${m.pricePerKg ?? ""}" placeholder="×œ×“×•×’×ž×”: 300">
          </div>
          <div class="field ${state.ui.hidePrices ? 'hidden' : ''}">
            <label>×ž×—×™×¨ â‚ª ×œ-ml (××•×¤×¦×™×•× ×œ×™)</label>
            <input id="m_priceMl" inputmode="decimal" value="${m.pricePerMl ?? ""}" placeholder="×¨×™×§ = ×—×™×©×•×‘ ××•×˜×•×ž×˜×™">
          </div>
        </div>
        <div class="field" style="margin-top:12px">
          <label>×ª×™××•×¨</label>
          <textarea id="m_desc" style="min-height:120px">${escapeHtml(m.desc || "")}</textarea>
        </div>
        <div class="hr"></div>
        <div class="card" style="background:rgba(255,255,255,0.03);padding:16px">
          <div class="row" style="align-items:center;gap:12px">
            <label style="min-width:120px;font-weight:600">×ž×“×•×œ×œ ×‘-DPG?</label>
            <input type="checkbox" id="m_dil" ${m.diluted ? "checked" : ""} style="width:28px;height:28px">
            <span class="small muted">×—×™×©×•×‘ ×”×ž×—×™×¨ ×™×›×œ×•×œ DPG ×œ×¤×™ ×”××—×•×–</span>
          </div>
          <div id="dilBox" class="${m.diluted ? '' : 'hidden'}" style="margin-top:16px">
            <div class="field">
              <label>××—×•×– ×—×•×ž×¨ ×¤×¢×™×œ (×”×©××¨ DPG)</label>
              <input id="m_dilPct" inputmode="numeric" value="${m.dilutionPercent ?? 50}" placeholder="50" style="font-size:1.2rem">
              <div class="small muted" style="margin-top:4px">×œ×“×•×’×ž×”: 10 = ×“×™×œ×•×œ 10% (90% DPG)</div>
            </div>
          </div>
        </div>
        <div class="hr"></div>
        <div class="row" style="justify-content:flex-end;gap:12px">
          <button class="btn" id="m_cancel">×‘×™×˜×•×œ</button>
          <button class="btn primary" id="m_save">ðŸ’¾ ×©×ž×•×¨</button>
        </div>
      `;

      $("m_dil").onchange = () => $("dilBox").classList.toggle("hidden", !$("m_dil").checked);
      $("m_cancel").onclick = () => { closeFullPage(); render(); };
      $("m_save").onclick = () => {
        const name = $("m_name").value.trim();
        if (!name) { alert("×—×•×‘×” ×©×"); return; }

        const updated = {
          ...m,
          name,
          code: $("m_code").value.trim(),
          category: $("m_cat").value,
          desc: $("m_desc").value.trim(),
          pricePerKg: $("m_priceKg").value.trim() === "" ? null : num($("m_priceKg").value),
          pricePerMl: $("m_priceMl").value.trim() === "" ? null : num($("m_priceMl").value),
          diluted: $("m_dil").checked,
          dilutionPercent: $("m_dil").checked ? clamp(num($("m_dilPct").value, 50), 0, 100) : null
        };

        const idx = state.materials.findIndex(x => x.id === m.id);
        if (idx >= 0) state.materials[idx] = updated;
        else state.materials.unshift(updated);

        saveState();
        closeFullPage();
        render();
      };
    };

    openFullPage({
      title: isNew ? "×”×•×¡×¤×ª ×—×•×ž×¨ ×’×œ×" : "×¢×¨×™×›×ª ×—×•×ž×¨ ×’×œ×",
      pill: m.category || "",
      body: ""
    });
    renderMaterialForm();
  };

  const deleteMaterial = (id) => {
    const mat = getMaterial(id);
    if (!mat) return;
    if (id === "MAT_DPG") { alert("×œ× × ×™×ª×Ÿ ×œ×ž×—×•×§ DPG - × ×“×¨×© ×œ×—×™×©×•×‘×™ ×“×™×œ×•×œ"); return; }
    if (!confirm(`×œ×ž×—×•×§ ××ª "${mat.name}"?`)) return;

    pushUndo("deleteMaterial", `× ×ž×—×§ ×—×•×ž×¨ ×’×œ×: ${mat.name}`);
    state.materials = state.materials.filter(m => m.id !== id);
    // Clean from formulas
    const clean = (p) => { p.rows = (p.rows || []).filter(r => r.materialId !== id); return p; };
    state.perfumesDev = state.perfumesDev.map(clean);
    state.perfumesFinal = state.perfumesFinal.map(clean);

    saveState();
    render();
  };

  // ==================== PRICING PAGE ====================
  const renderPricing = () => {
    const left = $("leftPanel");
    const right = $("rightPanel");
    const q = (state._priceQ || "").toLowerCase();
    const cat = state._priceCat || "×”×›×œ";

    let items = state.materials.filter(m => cat === "×”×›×œ" || m.category === cat);
    if (q) items = items.filter(m => ((m.name || "") + " " + (m.code || "")).toLowerCase().includes(q));

    const needsFullRender = !$("prQ") || !$("priceListBody");

    if (needsFullRender) {
      left.innerHTML = `
        <h2>ðŸ’° ×”×–× ×ª ×ž×—×™×¨×™×</h2>
        <div class="small">×¢×“×›×•×Ÿ ×ž×—×™×¨×™× ×ž×¨×•×›×– - ×”×–×Ÿ ×ž×—×™×¨ ×œ-×§"×’ ××• ×œ-ml (×”×ž×¢×¨×›×ª ×ª×—×©×‘ ××•×˜×•×ž×˜×™×ª)</div>
        <div class="hr"></div>
        <div class="row">
          <div class="field" style="flex:2">
            <label>×—×™×¤×•×©</label>
            <input id="prQ" value="${escapeHtml(state._priceQ || "")}" placeholder="×©× ××• ×§×•×“...">
          </div>
          <div class="field">
            <label>×§×˜×’×•×¨×™×”</label>
            <select id="prCat">
              <option value="×”×›×œ" ${cat === "×”×›×œ" ? "selected" : ""}>×”×›×œ</option>
              ${categoryOptions(cat)}
            </select>
          </div>
        </div>
        <div class="row" style="margin-top:12px">
          <button class="btn success" id="prSave">ðŸ’¾ ×©×ž×•×¨ ×ž×—×™×¨×™×</button>
          <div class="pill" id="priceCount">×¤×¨×™×˜×™×: ${items.length}</div>
        </div>

        <div class="hr"></div>
        <h3 style="color:var(--accent);margin:12px 0">ðŸ“Š ×—×™×©×•×‘ ×¢×œ×•×ª ×¤×•×¨×ž×•×œ×”</h3>
        <div class="field">
          <label>×‘×—×¨ ×¤×•×¨×ž×•×œ×”</label>
          <select id="perfSelect">
            <optgroup label="×¤×™×ª×•×—×™×">
              ${state.perfumesDev.map(p => `<option value="dev:${p.id}">${escapeHtml(p.name)}${p.code ? ` â€¢ ${p.code}` : ""}</option>`).join("")}
            </optgroup>
            <optgroup label="×‘×©×ž×™× ×¡×•×¤×™×™×">
              ${state.perfumesFinal.map(p => `<option value="final:${p.id}">${escapeHtml(p.name)}${p.code ? ` â€¢ ${p.code}` : ""}</option>`).join("")}
            </optgroup>
          </select>
        </div>
        <div class="row" style="margin-top:12px">
          <button class="btn primary" id="calcCost">×—×©×‘ ×¢×œ×•×ª</button>
        </div>
        <div id="costResult" style="margin-top:12px"></div>
      `;

      right.innerHTML = `
        <h2>×˜×‘×œ×ª ×ž×—×™×¨×™×</h2>
        <div class="small" style="margin-bottom:12px">×”×–×Ÿ ×ž×—×™×¨ ×œ-×§"×’ ××• ×œ-ml â€¢ ×¡×ž×Ÿ ×× ×ž×“×•×œ×œ ×‘-DPG</div>
        <div class="table-wrap">
          <table>
            <thead><tr>
              <th style="width:35%">×—×•×ž×¨</th>
              <th style="width:18%">â‚ª/×§"×’</th>
              <th style="width:18%">â‚ª/ml</th>
              <th style="width:12%">×ž×“×•×œ×œ?</th>
              <th style="width:12%">% ×—×•×ž×¨</th>
              <th style="width:15%">×¢×œ×•×ª/ml</th>
            </tr></thead>
            <tbody id="priceListBody"></tbody>
          </table>
        </div>
      `;
    }

    // Update count
    if ($("priceCount")) $("priceCount").textContent = `×¤×¨×™×˜×™×: ${items.length}`;

    // Update list
    $("priceListBody").innerHTML = items.map(m => {
      const effPrice = effectivePricePerMl(m);
      return `
        <tr class="tr">
          <td>
            <div style="font-weight:600">${escapeHtml(materialDisplayName(m, "list"))}</div>
            <div class="small">${escapeHtml(m.category)}</div>
          </td>
          <td>
            <input data-pricekg="${m.id}" inputmode="decimal" value="${m.pricePerKg ?? ""}" placeholder="â€”" style="width:70px">
          </td>
          <td>
            <input data-priceml="${m.id}" inputmode="decimal" value="${m.pricePerMl ?? ""}" placeholder="â€”" style="width:70px">
          </td>
          <td style="text-align:center">
            <input type="checkbox" data-diluted="${m.id}" ${m.diluted ? "checked" : ""} style="width:20px;height:20px">
          </td>
          <td>
            <input data-dilpct="${m.id}" inputmode="numeric" value="${m.diluted ? (m.dilutionPercent ?? 50) : ""}" placeholder="50" style="width:50px" ${m.diluted ? "" : "disabled"}>
          </td>
          <td class="mono" style="color:var(--accent)">
            ${effPrice == null ? '<span class="muted">â€”</span>' : `â‚ª${fmt(effPrice, 4)}`}
          </td>
        </tr>
      `;
    }).join("");

    if (needsFullRender) {
      $("prQ").oninput = (e) => { state._priceQ = e.target.value; renderPricing(); };
      $("prCat").onchange = (e) => { state._priceCat = e.target.value; renderPricing(); };

      $("prSave").onclick = () => {
        $("priceListBody").querySelectorAll("tr").forEach(row => {
          const kgInp = row.querySelector("[data-pricekg]");
          const mlInp = row.querySelector("[data-priceml]");
          const dilChk = row.querySelector("[data-diluted]");
          const dilPct = row.querySelector("[data-dilpct]");
          
          if (!kgInp) return;
          const id = kgInp.getAttribute("data-pricekg");
          const m = getMaterial(id);
          if (m) {
            m.pricePerKg = kgInp.value.trim() === "" ? null : num(kgInp.value);
            m.pricePerMl = mlInp.value.trim() === "" ? null : num(mlInp.value);
            m.diluted = dilChk.checked;
            m.dilutionPercent = dilChk.checked ? clamp(num(dilPct.value, 50), 1, 99) : null;
          }
        });
        saveState();
        renderPricing(); // Refresh to show updated effective prices
        alert("× ×©×ž×¨!");
      };

      $("calcCost").onclick = () => {
        const val = $("perfSelect").value;
        if (!val) return;
        const [mode, id] = val.split(":");
        const perf = (mode === "final" ? state.perfumesFinal : state.perfumesDev).find(p => p.id === id);
        if (!perf) return;

        const calc = computeFormula(perf);
        const missing = [];
        (perf.rows || []).forEach(r => {
          const m = getMaterial(r.materialId);
          if (effectivePricePerMl(m) == null && r.ml > 0) {
            missing.push(m ? m.name : r.materialId);
          }
        });

        let html = `<div class="pill" style="font-size:1.1rem;padding:10px 16px;background:var(--accent);color:var(--bg)">×¢×œ×•×ª: â‚ª${calc.totalCost == null ? "â€”" : fmt(calc.totalCost, 2)}</div>`;
        if (missing.length) {
          html += `<div class="warn-box" style="margin-top:8px"><strong>×—×¡×¨×™× ×ž×—×™×¨×™×:</strong><br>${missing.join(", ")}</div>`;
        }
        $("costResult").innerHTML = html;
      };
    }

    // Wire diluted checkbox toggle
    $("priceListBody").querySelectorAll("[data-diluted]").forEach(chk => {
      chk.onchange = () => {
        const id = chk.getAttribute("data-diluted");
        const row = chk.closest("tr");
        const pctInput = row.querySelector("[data-dilpct]");
        pctInput.disabled = !chk.checked;
        if (!chk.checked) pctInput.value = "";
        else if (!pctInput.value) pctInput.value = "50";
      };
    });

    // Auto-save on blur (always rewire since list changes)
    $("priceListBody").querySelectorAll("[data-price]").forEach(inp => {
      inp.onblur = () => {
        const id = inp.getAttribute("data-price");
        const m = getMaterial(id);
        if (m) {
          m.pricePerMl = inp.value.trim() === "" ? null : num(inp.value);
          saveState();
        }
      };
    });
  };

  // ==================== PERFUMES PAGES ====================
  const getPerfumeList = (mode) => mode === "final" ? state.perfumesFinal : state.perfumesDev;
  const setPerfumeList = (mode, list) => { if (mode === "final") state.perfumesFinal = list; else state.perfumesDev = list; };
  const findPerfume = (mode, id) => getPerfumeList(mode).find(p => p.id === id) || null;

  const basePerfume = () => ({
    id: uid(),
    name: "",
    code: "",
    inspiredBy: "",
    notes: "",
    date: todayISO(),
    updatedAt: todayISO(),
    qtyMl: state.defaultQty || 50,
    rows: [],
    marketingText: "",
    notesTop: "",
    notesHeart: "",
    notesBase: ""
  });

  const renderPerfumes = (mode) => {
    const isFinal = mode === "final";
    const list = getPerfumeList(mode);
    const left = $("leftPanel");
    const right = $("rightPanel");

    const q = ((isFinal ? state._finalQ : state._devQ) || "").toLowerCase();
    let filtered = list.filter(p => {
      // Search in basic fields
      const basicMatch = ((p.name || "") + " " + (p.code || "") + " " + (p.inspiredBy || "") + " " + (p.notes || "")).toLowerCase().includes(q);
      if (basicMatch) return true;
      // Also search in ingredient names
      if (p.rows && p.rows.length > 0) {
        return p.rows.some(r => {
          const mat = getMaterial(r.materialId);
          return mat && ((mat.name || "") + " " + (mat.code || "")).toLowerCase().includes(q);
        });
      }
      return false;
    });

    // Sorting
    const sortKey = isFinal ? state.ui.sortFinal : state.ui.sortDev || "new";
    if (sortKey === "az") filtered.sort((a, b) => (a.name || "").localeCompare(b.name || "", "he"));
    else if (sortKey === "za") filtered.sort((a, b) => (b.name || "").localeCompare(a.name || "", "he"));
    else if (sortKey === "old") filtered.sort((a, b) => (a.updatedAt || a.date || "").localeCompare(b.updatedAt || b.date || ""));
    else filtered.sort((a, b) => (b.updatedAt || b.date || "").localeCompare(a.updatedAt || a.date || ""));

    // Check if we need full render or just list update
    const needsFullRender = !$("perfQ") || !$("perfListBody");
    
    if (needsFullRender) {
      left.innerHTML = `
        <h2>${isFinal ? "âœ¨ ×‘×©×ž×™× ×¡×•×¤×™×™×" : "ðŸ§ª ×¤×™×ª×•×—×™×"}</h2>
        ${renderToggles()}
        <div class="hr"></div>
        <div class="row">
          <div class="field" style="flex:2">
            <label>×—×™×¤×•×©</label>
            <input id="perfQ" value="${escapeHtml(isFinal ? state._finalQ : state._devQ || "")}" placeholder="×©×, ×§×•×“, ×¨×›×™×‘, ×‘×”×©×¨××ª...">
          </div>
          <div class="field">
            <label>×›×ž×•×ª ×‘×¨×™×¨×ª ×ž×—×“×œ (ml)</label>
            <input id="defQty" inputmode="numeric" value="${state.defaultQty || 50}">
          </div>
        </div>
        <div class="row" style="margin-top:12px">
          <div class="field">
            <label>×ž×™×•×Ÿ</label>
            <select id="perfSort">
              <option value="new" ${sortKey === "new" ? "selected" : ""}>×ž×”×—×“×©</option>
              <option value="old" ${sortKey === "old" ? "selected" : ""}>×ž×”×™×©×Ÿ</option>
              <option value="az" ${sortKey === "az" ? "selected" : ""}>×-×ª</option>
              <option value="za" ${sortKey === "za" ? "selected" : ""}>×ª-×</option>
            </select>
          </div>
          ${canEdit() ? `<button class="btn primary" id="btnAddPerf">+ ×¤×•×¨×ž×•×œ×” ×—×“×©×”</button>` : ''}
          <div class="pill" id="perfCount">×¡×”"×›: ${filtered.length}</div>
        </div>
      `;

      right.innerHTML = `
        <h2>×¨×©×™×ž×ª ${isFinal ? "×‘×©×ž×™×" : "×¤×™×ª×•×—×™×"}</h2>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th style="width:45%">×‘×•×©×</th>
                <th style="width:25%">×¡×˜×˜×•×¡</th>
                <th style="width:30%">×¤×¢×•×œ×•×ª</th>
              </tr>
            </thead>
            <tbody id="perfListBody"></tbody>
          </table>
        </div>
      `;
    }

    // Update just the list and count
    if ($("perfCount")) $("perfCount").textContent = `×¡×”"×›: ${filtered.length}`;
    
    const listHtml = filtered.map(p => {
      const calc = computeFormula(p);
      const ok = Math.abs(calc.totalPct - 100) < 0.05;
      return `
        <tr class="tr">
          <td>
            <div style="font-weight:700;font-size:1rem">${escapeHtml(p.name)} ${p.code ? `<span class="mono muted">â€¢ ${escapeHtml(p.code)}</span>` : ""}</div>
            ${state.ui.hideInspired ? "" : `<div class="small">×‘×”×©×¨××ª: ${escapeHtml(p.inspiredBy || "â€”")}</div>`}
            <div class="small">×¢×•×“×›×Ÿ: ${escapeHtml(p.updatedAt || p.date || todayISO())}</div>
          </td>
          <td>
            <span class="chip ${ok ? '' : 'warn'}">${fmt(calc.totalPct, 1)}%</span>
            ${state.ui.hidePrices ? "" : `<div class="small mono" style="margin-top:4px">${calc.totalCost == null ? "â€”" : `â‚ª${fmt(calc.totalCost, 2)}`}</div>`}
          </td>
          <td>
            <div class="row" style="gap:6px;flex-wrap:wrap">
              <button class="btn" data-view="${p.id}">ðŸ‘ï¸</button>
              ${canEdit() ? `
              <button class="btn" data-edit="${p.id}">âœï¸</button>
              <button class="btn" data-dup="${p.id}" title="×©×›×¤×œ ×¤×•×¨×ž×•×œ×”">ðŸ“‹</button>
              <button class="btn danger" data-del="${p.id}">ðŸ—‘ï¸</button>
              ${isFinal ? "" : `<button class="btn success" data-toFinal="${p.id}">âœ¨</button>`}
              ` : ''}
            </div>
          </td>
        </tr>
      `;
    }).join("");
    
    $("perfListBody").innerHTML = listHtml;

    if (needsFullRender) {
      wireToggles(left);
      $("perfQ").oninput = (e) => {
        if (isFinal) state._finalQ = e.target.value;
        else state._devQ = e.target.value;
        renderPerfumes(mode);
      };
      $("defQty").onchange = (e) => {
        state.defaultQty = clamp(num(e.target.value, 50), 1, 100000);
        saveState();
      };
      $("perfSort").onchange = (e) => {
        if (isFinal) state.ui.sortFinal = e.target.value;
        else state.ui.sortDev = e.target.value;
        saveState();
        renderPerfumes(mode);
      };
      if ($("btnAddPerf")) $("btnAddPerf").onclick = () => openPerfumeEditor(mode);
    }

    // Always re-wire list buttons (list gets re-rendered on search)
    $("perfListBody").querySelectorAll("[data-view]").forEach(btn => {
      btn.onclick = () => openPerfumeViewer(mode, btn.getAttribute("data-view"));
    });
    $("perfListBody").querySelectorAll("[data-edit]").forEach(btn => {
      btn.onclick = () => openPerfumeEditor(mode, btn.getAttribute("data-edit"));
    });
    $("perfListBody").querySelectorAll("[data-del]").forEach(btn => {
      btn.onclick = () => deletePerfume(mode, btn.getAttribute("data-del"));
    });
    $("perfListBody").querySelectorAll("[data-toFinal]").forEach(btn => {
      btn.onclick = () => moveToFinal(btn.getAttribute("data-toFinal"));
    });
    $("perfListBody").querySelectorAll("[data-dup]").forEach(btn => {
      btn.onclick = () => duplicatePerfume(mode, btn.getAttribute("data-dup"));
    });
  };

  // Duplicate perfume function
  const duplicatePerfume = (mode, id) => {
    const p = findPerfume(mode, id);
    if (!p) return;
    const copy = JSON.parse(JSON.stringify(p));
    copy.id = uid();
    copy.name = p.name + " (×¢×•×ª×§)";
    copy.updatedAt = todayISO();
    copy.date = todayISO();
    if (mode === "dev") {
      state.perfumesDev.unshift(copy);
    } else {
      state.perfumesFinal.unshift(copy);
    }
    saveState();
    render();
    alert(`âœ… ×”×¤×•×¨×ž×•×œ×” "${p.name}" ×©×•×›×¤×œ×” ×‘×”×¦×œ×—×”!`);
  };

  const deletePerfume = (mode, id) => {
    const p = findPerfume(mode, id);
    if (!p) return;
    if (!confirm(`×œ×ž×—×•×§ ××ª "${p.name}"?`)) return;
    pushUndo("deletePerfume", `× ×ž×—×§×” ×¤×•×¨×ž×•×œ×”: ${p.name}`);
    setPerfumeList(mode, getPerfumeList(mode).filter(x => x.id !== id));
    saveState();
    render();
  };

  const moveToFinal = (devId) => {
    const p = findPerfume("dev", devId);
    if (!p) return;
    const copy = JSON.parse(JSON.stringify(p));
    copy.id = uid();
    copy.updatedAt = todayISO();
    state.perfumesFinal.unshift(copy);
    state.perfumesDev = state.perfumesDev.filter(x => x.id !== devId);
    saveState();
    render();
  };

  const openPerfumeViewer = (mode, id) => {
    const isFinal = mode === "final";
    const p = findPerfume(mode, id);
    if (!p) return;

    const calc = computeFormula(p);
    const pctOk = Math.abs(calc.totalPct - 100) < 0.05;
    const groups = groupRowsByCategory(p.rows || []);

    let categoriesHtml = "";
    const cats = Object.keys(groups).filter(c => !(state.ui.hideEssences && c === "×ª×ž×¦×™×•×ª"));

    cats.forEach(cat => {
      const rows = groups[cat];
      categoriesHtml += `
        <div class="cat-section">
          <div class="cat-header">
            <span class="chip">${escapeHtml(cat)}</span>
            <span class="small">${rows.length} ×¨×›×™×‘×™×</span>
          </div>
          ${rows.map(r => {
            const m = getMaterial(r.materialId);
            const ml = num(r.ml, 0);
            const pct = calc.qty > 0 ? (ml / calc.qty * 100) : 0;
            const eff = effectivePricePerMl(m);
            const cost = eff == null ? null : ml * eff;
            return `
              <div class="cat-row">
                <div class="name">${escapeHtml(m ? materialDisplayName(m) : "â€”")}</div>
                <div class="ml-col mono">${fmt(ml, 2)} ml</div>
                <div class="pct-col mono">${fmt(pct, 2)}%</div>
                ${state.ui.hidePrices ? "" : `<div class="cost-col mono">${cost == null ? "â€”" : `â‚ª${fmt(cost, 2)}`}</div>`}
              </div>
            `;
          }).join("")}
        </div>
      `;
    });

    openFullPage({
      title: p.name,
      pill: isFinal ? "×¡×•×¤×™" : "×¤×™×ª×•×—",
      body: `
        <div class="row between" style="margin-bottom:16px">
          <div>
            <div style="font-size:1.3rem;font-weight:800;color:var(--accent)">${escapeHtml(p.name)} ${p.code ? `<span class="mono muted">â€¢ ${escapeHtml(p.code)}</span>` : ""}</div>
            ${state.ui.hideInspired ? "" : `<div class="small">×‘×”×©×¨××ª: ${escapeHtml(p.inspiredBy || "â€”")}</div>`}
            <div class="small">×ª××¨×™×š: ${escapeHtml(p.date || todayISO())}</div>
          </div>
          <span class="chip">${isFinal ? "×¡×•×¤×™" : "×¤×™×ª×•×—"}</span>
        </div>

        <div class="stats">
          <div class="stat">
            <div class="k">×›×ž×•×ª</div>
            <div class="v mono">${fmt(calc.qty, 0)} ml</div>
          </div>
          <div class="stat">
            <div class="k">×¡×”"×› ×‘×¤×•×¨×ž×•×œ×”</div>
            <div class="v mono">${fmt(calc.totalMl, 2)} ml</div>
          </div>
          <div class="stat">
            <div class="k">×¡×”"×› %</div>
            <div class="v ${pctOk ? 'ok' : 'warn'}">${fmt(calc.totalPct, 1)}%</div>
            <div class="bar ${calc.totalPct > 100 ? 'over' : ''}"><div style="width:${clamp(calc.totalPct, 0, 100)}%"></div></div>
          </div>
          ${state.ui.hidePrices ? "" : `
            <div class="stat">
              <div class="k">×¢×œ×•×ª ×›×•×œ×œ×ª</div>
              <div class="v">${calc.totalCost == null ? '<span class="muted">â€”</span>' : `â‚ª${fmt(calc.totalCost, 2)}`}</div>
              <div class="small">${calc.costPerMl == null ? "" : `â‚ª${fmt(calc.costPerMl, 4)} ×œ-ml`}</div>
            </div>
          `}
        </div>

        ${isFinal ? `
          <div class="section-title">×ª×™××•×¨ ×©×™×•×•×§×™</div>
          <div class="card" style="background:rgba(255,255,255,0.03);padding:16px">
            ${escapeHtml(p.marketingText || "â€”").replace(/\n/g, "<br>")}
          </div>
          <div class="section-title">×ª×•×•×™×</div>
          <div class="row" style="gap:12px">
            <div class="card" style="flex:1;padding:12px;background:rgba(255,255,255,0.03)">
              <div class="chip" style="margin-bottom:8px">ðŸ” ×¨××©</div>
              <div>${escapeHtml(p.notesTop || "â€”")}</div>
              ${p.imgTop ? `<a href="${escapeHtml(p.imgTop)}" target="_blank" class="btn" style="margin-top:8px;font-size:0.8rem">ðŸ“ ×ª×ž×•× ×•×ª</a>` : ""}
            </div>
            <div class="card" style="flex:1;padding:12px;background:rgba(255,255,255,0.03)">
              <div class="chip" style="margin-bottom:8px">ðŸ’— ×œ×‘</div>
              <div>${escapeHtml(p.notesHeart || "â€”")}</div>
              ${p.imgHeart ? `<a href="${escapeHtml(p.imgHeart)}" target="_blank" class="btn" style="margin-top:8px;font-size:0.8rem">ðŸ“ ×ª×ž×•× ×•×ª</a>` : ""}
            </div>
            <div class="card" style="flex:1;padding:12px;background:rgba(255,255,255,0.03)">
              <div class="chip" style="margin-bottom:8px">ðŸŒ³ ×‘×¡×™×¡</div>
              <div>${escapeHtml(p.notesBase || "â€”")}</div>
              ${p.imgBase ? `<a href="${escapeHtml(p.imgBase)}" target="_blank" class="btn" style="margin-top:8px;font-size:0.8rem">ðŸ“ ×ª×ž×•× ×•×ª</a>` : ""}
            </div>
          </div>
        ` : ""}

        ${p.notes ? `
          <div class="section-title">×”×¢×¨×•×ª</div>
          <div class="card" style="background:rgba(255,255,255,0.03);padding:12px">
            ${escapeHtml(p.notes).replace(/\n/g, "<br>")}
          </div>
        ` : ""}

        <div class="section-title">×”×¨×›×‘</div>
        ${categoriesHtml || '<div class="muted">××™×Ÿ ×¨×›×™×‘×™×</div>'}
      `
    });
  };

  const openPerfumeEditor = (mode, id = null) => {
    const isFinal = mode === "final";
    const isNew = !id;
    let p = isNew ? basePerfume() : JSON.parse(JSON.stringify(findPerfume(mode, id)));
    if (!p) return;

    // Add default fixed materials for new perfumes
    if (isNew) {
      ["MAT_CIT", "MAT_DPG", "MAT_ISO", "MAT_ALC"].forEach(mid => {
        if (getMaterial(mid)) p.rows.push({ id: uid(), materialId: mid, ml: 0, catHint: "×§×‘×•×¢×™×" });
      });
    }

    const renderEditor = () => {
      const calc = computeFormula(p);
      const pctOk = Math.abs(calc.totalPct - 100) < 0.05;
      const groups = groupRowsByCategory(p.rows);
      const cats = CATEGORIES.filter(c => !(state.ui.hideEssences && c === "×ª×ž×¦×™×•×ª"));

      let rowsHtml = `
        <div class="cat-header-row" style="display:flex;gap:12px;padding:8px 12px;background:var(--panel2);border-radius:8px;margin-bottom:12px;font-size:0.85rem;color:var(--muted);position:sticky;top:0;z-index:10">
          <div style="flex:2">×—×•×ž×¨</div>
          <div style="width:80px;text-align:center">×ž"×œ</div>
          <div style="width:60px;text-align:center">%</div>
          ${state.ui.hidePrices ? "" : `<div style="width:80px;text-align:center">×¢×œ×•×ª</div>`}
          <div style="width:50px"></div>
        </div>
      `;
      cats.forEach(cat => {
        // For ×§×‘×•×¢×™× - use fixed order. For other categories - keep user order (no sorting)
        const rows = (groups[cat] || []);
        if (cat === "×§×‘×•×¢×™×") {
          rows.sort((a, b) => {
            const order = ["MAT_CIT", "MAT_DPG", "MAT_ISO", "MAT_ALC"];
            return order.indexOf(a.materialId) - order.indexOf(b.materialId);
          });
        }
        // Other categories: no sorting - keep original order from p.rows

        rowsHtml += `
          <div class="cat-section">
            <div class="cat-header">
              <span class="chip">${escapeHtml(cat)}</span>
              <button class="btn primary" style="padding:6px 12px" data-addrow="${cat}">+ ×”×•×¡×£</button>
            </div>
            ${rows.length ? rows.map(r => {
              const m = getMaterial(r.materialId);
              const ml = num(r.ml, 0);
              const pct = p.qtyMl > 0 ? (ml / p.qtyMl * 100) : 0;
              const eff = effectivePricePerMl(m);
              const cost = eff == null ? null : ml * eff;
              return `
                <div class="cat-row">
                  <div class="name">
                    <select data-row="${r.id}" data-cat="${cat}" style="max-width:200px">
                      ${buildMaterialOptions(cat, r.materialId)}
                    </select>
                  </div>
                  <div class="ml-col">
                    <input data-ml="${r.id}" inputmode="decimal" value="${ml}" style="width:80px;text-align:center">
                  </div>
                  <div class="pct-col mono">${fmt(pct, 2)}%</div>
                  ${state.ui.hidePrices ? "" : `<div class="cost-col mono">${cost == null ? "â€”" : `â‚ª${fmt(cost, 2)}`}</div>`}
                  <div class="action-col">
                    <button class="btn danger" data-delrow="${r.id}" style="padding:6px 10px">âœ•</button>
                  </div>
                </div>
              `;
            }).join("") : '<div class="muted" style="padding:10px">××™×Ÿ ×©×•×¨×•×ª ×‘×§×˜×’×•×¨×™×”</div>'}
          </div>
        `;
      });

      fpBody.innerHTML = `
        <div class="row">
          <div class="field" style="flex:2"><label>×©×</label><input id="p_name" value="${escapeHtml(p.name)}" placeholder="×©× ×”×‘×•×©×"></div>
          <div class="field"><label>×§×•×“</label><input id="p_code" value="${escapeHtml(p.code || "")}" placeholder="EN-..."></div>
        </div>
        ${state.ui.hideInspired ? "" : `
          <div class="field" style="margin-top:12px">
            <label>×‘×”×©×¨××ª</label>
            <input id="p_insp" value="${escapeHtml(p.inspiredBy || "")}" placeholder="×©× ×”×‘×•×©× ×”×ž×§×•×¨×™...">
          </div>
        `}
        <div class="row" style="margin-top:12px">
          <div class="field" style="flex:2">
            <label>×”×¢×¨×•×ª</label>
            <textarea id="p_notes" style="min-height:60px">${escapeHtml(p.notes || "")}</textarea>
          </div>
          <div class="field">
            <label>×ª××¨×™×š</label>
            <input id="p_date" type="date" value="${p.date || todayISO()}">
          </div>
          <div class="field">
            <label>×›×ž×•×ª (ml)</label>
            <input id="p_qty" inputmode="decimal" value="${p.qtyMl}">
          </div>
        </div>

        ${isFinal ? `
          <div class="section-title">×ª×™××•×¨ ×©×™×•×•×§×™</div>
          <textarea id="p_mkt" style="min-height:80px">${escapeHtml(p.marketingText || "")}</textarea>
          <div class="section-title">×ª×•×•×™×</div>
          <div class="row">
            <div class="field"><label>ðŸ” ×¨××©</label><input id="p_top" value="${escapeHtml(p.notesTop || "")}"></div>
            <div class="field"><label>ðŸ’— ×œ×‘</label><input id="p_heart" value="${escapeHtml(p.notesHeart || "")}"></div>
            <div class="field"><label>ðŸŒ³ ×‘×¡×™×¡</label><input id="p_base" value="${escapeHtml(p.notesBase || "")}"></div>
          </div>
          <div class="section-title">×§×™×©×•×¨×™ ×ª×ž×•× ×•×ª ×ª×•×•×™×</div>
          <div class="row">
            <div class="field"><label>ðŸ“ ×ª×™×§×™×™×ª ×¨××©</label><input id="p_imgTop" value="${escapeHtml(p.imgTop || "")}" placeholder="×§×™×©×•×¨ ×œ×ª×™×§×™×™×ª Google Drive..."></div>
            <div class="field"><label>ðŸ“ ×ª×™×§×™×™×ª ×œ×‘</label><input id="p_imgHeart" value="${escapeHtml(p.imgHeart || "")}" placeholder="×§×™×©×•×¨ ×œ×ª×™×§×™×™×ª Google Drive..."></div>
            <div class="field"><label>ðŸ“ ×ª×™×§×™×™×ª ×‘×¡×™×¡</label><input id="p_imgBase" value="${escapeHtml(p.imgBase || "")}" placeholder="×§×™×©×•×¨ ×œ×ª×™×§×™×™×ª Google Drive..."></div>
          </div>
        ` : ""}

        <div class="section-title">×”×¨×›×‘</div>
        <div class="row" style="margin-bottom:12px">
          <button class="btn primary" id="refreshCalc">ðŸ”„ ×—×©×‘ ×¢×œ×•×ª</button>
          <button class="btn" id="normalize">âš–ï¸ ×”×©×œ× ×œ-100%</button>
          <div class="pill" id="sumPill">
            ×¡×”"×›: <span class="${pctOk ? 'ok' : 'warn'}">${fmt(calc.totalPct, 1)}%</span>
            ${state.ui.hidePrices ? "" : (calc.totalCost == null ? "" : ` â€¢ â‚ª${fmt(calc.totalCost, 2)}`)}
          </div>
        </div>
        ${rowsHtml}

        <div class="hr"></div>
        <div class="row" style="justify-content:flex-end">
          <button class="btn" id="p_cancel">×‘×™×˜×•×œ</button>
          <button class="btn primary" id="p_save">ðŸ’¾ ×©×ž×•×¨</button>
        </div>
      `;

      // Wire events
      $("p_qty").onblur = () => {
        p.qtyMl = clamp(num($("p_qty").value, 50), 0, 100000);
      };

      $("refreshCalc").onclick = () => {
        // Update all ml values from inputs before recalculating
        fpBody.querySelectorAll("[data-ml]").forEach(inp => {
          const rid = inp.getAttribute("data-ml");
          const row = p.rows.find(r => r.id === rid);
          if (row) row.ml = clamp(num(inp.value, 0), 0, 100000);
        });
        p.qtyMl = clamp(num($("p_qty").value, 50), 0, 100000);
        renderEditor();
      };

      $("normalize").onclick = () => {
        // First update all values
        fpBody.querySelectorAll("[data-ml]").forEach(inp => {
          const rid = inp.getAttribute("data-ml");
          const row = p.rows.find(r => r.id === rid);
          if (row) row.ml = clamp(num(inp.value, 0), 0, 100000);
        });
        const qty = clamp(num($("p_qty").value, p.qtyMl), 0, 100000);
        p.qtyMl = qty;
        if (qty <= 0) { alert("×§×‘×¢ ×›×ž×•×ª"); return; }
        let total = 0;
        p.rows.forEach(r => total += num(r.ml, 0));
        const diff = qty - total;
        const alcRow = p.rows.find(r => r.materialId === "MAT_ALC");
        if (alcRow) alcRow.ml = clamp(num(alcRow.ml, 0) + diff, 0, 100000);
        else p.rows.push({ id: uid(), materialId: "MAT_ALC", ml: clamp(diff, 0, 100000), catHint: "×§×‘×•×¢×™×" });
        renderEditor();
      };

      fpBody.querySelectorAll("[data-addrow]").forEach(btn => {
        btn.onclick = () => {
          // Save current values before adding row
          fpBody.querySelectorAll("[data-ml]").forEach(inp => {
            const rid = inp.getAttribute("data-ml");
            const row = p.rows.find(r => r.id === rid);
            if (row) row.ml = clamp(num(inp.value, 0), 0, 100000);
          });
          const cat = btn.getAttribute("data-addrow");
          p.rows.push({ id: uid(), materialId: "", ml: 0, catHint: cat });
          renderEditor();
        };
      });

      fpBody.querySelectorAll("[data-row]").forEach(sel => {
        sel.onchange = () => {
          const rid = sel.getAttribute("data-row");
          const rowIndex = p.rows.findIndex(r => r.id === rid);
          const row = p.rows[rowIndex];
          if (row) {
            row.materialId = sel.value;
            // If a material was selected, automatically add a new empty row AFTER this one in the same category
            if (sel.value) {
              const cat = row.catHint || "×ª×ž×¦×™×•×ª";
              // Check if there's already an empty row in this category
              const hasEmpty = p.rows.some(r => r.catHint === cat && !r.materialId);
              if (!hasEmpty) {
                // Insert after current row, not at the end
                const newRow = { id: uid(), materialId: "", ml: 0, catHint: cat };
                p.rows.splice(rowIndex + 1, 0, newRow);
                renderEditor();
              }
            }
          }
        };
      });

      fpBody.querySelectorAll("[data-ml]").forEach(inp => {
        // Select all text on focus (so 0 gets replaced easily)
        inp.onfocus = () => {
          inp.select();
        };
        // Update data on input
        inp.oninput = () => {
          const rid = inp.getAttribute("data-ml");
          const row = p.rows.find(r => r.id === rid);
          if (row) row.ml = clamp(num(inp.value, 0), 0, 100000);
        };
        // Enter key jumps to next empty select in same category
        inp.onkeydown = (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            const rid = inp.getAttribute("data-ml");
            const rowIndex = p.rows.findIndex(r => r.id === rid);
            const row = p.rows[rowIndex];
            if (row) {
              row.ml = clamp(num(inp.value, 0), 0, 100000);
              const cat = row.catHint || "×ª×ž×¦×™×•×ª";
              // Find next empty row in same category or add one
              let nextEmptyRow = p.rows.find((r, i) => i > rowIndex && r.catHint === cat && !r.materialId);
              if (!nextEmptyRow) {
                // Add new row after current
                nextEmptyRow = { id: uid(), materialId: "", ml: 0, catHint: cat };
                p.rows.splice(rowIndex + 1, 0, nextEmptyRow);
              }
              renderEditor();
              // Focus the new select after render
              setTimeout(() => {
                const newSelect = fpBody.querySelector(`select[data-row="${nextEmptyRow.id}"]`);
                if (newSelect) newSelect.focus();
              }, 50);
            }
          }
        };
      });

      fpBody.querySelectorAll("[data-delrow]").forEach(btn => {
        btn.onclick = () => {
          // Save current values before deleting
          fpBody.querySelectorAll("[data-ml]").forEach(inp => {
            const rid = inp.getAttribute("data-ml");
            const row = p.rows.find(r => r.id === rid);
            if (row) row.ml = clamp(num(inp.value, 0), 0, 100000);
          });
          const rid = btn.getAttribute("data-delrow");
          p.rows = p.rows.filter(r => r.id !== rid);
          renderEditor();
        };
      });

      $("p_cancel").onclick = () => {
        closeFullPage();
        render();
      };

      $("p_save").onclick = () => {
        const name = $("p_name").value.trim();
        if (!name) { alert("×—×•×‘×” ×©×"); return; }

        p.name = name;
        p.code = $("p_code").value.trim();
        if (!state.ui.hideInspired && $("p_insp")) p.inspiredBy = $("p_insp").value.trim();
        p.notes = $("p_notes").value.trim();
        p.date = $("p_date").value || todayISO();
        p.qtyMl = clamp(num($("p_qty").value, p.qtyMl), 0, 100000);
        p.updatedAt = todayISO();

        if (isFinal) {
          p.marketingText = $("p_mkt").value.trim();
          p.notesTop = $("p_top").value.trim();
          p.notesHeart = $("p_heart").value.trim();
          p.notesBase = $("p_base").value.trim();
          p.imgTop = $("p_imgTop").value.trim();
          p.imgHeart = $("p_imgHeart").value.trim();
          p.imgBase = $("p_imgBase").value.trim();
        }

        // Clean rows without material
        p.rows = p.rows.filter(r => r.materialId && getMaterial(r.materialId));

        const list = getPerfumeList(mode);
        const idx = list.findIndex(x => x.id === p.id);
        if (idx >= 0) list[idx] = p;
        else list.unshift(p);
        setPerfumeList(mode, list);

        saveState();
        closeFullPage();
        render();
      };
    };

    openFullPage({
      title: isNew ? "×¤×•×¨×ž×•×œ×” ×—×“×©×”" : "×¢×¨×™×›×ª ×¤×•×¨×ž×•×œ×”",
      pill: isFinal ? "×¡×•×¤×™" : "×¤×™×ª×•×—",
      body: ""
    });
    renderEditor();
  };


  // ==================== CANDLE CONVERSION PAGE ====================

  // ==================== COST CALCULATION HELPER ====================

  // Default prices for common base materials (per gram/ml)
  const DEFAULT_PRICES = {
    wax_paraffin: 0.03,      // ×©×¢×•×•×ª ×¤×¨×¤×™×Ÿ - â‚ª30/kg
    wax_coconut: 0.06,       // ×©×¢×•×•×ª ×§×•×§×•×¡ - â‚ª60/kg
    wax_soy: 0.05,           // ×©×¢×•×•×ª ×¡×•×™×” - â‚ª50/kg
    vybar: 0.20,             // Vybar - â‚ª200/kg
    alcohol: 0.04,           // ××œ×›×•×”×•×œ 99% - â‚ª40/L
    dpg: 0.03,               // DPG - â‚ª30/kg
    water: 0.001,            // ×ž×™× ×ž×–×•×§×§×™×
    carrier_oil: 0.05        // ×©×ž×Ÿ × ×•×©× ×œ×“×™×¤×™×•×–×¨ - â‚ª50/L
  };

  // Get material price per ml/gram
  const getMaterialPrice = (material) => {
    if (!material) return null;

    // Check for pricePerMl first
    if (material.pricePerMl && material.pricePerMl > 0) {
      return material.pricePerMl;
    }

    // Convert pricePerKg to per gram/ml
    if (material.pricePerKg && material.pricePerKg > 0) {
      return material.pricePerKg / 1000;
    }

    return null;
  };

  // Calculate cost breakdown for a list of ingredients
  const calculateCostBreakdown = (ingredients, options = {}) => {
    // ingredients: [{ name, amount, materialId, type }]
    // options: { showDefaults: true, unit: '×’×¨×' }

    const unit = options.unit || '×’×¨×';
    const costs = [];
    const missingPrices = [];
    let totalCost = 0;

    ingredients.forEach(ing => {
      let price = null;
      let isDefault = false;

      // Try to get price from material
      if (ing.materialId) {
        const mat = getMaterial(ing.materialId);
        price = getMaterialPrice(mat);
      }

      // For base materials, use defaults
      if (!price && ing.type) {
        price = DEFAULT_PRICES[ing.type];
        isDefault = true;
      }

      if (price && price > 0) {
        const cost = ing.amount * price;
        totalCost += cost;
        costs.push({
          name: ing.name,
          amount: ing.amount,
          price: price,
          cost: cost,
          isDefault: isDefault,
          unit: unit
        });
      } else {
        missingPrices.push(ing.name);
      }
    });

    return {
      costs,
      missingPrices,
      totalCost
    };
  };

  // Render cost breakdown HTML
  const renderCostBreakdown = (breakdown, title = 'ðŸ’° ×¢×œ×•×ª ×ž×©×•×¢×¨×ª') => {
    if (breakdown.costs.length === 0 && breakdown.missingPrices.length === 0) {
      return '';
    }

    let html = `
      <div class="hr" style="margin:20px 0"></div>
      <h3>${title}</h3>
      <table style="margin:12px 0;width:100%">
        <thead><tr><th style="text-align:right">×—×•×ž×¨</th><th style="text-align:center">×›×ž×•×ª</th><th style="text-align:center">×ž×—×™×¨ ×œ×™×—'</th><th style="text-align:left">×¢×œ×•×ª</th></tr></thead>
        <tbody>
    `;

    breakdown.costs.forEach(c => {
      const defaultMark = c.isDefault ? ' <span style="color:var(--muted);font-size:0.8rem">(×‘×¨×™×¨×ª ×ž×—×“×œ)</span>' : '';
      html += `<tr>
        <td style="padding:6px 8px">${escapeHtml(c.name)}${defaultMark}</td>
        <td class="mono" style="padding:6px 8px;text-align:center">${fmt(c.amount, 2)} ${c.unit}</td>
        <td class="mono" style="padding:6px 8px;text-align:center;color:var(--muted)">â‚ª${fmt(c.price, 3)}</td>
        <td class="mono" style="padding:6px 8px;text-align:left;font-weight:600">â‚ª${fmt(c.cost, 2)}</td>
      </tr>`;
    });

    html += `
        </tbody>
        <tfoot>
          <tr style="background:rgba(212,168,83,0.2);font-weight:700">
            <td colspan="3" style="padding:8px 12px">×¡×”"×› ×¢×œ×•×ª</td>
            <td class="mono" style="padding:8px 12px;text-align:left">â‚ª${fmt(breakdown.totalCost, 2)}</td>
          </tr>
        </tfoot>
      </table>
    `;

    if (breakdown.missingPrices.length > 0) {
      html += `
        <div class="warn-box" style="margin-top:12px;border-color:#f59e0b;background:rgba(245,158,11,0.1)">
          âš ï¸ <strong>×¢×œ×•×ª ×—×œ×§×™×ª</strong> - ×—×¡×¨×™× ×ž×—×™×¨×™× ×¢×‘×•×¨: ${breakdown.missingPrices.join(', ')}
          <div style="font-size:0.85rem;color:var(--muted);margin-top:4px">ðŸ’¡ ×”×•×¡×£ ×ž×—×™×¨×™× ×‘×˜××‘ "×—×•×ž×¨×™ ×’×œ×" ××• ×‘×”×’×“×¨×•×ª</div>
        </div>
      `;
    }

    return html;
  };

  // Candle safety database
  const CANDLE_SAFETY = {
    // Materials that MUST be removed (won't dissolve in wax)
    forbidden: ["MAT_DPG", "MAT_ALC"],
    forbiddenKeywords: ["dpg", "alcohol", "××œ×›×•×”×•×œ"],

    // Low flash point warnings (citrus oils, etc.)
    lowFlashPoint: ["lemon", "orange", "bergamot", "grapefruit", "lime", "×ª×¤×•×–", "×œ×™×ž×•×Ÿ", "×‘×¨×’×ž×•×˜", "××©×›×•×œ×™×ª", "×œ×™×™×", "eucalyptus", "××§×œ×™×¤×˜×•×¡"],

    // Excellent for candles
    excellent: ["iso e super", "vanillin", "ethyl vanillin", "coumarin", "galaxolide", "cashmeran", "musk", "patchouli", "cedarwood", "sandalwood", "ylang", "×¤×¦'×•×œ×™", "×¡× ×“×œ", "××¨×–", "×•× ×™×œ"],

    // May need adjustment
    caution: ["absolute", "××‘×¡×•×œ×•×˜", "rose absolute", "jasmine absolute"]
  };

  const classifyIngredientForCandle = (material) => {
    if (!material) return { status: "unknown", reason: "×—×•×ž×¨ ×œ× × ×ž×¦×" };

    const name = (material.name || "").toLowerCase();
    const id = material.id || "";

    // Check forbidden
    if (CANDLE_SAFETY.forbidden.includes(id)) {
      return { status: "forbidden", reason: "×œ× × ×ž×¡ ×‘×©×¢×•×•×” - ×™×© ×œ×”×¡×™×¨" };
    }
    for (const kw of CANDLE_SAFETY.forbiddenKeywords) {
      if (name.includes(kw)) {
        return { status: "forbidden", reason: "×œ× ×ž×ª××™× ×œ× ×¨×•×ª - ×™×© ×œ×”×¡×™×¨" };
      }
    }

    // Check low flash point
    for (const kw of CANDLE_SAFETY.lowFlashPoint) {
      if (name.includes(kw)) {
        return { status: "warning", reason: "Flash Point × ×ž×•×š - ×–×”×™×¨×•×ª, ×¢×œ×•×œ ×œ×™×¦×•×¨ ×¤×™×—" };
      }
    }

    // Check caution (absolutes)
    for (const kw of CANDLE_SAFETY.caution) {
      if (name.includes(kw)) {
        return { status: "warning", reason: "×œ× × ×ž×¡ ×˜×•×‘ ×‘×©×¢×•×•×” - Hot Throw ×—×œ×©" };
      }
    }

    // Check excellent
    for (const kw of CANDLE_SAFETY.excellent) {
      if (name.includes(kw)) {
        return { status: "safe", reason: "×ž×¢×•×œ×” ×œ× ×¨×•×ª!" };
      }
    }

    // Default - generally safe
    return { status: "safe", reason: "×ž×ª××™× ×œ× ×¨×•×ª" };
  };

  // State for conversion type
  let conversionType = "candle";

  const renderCandle = () => {
    const left = $("leftPanel");
    const right = $("rightPanel");

    // Show conversion type selector first
    left.innerHTML = `
      <h2>ðŸ”„ ×”×ž×¨×•×ª</h2>
      <div class="small" style="margin-bottom:12px">×‘×—×¨ ×¡×•×’ ×”×ž×¨×”</div>

      <div style="display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap">
        <button class="btn ${conversionType === 'candle' ? 'success' : ''}" id="btnConvCandle" style="flex:1;min-width:80px">ðŸ•¯ï¸ × ×¨</button>
        <button class="btn ${conversionType === 'spray' ? 'success' : ''}" id="btnConvSpray" style="flex:1;min-width:80px">ðŸŒ¸ ×¡×¤×¨×™×™</button>
        <button class="btn ${conversionType === 'diffuser' ? 'success' : ''}" id="btnConvDiffuser" style="flex:1;min-width:80px">ðŸªµ ×“×™×¤×™×•×–×¨</button>
      </div>
    `;

    right.innerHTML = "";

    // Wire conversion type buttons
    setTimeout(() => {
      const btnCandle = $("btnConvCandle");
      const btnSpray = $("btnConvSpray");
      const btnDiffuser = $("btnConvDiffuser");
      if (btnCandle) btnCandle.onclick = () => { conversionType = "candle"; renderCandle(); };
      if (btnSpray) btnSpray.onclick = () => { conversionType = "spray"; renderCandle(); };
      if (btnDiffuser) btnDiffuser.onclick = () => { conversionType = "diffuser"; renderCandle(); };
    }, 0);

    if (conversionType === "spray") {
      renderRoomSpray();
      return;
    }

    if (conversionType === "diffuser") {
      renderReedDiffuser();
      return;
    }

    // Candle conversion content
    left.innerHTML += `
      <div class="hr"></div>
      <h3 style="margin-top:16px">ðŸ•¯ï¸ ×”×ž×¨×” ×œ× ×¨</h3>
      <div class="small" style="margin-bottom:16px">×‘×—×¨ ×‘×•×©× ×•×”×ž×¨ ××•×ª×• ×œ×¤×•×¨×ž×•×œ×ª × ×¨</div>
      <div class="hr"></div>

      <div class="field">
        <label>×‘×—×¨ ×‘×•×©×</label>
        <select id="candlePerfSelect">
          <option value="">-- ×‘×—×¨ ×‘×•×©× --</option>
          <optgroup label="âœ¨ ×‘×©×ž×™× ×¡×•×¤×™×™×">
            ${state.perfumesFinal.map(p => `<option value="final:${p.id}">${escapeHtml(p.name)}${p.code ? ` â€¢ ${p.code}` : ""}</option>`).join("")}
          </optgroup>
          <optgroup label="ðŸ§ª ×¤×™×ª×•×—×™×">
            ${state.perfumesDev.map(p => `<option value="dev:${p.id}">${escapeHtml(p.name)}${p.code ? ` â€¢ ${p.code}` : ""}</option>`).join("")}
          </optgroup>
        </select>
      </div>

      <div id="candleIngredientAnalysis" style="margin-top:16px"></div>

      <div class="hr" style="margin:20px 0"></div>

      <div class="field">
        <label>×’×•×“×œ × ×¨ (×’×¨×)</label>
        <input type="number" id="candleSize" value="200" min="50" max="2000" step="10" style="width:120px">
      </div>

      <button class="btn success" id="btnCalculateCandle" style="margin-top:16px">ðŸ”¥ ×—×©×‘ ×¤×•×¨×ž×•×œ×ª × ×¨</button>
    `;

    right.innerHTML = `
      <h2>ðŸ“‹ ×¤×•×¨×ž×•×œ×ª × ×¨</h2>
      <div id="candleResult">
        <p class="muted">×‘×—×¨ ×‘×•×©× ×•×’×•×“×œ × ×¨ ×œ×—×™×©×•×‘ ×”×¤×•×¨×ž×•×œ×”</p>
      </div>
    `;

    // Wire up perfume selection
    $("candlePerfSelect").onchange = () => {
      const val = $("candlePerfSelect").value;
      if (!val) {
        $("candleIngredientAnalysis").innerHTML = "";
        return;
      }

      const [mode, id] = val.split(":");
      const perf = (mode === "final" ? state.perfumesFinal : state.perfumesDev).find(p => p.id === id);
      if (!perf) return;

      // Analyze ingredients
      let html = '<div style="margin-top:12px"><strong>× ×™×ª×•×— ×—×•×ž×¨×™×:</strong></div>';
      html += '<div class="table-wrap" style="margin-top:8px"><table><thead><tr><th>×—×•×ž×¨</th><th>×›×ž×•×ª (ml)</th><th>×”×ª××ž×” ×œ× ×¨</th></tr></thead><tbody>';

      const rows = perf.rows || [];
      let hasForbidden = false;
      let hasWarning = false;

      rows.forEach(r => {
        if (!r.materialId || r.ml <= 0) return;
        const mat = getMaterial(r.materialId);
        const analysis = classifyIngredientForCandle(mat);

        let statusIcon, statusClass;
        if (analysis.status === "forbidden") {
          statusIcon = "âŒ";
          statusClass = "color:#ef4444";
          hasForbidden = true;
        } else if (analysis.status === "warning") {
          statusIcon = "âš ï¸";
          statusClass = "color:#f59e0b";
          hasWarning = true;
        } else {
          statusIcon = "âœ…";
          statusClass = "color:#22c55e";
        }

        html += `<tr>
          <td>${escapeHtml(mat ? mat.name : r.materialId)}</td>
          <td class="mono">${fmt(r.ml, 2)}</td>
          <td style="${statusClass}">${statusIcon} ${escapeHtml(analysis.reason)}</td>
        </tr>`;
      });

      html += '</tbody></table></div>';

      if (hasForbidden) {
        html += '<div class="warn-box" style="margin-top:12px;border-color:#ef4444;background:rgba(239,68,68,0.1)">âš ï¸ <strong>×©×™× ×œ×‘:</strong> ×™×© ×—×•×ž×¨×™× ×©×—×™×™×‘×™× ×œ×”×¡×™×¨ (DPG, ××œ×›×•×”×•×œ) - ×”× ×œ× ×™×›×œ×œ×• ×‘×—×™×©×•×‘</div>';
      }
      if (hasWarning) {
        html += '<div class="warn-box" style="margin-top:8px;border-color:#f59e0b;background:rgba(245,158,11,0.1)">ðŸ’¡ <strong>×”×ž×œ×¦×”:</strong> ×©×§×•×œ ×œ×”×—×œ×™×£ ×—×•×ž×¨×™× ×¦×™×˜×¨×•×¡×™×™× ×‘×’×¨×¡××•×ª ×¢× Flash Point ×’×‘×•×” ×™×•×ª×¨</div>';
      }

      $("candleIngredientAnalysis").innerHTML = html;
    };

    // Wire up calculate button
    $("btnCalculateCandle").onclick = () => {
      const val = $("candlePerfSelect").value;
      const candleSize = num($("candleSize").value, 200);

      if (!val) {
        alert("× × ×œ×‘×—×•×¨ ×‘×•×©×!");
        return;
      }

      if (candleSize < 50 || candleSize > 2000) {
        alert("×’×•×“×œ × ×¨ ×—×™×™×‘ ×œ×”×™×•×ª ×‘×™×Ÿ 50 ×œ-2000 ×’×¨×");
        return;
      }

      const [mode, id] = val.split(":");
      const perf = (mode === "final" ? state.perfumesFinal : state.perfumesDev).find(p => p.id === id);
      if (!perf) return;

      // Filter out forbidden ingredients and calculate new ratios
      const rows = (perf.rows || []).filter(r => {
        if (!r.materialId || r.ml <= 0) return false;
        const mat = getMaterial(r.materialId);
        const analysis = classifyIngredientForCandle(mat);
        return analysis.status !== "forbidden";
      });

      // Calculate total fragrance ml (without forbidden)
      let totalFragranceMl = 0;
      rows.forEach(r => { totalFragranceMl += num(r.ml, 0); });

      if (totalFragranceMl === 0) {
        $("candleResult").innerHTML = '<div class="warn-box">âŒ ××™×Ÿ ×—×•×ž×¨×™ ×¨×™×— ×ž×ª××™×ž×™× ×‘×¤×•×¨×ž×•×œ×” ×–×•</div>';
        return;
      }

      // Candle formula calculations
      const vybarAmount = candleSize * 0.01;
      const waxAmount = candleSize * 0.90;
      const fragranceAmount = candleSize * 0.10;

      // Wax breakdown
      const paraffinAmount = waxAmount * 0.50;
      const coconutAmount = waxAmount * 0.30;
      const soyAmount = waxAmount * 0.20;

      // Calculate each ingredient amount
      const ingredientAmounts = rows.map(r => {
        const mat = getMaterial(r.materialId);
        const ratio = r.ml / totalFragranceMl;
        const amount = fragranceAmount * ratio;
        const analysis = classifyIngredientForCandle(mat);
        return {
          name: mat ? mat.name : r.materialId,
          originalMl: r.ml,
          ratio: ratio * 100,
          amount: amount,
          status: analysis.status,
          warning: analysis.status === "warning" ? analysis.reason : null
        };
      });

      // Build result HTML
      let html = `
        <div class="pill" style="font-size:1.1rem;padding:10px 16px;background:var(--accent);color:var(--bg);margin-bottom:16px">
          ðŸ•¯ï¸ ${escapeHtml(perf.name)} - × ×¨ ${candleSize} ×’×¨×
        </div>

        <h3 style="margin-top:16px">ðŸ§± ×”×¨×›×‘ ×©×¢×•×•×” (${fmt(waxAmount, 1)} ×’×¨× - 90%)</h3>
        <table style="margin:12px 0">
          <tr><td style="padding:4px 12px">×¤×¨×¤×™×Ÿ (50%)</td><td class="mono" style="padding:4px 12px">${fmt(paraffinAmount, 1)} ×’×¨×</td></tr>
          <tr><td style="padding:4px 12px">×©×¢×•×•×ª ×§×•×§×•×¡ (30%)</td><td class="mono" style="padding:4px 12px">${fmt(coconutAmount, 1)} ×’×¨×</td></tr>
          <tr><td style="padding:4px 12px">×©×¢×•×•×ª ×¡×•×™×” (20%)</td><td class="mono" style="padding:4px 12px">${fmt(soyAmount, 1)} ×’×¨×</td></tr>
        </table>

        <h3 style="margin-top:20px">ðŸŒ¸ ×”×¨×›×‘ ×¨×™×— (${fmt(fragranceAmount, 1)} ×’×¨× - 10%)</h3>
        <div class="table-wrap" style="margin:12px 0">
          <table>
            <thead><tr><th>×—×•×ž×¨</th><th>××—×•×–</th><th>×›×ž×•×ª</th><th>×”×¢×¨×•×ª</th></tr></thead>
            <tbody>
      `;

      ingredientAmounts.forEach(ing => {
        let statusHtml = "";
        if (ing.status === "warning") {
          statusHtml = `<span style="color:#f59e0b">âš ï¸ ${escapeHtml(ing.warning)}</span>`;
        } else {
          statusHtml = '<span style="color:#22c55e">âœ…</span>';
        }
        html += `<tr>
          <td>${escapeHtml(ing.name)}</td>
          <td class="mono">${fmt(ing.ratio, 1)}%</td>
          <td class="mono" style="font-weight:600">${fmt(ing.amount, 2)} ×’×¨×</td>
          <td>${statusHtml}</td>
        </tr>`;
      });

      html += `
            </tbody>
          </table>
        </div>

        <h3 style="margin-top:20px">âž• ×ª×•×¡×¤×•×ª</h3>
        <table style="margin:12px 0">
          <tr><td style="padding:4px 12px">Vybar (1%)</td><td class="mono" style="padding:4px 12px">${fmt(vybarAmount, 1)} ×’×¨×</td></tr>
        </table>

        <div class="hr" style="margin:20px 0"></div>

        <h3>ðŸ“Š ×¡×™×›×•×</h3>
        <table style="margin:12px 0;font-size:1.1rem">
          <tr style="font-weight:600"><td style="padding:6px 12px">×¡×”"×› ×©×¢×•×•×”</td><td class="mono" style="padding:6px 12px">${fmt(waxAmount, 1)} ×’×¨×</td></tr>
          <tr style="font-weight:600"><td style="padding:6px 12px">×¡×”"×› ×¨×™×—</td><td class="mono" style="padding:6px 12px">${fmt(fragranceAmount, 1)} ×’×¨×</td></tr>
          <tr style="font-weight:600"><td style="padding:6px 12px">Vybar</td><td class="mono" style="padding:6px 12px">${fmt(vybarAmount, 1)} ×’×¨×</td></tr>
          <tr style="font-weight:700;background:rgba(212,168,83,0.2)"><td style="padding:8px 12px">×¡×”"×› × ×¨</td><td class="mono" style="padding:8px 12px">${fmt(candleSize + vybarAmount, 1)} ×’×¨×</td></tr>
        </table>
      `;

      // Check for low flash point warnings
      const warnings = ingredientAmounts.filter(i => i.status === "warning");
      if (warnings.length > 0) {
        html += `
          <div class="warn-box" style="margin-top:16px;border-color:#f59e0b;background:rgba(245,158,11,0.1)">
            <strong>âš ï¸ ××–×”×¨×•×ª Flash Point:</strong>
            <ul style="margin:8px 0 0 0;padding-right:20px">
        `;
        warnings.forEach(w => {
          html += `<li>${escapeHtml(w.name)}: ${escapeHtml(w.warning)}</li>`;
        });
        html += '</ul></div>';
      }

      // Calculate and display cost
      const costIngredients = [
        // Wax components
        { name: '×¤×¨×¤×™×Ÿ (50%)', amount: paraffinAmount, type: 'wax_paraffin' },
        { name: '×©×¢×•×•×ª ×§×•×§×•×¡ (30%)', amount: coconutAmount, type: 'wax_coconut' },
        { name: '×©×¢×•×•×ª ×¡×•×™×” (20%)', amount: soyAmount, type: 'wax_soy' },
        { name: 'Vybar', amount: vybarAmount, type: 'vybar' }
      ];

      // Add fragrance ingredients
      rows.forEach(r => {
        const mat = getMaterial(r.materialId);
        const ratio = r.ml / totalFragranceMl;
        const amount = fragranceAmount * ratio;
        costIngredients.push({
          name: mat ? mat.name : r.materialId,
          amount: amount,
          materialId: r.materialId
        });
      });

      const costBreakdown = calculateCostBreakdown(costIngredients, { unit: '×’×¨×' });
      html += renderCostBreakdown(costBreakdown, 'ðŸ’° ×¢×œ×•×ª ×ž×©×•×¢×¨×ª ×œ× ×¨');

      // Add instructions
      html += `
        <div class="hr" style="margin:20px 0"></div>

        <h3>ðŸ“ ×”×•×¨××•×ª ×”×›× ×”</h3>
        <ol style="margin:12px 0;padding-right:24px;line-height:1.8">
          <li>×”×ž×¡ ××ª ×”×©×¢×•×•×” ×œ-82Â°C</li>
          <li>×”×•×¡×£ ××ª ×”-Vybar ×•×¢×¨×‘×‘ ×”×™×˜×‘</li>
          <li>×”×•×¡×£ ××ª ×ª×ž×¦×™×ª ×”×¨×™×— ×‘-82-85Â°C</li>
          <li>×¢×¨×‘×‘ 2-3 ×“×§×•×ª ×‘×¨×¦×™×¤×•×ª</li>
          <li>×”×ž×ª×Ÿ ×©×”×˜×ž×¤×¨×˜×•×¨×” ×ª×¨×“ ×œ-57-63Â°C</li>
          <li>×™×¦×•×§ ×œ×›×œ×™ ×¢× ×¤×ª×™×œ ×ž×•×›×Ÿ</li>
          <li><strong>×–×ž×Ÿ ×¨×™×¤×•×™ ×ž×•×ž×œ×¥: 5-7 ×™×ž×™×</strong></li>
        </ol>

        <button class="btn" id="btnPrintCandle" style="margin-top:16px">ðŸ–¨ï¸ ×”×“×¤×¡ ×ž×ª×›×•×Ÿ</button>
      `;

      $("candleResult").innerHTML = html;

      // Wire print button
      $("btnPrintCandle").onclick = () => {
        const printContent = $("candleResult").innerHTML;
        const printWindow = window.open("", "_blank");
        printWindow.document.write(`
          <!DOCTYPE html>
          <html dir="rtl">
          <head>
            <meta charset="UTF-8">
            <title>×ž×ª×›×•×Ÿ × ×¨ - ${escapeHtml(perf.name)}</title>
            <style>
              body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
              table { border-collapse: collapse; width: 100%; margin: 10px 0; }
              td, th { border: 1px solid #ddd; padding: 8px; text-align: right; }
              th { background: #f5f5f5; }
              .mono { font-family: monospace; }
              .pill { background: #d4a853; color: white; padding: 10px 16px; border-radius: 20px; display: inline-block; }
              h3 { margin-top: 20px; border-bottom: 2px solid #d4a853; padding-bottom: 8px; }
              .warn-box { border: 1px solid #f59e0b; background: #fffbeb; padding: 12px; border-radius: 8px; margin: 12px 0; }
              @media print { .btn { display: none; } }
            </style>
          </head>
          <body>
            <h1 style="text-align:center">ðŸ•¯ï¸ ENIGMA - ×ž×ª×›×•×Ÿ × ×¨</h1>
            ${printContent}
            <p style="text-align:center;margin-top:30px;color:#888">× ×•×¦×¨ ×‘-ENIGMA Perfume Manager</p>
          </body>
          </html>
        `);
        printWindow.document.close();
        printWindow.print();
      };
    };
  };


  // ==================== ROOM SPRAY CONVERSION ====================

  const renderRoomSpray = () => {
    const left = $("leftPanel");
    const right = $("rightPanel");

    left.innerHTML = `
      <h2>ðŸ”„ ×”×ž×¨×•×ª</h2>
      <div class="small" style="margin-bottom:12px">×‘×—×¨ ×¡×•×’ ×”×ž×¨×”</div>

      <div style="display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap">
        <button class="btn" id="btnConvCandle" style="flex:1;min-width:80px">ðŸ•¯ï¸ × ×¨</button>
        <button class="btn success" id="btnConvSpray" style="flex:1;min-width:80px">ðŸŒ¸ ×¡×¤×¨×™×™</button>
        <button class="btn" id="btnConvDiffuser" style="flex:1;min-width:80px">ðŸªµ ×“×™×¤×™×•×–×¨</button>
      </div>

      <div class="hr"></div>
      <h3 style="margin-top:16px">ðŸŒ¸ ×”×ž×¨×” ×œ×ž×‘×©× ×—×“×¨</h3>
      <div class="small" style="margin-bottom:16px">×‘×—×¨ ×‘×•×©× ×•×”×ž×¨ ××•×ª×• ×œ×¡×¤×¨×™×™ ×—×“×¨</div>
      <div class="hr"></div>

      <div class="field">
        <label>×‘×—×¨ ×‘×•×©×</label>
        <select id="sprayPerfSelect">
          <option value="">-- ×‘×—×¨ ×‘×•×©× --</option>
          <optgroup label="âœ¨ ×‘×©×ž×™× ×¡×•×¤×™×™×">
            ${state.perfumesFinal.map(p => `<option value="final:${p.id}">${escapeHtml(p.name)}${p.code ? ` â€¢ ${p.code}` : ""}</option>`).join("")}
          </optgroup>
          <optgroup label="ðŸ§ª ×¤×™×ª×•×—×™×">
            ${state.perfumesDev.map(p => `<option value="dev:${p.id}">${escapeHtml(p.name)}${p.code ? ` â€¢ ${p.code}` : ""}</option>`).join("")}
          </optgroup>
        </select>
      </div>

      <div class="hr" style="margin:20px 0"></div>

      <div class="field">
        <label>×’×•×“×œ ×‘×§×‘×•×§ (ml)</label>
        <input type="number" id="spraySize" value="100" min="30" max="1000" step="10" style="width:120px">
      </div>

      <div class="field" style="margin-top:12px">
        <label>××—×•×– ×¨×™×— (5-10%)</label>
        <input type="range" id="sprayFragrancePercent" min="5" max="10" value="7" style="width:150px">
        <span id="sprayFragranceLabel" class="mono" style="margin-right:8px">7%</span>
      </div>

      <div class="warn-box" style="margin-top:16px;border-color:#ef4444;background:rgba(239,68,68,0.1)">
        ðŸ”¥ <strong>××–×”×¨×”:</strong> ×“×œ×™×§ ×ž××•×“ - ×œ×”×¨×—×™×§ ×ž××©!
      </div>

      <button class="btn success" id="btnCalculateSpray" style="margin-top:16px">ðŸŒ¸ ×—×©×‘ ×¤×•×¨×ž×•×œ×ª ×¡×¤×¨×™×™</button>
    `;

    right.innerHTML = `
      <h2>ðŸ“‹ ×¤×•×¨×ž×•×œ×ª ×ž×‘×©× ×—×“×¨</h2>
      <div id="sprayResult">
        <p class="muted">×‘×—×¨ ×‘×•×©× ×•×’×•×“×œ ×‘×§×‘×•×§ ×œ×—×™×©×•×‘ ×”×¤×•×¨×ž×•×œ×”</p>
      </div>
    `;

    // Wire conversion type buttons
    $("btnConvCandle").onclick = () => { conversionType = "candle"; renderCandle(); };
    $("btnConvSpray").onclick = () => { conversionType = "spray"; renderCandle(); };
    $("btnConvDiffuser").onclick = () => { conversionType = "diffuser"; renderCandle(); };

    // Wire up fragrance percent slider
    $("sprayFragrancePercent").oninput = () => {
      $("sprayFragranceLabel").textContent = $("sprayFragrancePercent").value + "%";
    };

    // Wire up calculate button
    $("btnCalculateSpray").onclick = () => {
      const val = $("sprayPerfSelect").value;
      const spraySize = num($("spraySize").value, 100);
      const fragrancePercent = num($("sprayFragrancePercent").value, 7);

      if (!val) {
        alert("× × ×œ×‘×—×•×¨ ×‘×•×©×!");
        return;
      }

      if (spraySize < 30 || spraySize > 1000) {
        alert("×’×•×“×œ ×‘×§×‘×•×§ ×—×™×™×‘ ×œ×”×™×•×ª ×‘×™×Ÿ 30 ×œ-1000 ml");
        return;
      }

      const [mode, id] = val.split(":");
      const perf = (mode === "final" ? state.perfumesFinal : state.perfumesDev).find(p => p.id === id);
      if (!perf) return;

      // Room spray formula
      const alcoholPercent = 90;
      const waterPercent = 100 - alcoholPercent - fragrancePercent;

      const alcoholAmount = spraySize * (alcoholPercent / 100);
      const fragranceAmount = spraySize * (fragrancePercent / 100);
      const waterAmount = spraySize * (waterPercent / 100);

      // Get perfume ingredients (excluding alcohol which we add separately)
      const rows = (perf.rows || []).filter(r => {
        if (!r.materialId || r.ml <= 0) return false;
        // Include all ingredients including DPG for room spray
        return r.materialId !== "MAT_ALC"; // Exclude alcohol from original formula
      });

      // Calculate total fragrance ml from original formula (without alcohol)
      let totalOriginalMl = 0;
      rows.forEach(r => { totalOriginalMl += num(r.ml, 0); });

      if (totalOriginalMl === 0) {
        $("sprayResult").innerHTML = '<div class="warn-box">âŒ ××™×Ÿ ×—×•×ž×¨×™ ×¨×™×— ×‘×¤×•×¨×ž×•×œ×” ×–×•</div>';
        return;
      }

      // Calculate each ingredient amount
      const ingredientAmounts = rows.map(r => {
        const mat = getMaterial(r.materialId);
        const ratio = r.ml / totalOriginalMl;
        const amount = fragranceAmount * ratio;
        const isDPG = r.materialId === "MAT_DPG" || (mat && mat.name && mat.name.toLowerCase().includes("dpg"));
        return {
          name: mat ? mat.name : r.materialId,
          originalMl: r.ml,
          ratio: ratio * 100,
          amount: amount,
          isDPG: isDPG
        };
      });

      // Check if has DPG
      const hasDPG = ingredientAmounts.some(i => i.isDPG);

      // Build result HTML
      let html = `
        <div class="pill" style="font-size:1.1rem;padding:10px 16px;background:var(--accent);color:var(--bg);margin-bottom:16px">
          ðŸŒ¸ ${escapeHtml(perf.name)} - ×¡×¤×¨×™×™ ${spraySize} ml
        </div>

        <div class="warn-box" style="margin-bottom:16px;border-color:#ef4444;background:rgba(239,68,68,0.1)">
          ðŸ”¥ <strong>×“×œ×™×§ ×ž××•×“ - ×œ×”×¨×—×™×§ ×ž××©!</strong>
        </div>

        <h3 style="margin-top:16px">ðŸ§ª ×”×¨×›×‘ ×‘×¡×™×¡</h3>
        <table style="margin:12px 0">
          <tr><td style="padding:4px 12px">××œ×›×•×”×•×œ (${alcoholPercent}%)</td><td class="mono" style="padding:4px 12px">${fmt(alcoholAmount, 1)} ml</td></tr>
          <tr><td style="padding:4px 12px">×ž×™× ×ž×–×•×§×§×™× (${fmt(waterPercent, 1)}%)</td><td class="mono" style="padding:4px 12px">${fmt(waterAmount, 1)} ml</td></tr>
        </table>

        <h3 style="margin-top:20px">ðŸŒ¸ ×”×¨×›×‘ ×¨×™×— (${fragrancePercent}% = ${fmt(fragranceAmount, 1)} ml)</h3>
        <div class="table-wrap" style="margin:12px 0">
          <table>
            <thead><tr><th>×—×•×ž×¨</th><th>××—×•×– ×ž×”×¨×™×—</th><th>×›×ž×•×ª</th><th>×”×¢×¨×•×ª</th></tr></thead>
            <tbody>
      `;

      ingredientAmounts.forEach(ing => {
        let noteHtml = '<span style="color:#22c55e">âœ… IFRA 10B OK</span>';
        if (ing.isDPG) {
          noteHtml = '<span style="color:#3b82f6">â„¹ï¸ DPG - ×‘×¡×“×¨ ×œ×¡×¤×¨×™×™</span>';
        }
        html += `<tr>
          <td>${escapeHtml(ing.name)}</td>
          <td class="mono">${fmt(ing.ratio, 1)}%</td>
          <td class="mono" style="font-weight:600">${fmt(ing.amount, 2)} ml</td>
          <td>${noteHtml}</td>
        </tr>`;
      });

      html += `
            </tbody>
          </table>
        </div>
      `;

      if (hasDPG) {
        html += `
          <div class="warn-box" style="margin-top:12px;border-color:#3b82f6;background:rgba(59,130,246,0.1)">
            â„¹ï¸ <strong>DPG ×ž×”×‘×•×©× ×”×ž×§×•×¨×™</strong> - ×‘×¡×“×¨ ×œ×”×©×ª×ž×© ×‘×ž×‘×©× ×—×“×¨. DPG ×¢×•×–×¨ ×œ×¤×–×¨ ××ª ×”×¨×™×— ×‘××•×•×™×¨.
          </div>
        `;
      }

      html += `
        <div class="hr" style="margin:20px 0"></div>

        <h3>ðŸ“Š ×¡×™×›×•×</h3>
        <table style="margin:12px 0;font-size:1.1rem">
          <tr style="font-weight:600"><td style="padding:6px 12px">××œ×›×•×”×•×œ</td><td class="mono" style="padding:6px 12px">${fmt(alcoholAmount, 1)} ml</td></tr>
          <tr style="font-weight:600"><td style="padding:6px 12px">×ª×ž×¦×™×ª ×¨×™×—</td><td class="mono" style="padding:6px 12px">${fmt(fragranceAmount, 1)} ml</td></tr>
          <tr style="font-weight:600"><td style="padding:6px 12px">×ž×™× ×ž×–×•×§×§×™×</td><td class="mono" style="padding:6px 12px">${fmt(waterAmount, 1)} ml</td></tr>
          <tr style="font-weight:700;background:rgba(212,168,83,0.2)"><td style="padding:8px 12px">×¡×”"×›</td><td class="mono" style="padding:8px 12px">${fmt(spraySize, 1)} ml</td></tr>
        </table>
      `;

      // Calculate and display cost
      const sprayCostIngredients = [
        { name: '××œ×›×•×”×•×œ 99%', amount: alcoholAmount, type: 'alcohol' },
        { name: '×ž×™× ×ž×–×•×§×§×™×', amount: waterAmount, type: 'water' }
      ];

      // Add fragrance ingredients
      ingredientAmounts.forEach(ing => {
        const originalRow = rows.find(r => {
          const mat = getMaterial(r.materialId);
          return mat && mat.name === ing.name;
        });
        sprayCostIngredients.push({
          name: ing.name,
          amount: ing.amount,
          materialId: originalRow ? originalRow.materialId : null
        });
      });

      const sprayCostBreakdown = calculateCostBreakdown(sprayCostIngredients, { unit: 'ml' });
      html += renderCostBreakdown(sprayCostBreakdown, 'ðŸ’° ×¢×œ×•×ª ×ž×©×•×¢×¨×ª ×œ×¡×¤×¨×™×™');

      html += `
        <div class="hr" style="margin:20px 0"></div>

        <h3>ðŸ“ ×”×•×¨××•×ª ×”×›× ×”</h3>
        <ol style="margin:12px 0;padding-right:24px;line-height:1.8">
          <li>×ž×“×•×“ ××ª ×”××œ×›×•×”×•×œ ×œ×‘×§×‘×•×§ × ×§×™</li>
          <li>×”×•×¡×£ ××ª ×›×œ ×—×•×ž×¨×™ ×”×¨×™×— ×‘×–×” ××—×¨ ×–×”</li>
          <li>×¢×¨×‘×‘ ×”×™×˜×‘ ××• × ×¢×¨ ××ª ×”×‘×§×‘×•×§</li>
          <li>×”×•×¡×£ ××ª ×”×ž×™× ×”×ž×–×•×§×§×™×</li>
          <li>× ×¢×¨ ×©×•×‘ ×”×™×˜×‘</li>
          <li><strong>×”×ž×ª×Ÿ 24-48 ×©×¢×•×ª ×œ×¤× ×™ ×©×™×ž×•×©</strong></li>
        </ol>

        <div class="warn-box" style="margin-top:16px">
          ðŸ’¡ <strong>×˜×™×¤×™×:</strong>
          <ul style="margin:8px 0 0 0;padding-right:20px">
            <li>×”×©×ª×ž×© ×‘×‘×§×‘×•×§ ×¢× ×¨××© ×¡×¤×¨×™×™ ×¢×“×™×Ÿ</li>
            <li>× ×¢×¨ ×œ×¤× ×™ ×›×œ ×©×™×ž×•×©</li>
            <li>××—×¡×Ÿ ×‘×ž×§×•× ×—×©×•×š ×•×§×¨×™×¨</li>
            <li>××œ ×ª×¨×¡×¡ ×™×©×™×¨×•×ª ×¢×œ ×‘×“×™× ××• ×¨×”×™×˜×™×</li>
          </ul>
        </div>

        <button class="btn" id="btnPrintSpray" style="margin-top:16px">ðŸ–¨ï¸ ×”×“×¤×¡ ×ž×ª×›×•×Ÿ</button>
      `;

      $("sprayResult").innerHTML = html;

      // Wire print button
      $("btnPrintSpray").onclick = () => {
        const printContent = $("sprayResult").innerHTML;
        const printWindow = window.open("", "_blank");
        printWindow.document.write(`
          <!DOCTYPE html>
          <html dir="rtl">
          <head>
            <meta charset="UTF-8">
            <title>×ž×ª×›×•×Ÿ ×ž×‘×©× ×—×“×¨ - ${escapeHtml(perf.name)}</title>
            <style>
              body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
              table { border-collapse: collapse; width: 100%; margin: 10px 0; }
              td, th { border: 1px solid #ddd; padding: 8px; text-align: right; }
              th { background: #f5f5f5; }
              .mono { font-family: monospace; }
              .pill { background: #d4a853; color: white; padding: 10px 16px; border-radius: 20px; display: inline-block; }
              h3 { margin-top: 20px; border-bottom: 2px solid #d4a853; padding-bottom: 8px; }
              .warn-box { border: 1px solid #f59e0b; background: #fffbeb; padding: 12px; border-radius: 8px; margin: 12px 0; }
              @media print { .btn { display: none; } }
            </style>
          </head>
          <body>
            <h1 style="text-align:center">ðŸŒ¸ ENIGMA - ×ž×ª×›×•×Ÿ ×ž×‘×©× ×—×“×¨</h1>
            ${printContent}
            <p style="text-align:center;margin-top:30px;color:#888">× ×•×¦×¨ ×‘-ENIGMA Perfume Manager</p>
          </body>
          </html>
        `);
        printWindow.document.close();
        printWindow.print();
      };
    };
  };


  // ==================== REED DIFFUSER CONVERSION ====================

  // IFRA Category 10A restrictions database (stricter limits)
  const IFRA_10A_RESTRICTIONS = {
    // Ingredients that are restricted or need limits in IFRA 10A
    restricted: [
      { keywords: ["limonene", "×œ×™×ž×•× ×Ÿ"], reason: "Limonene - ×ž×•×’×‘×œ ×‘-IFRA 10A", maxPercent: 15 },
      { keywords: ["citral", "×¦×™×˜×¨×œ"], reason: "Citral - ×ž×•×’×‘×œ ×ž××•×“ ×‘-IFRA 10A", maxPercent: 0.6 },
      { keywords: ["linalool", "×œ×™× ×œ×•×œ"], reason: "Linalool - ×“×•×¨×© ×‘×“×™×§×ª ×¨×™×›×•×–", maxPercent: 25 },
      { keywords: ["eugenol", "××•×’× ×•×œ"], reason: "Eugenol - ×ž×•×’×‘×œ ×‘-IFRA 10A", maxPercent: 2 },
      { keywords: ["coumarin", "×§×•×ž×¨×™×Ÿ"], reason: "Coumarin - ×ž×•×’×‘×œ ×‘-IFRA 10A", maxPercent: 1.6 },
      { keywords: ["citronellol", "×¦×™×˜×¨×•× ×œ×•×œ"], reason: "Citronellol - ×“×•×¨×© ×‘×“×™×§×”", maxPercent: 14 },
      { keywords: ["geraniol", "×’×¨× ×™××•×œ"], reason: "Geraniol - ×“×•×¨×© ×‘×“×™×§×”", maxPercent: 8.5 },
      { keywords: ["cinnamaldehyde", "×¡×™× ×ž×œ×“×”×™×“", "cinnamon", "×§×™× ×ž×•×Ÿ"], reason: "Cinnamaldehyde - ×ž×•×’×‘×œ ×ž××•×“", maxPercent: 0.5 },
      { keywords: ["isoeugenol", "××™×–×•××•×’× ×•×œ"], reason: "Isoeugenol - ××¡×•×¨ ×›×ž×¢×˜ ×œ×—×œ×•×˜×™×Ÿ", maxPercent: 0.02 }
    ],
    // High-risk citrus that often exceed limits
    citrusWarning: ["lemon", "orange", "bergamot", "grapefruit", "lime", "×ª×¤×•×–", "×œ×™×ž×•×Ÿ", "×‘×¨×’×ž×•×˜", "××©×›×•×œ×™×ª", "×œ×™×™×", "mandarin", "×ž× ×“×¨×™×Ÿ", "neroli", "× ×¨×•×œ×™"],
    // Generally safe for diffusers
    safe: ["iso e super", "vanillin", "ethyl vanillin", "hedione", "galaxolide", "cashmeran", "ambroxan"]
  };

  const checkIFRA10A = (material) => {
    if (!material) return { status: "unknown", reason: "×—×•×ž×¨ ×œ× × ×ž×¦×" };

    const name = (material.name || "").toLowerCase();

    // Check for restricted ingredients
    for (const restriction of IFRA_10A_RESTRICTIONS.restricted) {
      for (const kw of restriction.keywords) {
        if (name.includes(kw)) {
          return {
            status: "restricted",
            reason: restriction.reason,
            maxPercent: restriction.maxPercent
          };
        }
      }
    }

    // Check for citrus warning
    for (const citrus of IFRA_10A_RESTRICTIONS.citrusWarning) {
      if (name.includes(citrus)) {
        return {
          status: "warning",
          reason: "×©×ž×Ÿ ×¦×™×˜×¨×•×¡×™ - ×ž×›×™×œ Limonene/Citral ×ž×•×’×‘×œ×™×"
        };
      }
    }

    // Check if safe
    for (const safe of IFRA_10A_RESTRICTIONS.safe) {
      if (name.includes(safe)) {
        return { status: "safe", reason: "×ž×ª××™× ×œ×“×™×¤×™×•×–×¨" };
      }
    }

    // Default - needs checking
    return { status: "check", reason: "×‘×“×•×§ ×”×ª××ž×” ×œ-IFRA 10A" };
  };

  const renderReedDiffuser = () => {
    const left = $("leftPanel");
    const right = $("rightPanel");

    left.innerHTML = `
      <h2>ðŸ”„ ×”×ž×¨×•×ª</h2>
      <div class="small" style="margin-bottom:12px">×‘×—×¨ ×¡×•×’ ×”×ž×¨×”</div>

      <div style="display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap">
        <button class="btn" id="btnConvCandle" style="flex:1;min-width:80px">ðŸ•¯ï¸ × ×¨</button>
        <button class="btn" id="btnConvSpray" style="flex:1;min-width:80px">ðŸŒ¸ ×¡×¤×¨×™×™</button>
        <button class="btn success" id="btnConvDiffuser" style="flex:1;min-width:80px">ðŸªµ ×“×™×¤×™×•×–×¨</button>
      </div>

      <div class="hr"></div>
      <h3 style="margin-top:16px">ðŸªµ ×”×ž×¨×” ×œ×“×™×¤×™×•×–×¨ ×ž×§×œ×•×ª</h3>
      <div class="small" style="margin-bottom:16px">×‘×—×¨ ×‘×•×©× ×•×”×ž×¨ ××•×ª×• ×œ×“×™×¤×™×•×–×¨</div>

      <div class="field">
        <label>×‘×—×¨ ×‘×•×©×</label>
        <select id="diffuserPerfSelect">
          <option value="">-- ×‘×—×¨ ×‘×•×©× --</option>
          <optgroup label="âœ¨ ×‘×©×ž×™× ×¡×•×¤×™×™×">
            ${state.perfumesFinal.map(p => `<option value="final:${p.id}">${escapeHtml(p.name)}${p.code ? ` â€¢ ${p.code}` : ""}</option>`).join("")}
          </optgroup>
          <optgroup label="ðŸ§ª ×¤×™×ª×•×—×™×">
            ${state.perfumesDev.map(p => `<option value="dev:${p.id}">${escapeHtml(p.name)}${p.code ? ` â€¢ ${p.code}` : ""}</option>`).join("")}
          </optgroup>
        </select>
      </div>

      <div id="diffuserIngredientAnalysis" style="margin-top:16px"></div>

      <div class="hr" style="margin:20px 0"></div>

      <div class="field">
        <label>×’×•×“×œ ×‘×§×‘×•×§ (ml)</label>
        <input type="number" id="diffuserSize" value="100" min="30" max="500" step="10" style="width:120px">
      </div>

      <div class="warn-box" style="margin-top:16px;border-color:#f59e0b;background:rgba(245,158,11,0.1)">
        âš ï¸ <strong>IFRA Category 10A</strong> - ×§×˜×’×•×¨×™×” ×ž×—×ž×™×¨×”! ×™×© ×œ×‘×“×•×§ ×›×œ ×—×•×ž×¨.
      </div>

      <button class="btn success" id="btnCalculateDiffuser" style="margin-top:16px">ðŸªµ ×—×©×‘ ×¤×•×¨×ž×•×œ×ª ×“×™×¤×™×•×–×¨</button>
    `;

    right.innerHTML = `
      <h2>ðŸ“‹ ×¤×•×¨×ž×•×œ×ª ×“×™×¤×™×•×–×¨ ×ž×§×œ×•×ª</h2>
      <div id="diffuserResult">
        <p class="muted">×‘×—×¨ ×‘×•×©× ×•×’×•×“×œ ×‘×§×‘×•×§ ×œ×—×™×©×•×‘ ×”×¤×•×¨×ž×•×œ×”</p>
      </div>
    `;

    // Wire conversion type buttons
    $("btnConvCandle").onclick = () => { conversionType = "candle"; renderCandle(); };
    $("btnConvSpray").onclick = () => { conversionType = "spray"; renderCandle(); };
    $("btnConvDiffuser").onclick = () => { conversionType = "diffuser"; renderCandle(); };

    // Wire up perfume selection for analysis
    $("diffuserPerfSelect").onchange = () => {
      const val = $("diffuserPerfSelect").value;
      if (!val) {
        $("diffuserIngredientAnalysis").innerHTML = "";
        return;
      }

      const [mode, id] = val.split(":");
      const perf = (mode === "final" ? state.perfumesFinal : state.perfumesDev).find(p => p.id === id);
      if (!perf) return;

      // Analyze ingredients for IFRA 10A
      let html = '<div style="margin-top:12px"><strong>×‘×“×™×§×ª IFRA 10A:</strong></div>';
      html += '<div class="table-wrap" style="margin-top:8px"><table><thead><tr><th>×—×•×ž×¨</th><th>×›×ž×•×ª (ml)</th><th>×”×ª××ž×” ×œ×“×™×¤×™×•×–×¨</th></tr></thead><tbody>';

      const rows = perf.rows || [];
      let hasRestricted = false;
      let hasWarning = false;

      rows.forEach(r => {
        if (!r.materialId || r.ml <= 0) return;
        const mat = getMaterial(r.materialId);
        const analysis = checkIFRA10A(mat);

        let statusIcon, statusClass;
        if (analysis.status === "restricted") {
          statusIcon = "âš ï¸";
          statusClass = "color:#ef4444";
          hasRestricted = true;
        } else if (analysis.status === "warning") {
          statusIcon = "âš ï¸";
          statusClass = "color:#f59e0b";
          hasWarning = true;
        } else if (analysis.status === "check") {
          statusIcon = "â“";
          statusClass = "color:#6b7280";
        } else {
          statusIcon = "âœ…";
          statusClass = "color:#22c55e";
        }

        html += `<tr>
          <td>${escapeHtml(mat ? mat.name : r.materialId)}</td>
          <td class="mono">${fmt(r.ml, 2)}</td>
          <td style="${statusClass}">${statusIcon} ${escapeHtml(analysis.reason)}</td>
        </tr>`;
      });

      html += '</tbody></table></div>';

      if (hasRestricted) {
        html += '<div class="warn-box" style="margin-top:12px;border-color:#ef4444;background:rgba(239,68,68,0.1)">âš ï¸ <strong>××–×”×¨×”:</strong> ×™×© ×—×•×ž×¨×™× ×ž×•×’×‘×œ×™× ×‘-IFRA 10A. ×‘×“×•×§ ×¨×™×›×•×–×™× ×œ×¤× ×™ ×©×™×ž×•×©!</div>';
      }
      if (hasWarning) {
        html += '<div class="warn-box" style="margin-top:8px;border-color:#f59e0b;background:rgba(245,158,11,0.1)">ðŸ’¡ <strong>×©×™× ×œ×‘:</strong> ×©×ž× ×™× ×¦×™×˜×¨×•×¡×™×™× ×ž×›×™×œ×™× ×¨×›×™×‘×™× ×ž×•×’×‘×œ×™×. ×©×§×•×œ ×œ×”×¤×—×™×ª ×›×ž×•×ª.</div>';
      }

      $("diffuserIngredientAnalysis").innerHTML = html;
    };

    // Wire up calculate button
    $("btnCalculateDiffuser").onclick = () => {
      const val = $("diffuserPerfSelect").value;
      const diffuserSize = num($("diffuserSize").value, 100);

      if (!val) {
        alert("× × ×œ×‘×—×•×¨ ×‘×•×©×!");
        return;
      }

      if (diffuserSize < 30 || diffuserSize > 500) {
        alert("×’×•×“×œ ×‘×§×‘×•×§ ×—×™×™×‘ ×œ×”×™×•×ª ×‘×™×Ÿ 30 ×œ-500 ml");
        return;
      }

      const [mode, id] = val.split(":");
      const perf = (mode === "final" ? state.perfumesFinal : state.perfumesDev).find(p => p.id === id);
      if (!perf) return;

      // Reed diffuser formula: DPG 50%, Alcohol 25%, Fragrance 25%
      const dpgPercent = 50;
      const alcoholPercent = 25;
      const fragrancePercent = 25;

      const dpgAmount = diffuserSize * (dpgPercent / 100);
      const alcoholAmount = diffuserSize * (alcoholPercent / 100);
      const fragranceAmount = diffuserSize * (fragrancePercent / 100);

      // Get perfume ingredients (excluding DPG and alcohol which we add separately)
      const rows = (perf.rows || []).filter(r => {
        if (!r.materialId || r.ml <= 0) return false;
        return r.materialId !== "MAT_ALC" && r.materialId !== "MAT_DPG";
      });

      // Calculate total fragrance ml from original formula
      let totalOriginalMl = 0;
      rows.forEach(r => { totalOriginalMl += num(r.ml, 0); });

      if (totalOriginalMl === 0) {
        $("diffuserResult").innerHTML = '<div class="warn-box">âŒ ××™×Ÿ ×—×•×ž×¨×™ ×¨×™×— ×‘×¤×•×¨×ž×•×œ×” ×–×•</div>';
        return;
      }

      // Calculate each ingredient amount and check IFRA
      const ingredientAmounts = rows.map(r => {
        const mat = getMaterial(r.materialId);
        const ratio = r.ml / totalOriginalMl;
        const amount = fragranceAmount * ratio;
        const ifraCheck = checkIFRA10A(mat);
        return {
          name: mat ? mat.name : r.materialId,
          originalMl: r.ml,
          ratio: ratio * 100,
          amount: amount,
          ifraStatus: ifraCheck.status,
          ifraReason: ifraCheck.reason,
          maxPercent: ifraCheck.maxPercent
        };
      });

      // Check for IFRA issues
      const restrictedIngredients = ingredientAmounts.filter(i => i.ifraStatus === "restricted" || i.ifraStatus === "warning");

      // Build result HTML
      let html = `
        <div class="pill" style="font-size:1.1rem;padding:10px 16px;background:var(--accent);color:var(--bg);margin-bottom:16px">
          ðŸªµ ${escapeHtml(perf.name)} - ×“×™×¤×™×•×–×¨ ${diffuserSize} ml
        </div>

        <h3 style="margin-top:16px">ðŸ§ª ×”×¨×›×‘ ×‘×¡×™×¡</h3>
        <table style="margin:12px 0">
          <tr><td style="padding:4px 12px">DPG (${dpgPercent}%)</td><td class="mono" style="padding:4px 12px">${fmt(dpgAmount, 1)} ml</td></tr>
          <tr><td style="padding:4px 12px">××œ×›×•×”×•×œ (${alcoholPercent}%)</td><td class="mono" style="padding:4px 12px">${fmt(alcoholAmount, 1)} ml</td></tr>
        </table>

        <h3 style="margin-top:20px">ðŸŒ¸ ×”×¨×›×‘ ×¨×™×— (${fragrancePercent}% = ${fmt(fragranceAmount, 1)} ml)</h3>
        <div class="table-wrap" style="margin:12px 0">
          <table>
            <thead><tr><th>×—×•×ž×¨</th><th>××—×•×–</th><th>×›×ž×•×ª</th><th>IFRA 10A</th></tr></thead>
            <tbody>
      `;

      ingredientAmounts.forEach(ing => {
        let statusHtml;
        if (ing.ifraStatus === "restricted") {
          statusHtml = `<span style="color:#ef4444">âš ï¸ ×ž×•×’×‘×œ${ing.maxPercent ? ` (×ž×§×¡ ${ing.maxPercent}%)` : ""}</span>`;
        } else if (ing.ifraStatus === "warning") {
          statusHtml = `<span style="color:#f59e0b">âš ï¸ ${escapeHtml(ing.ifraReason)}</span>`;
        } else if (ing.ifraStatus === "check") {
          statusHtml = '<span style="color:#6b7280">â“ ×œ×‘×“×™×§×”</span>';
        } else {
          statusHtml = '<span style="color:#22c55e">âœ… OK</span>';
        }

        html += `<tr>
          <td>${escapeHtml(ing.name)}</td>
          <td class="mono">${fmt(ing.ratio, 1)}%</td>
          <td class="mono" style="font-weight:600">${fmt(ing.amount, 2)} ml</td>
          <td>${statusHtml}</td>
        </tr>`;
      });

      html += `
            </tbody>
          </table>
        </div>
      `;

      // Show IFRA warnings if any
      if (restrictedIngredients.length > 0) {
        html += `
          <div class="warn-box" style="margin-top:16px;border-color:#ef4444;background:rgba(239,68,68,0.1)">
            <strong>âš ï¸ ××–×”×¨×•×ª IFRA Category 10A:</strong>
            <ul style="margin:8px 0 0 0;padding-right:20px">
        `;
        restrictedIngredients.forEach(ing => {
          html += `<li><strong>${escapeHtml(ing.name)}:</strong> ${escapeHtml(ing.ifraReason)}</li>`;
        });
        html += `
            </ul>
            <p style="margin-top:8px;font-size:0.9rem">ðŸ’¡ ×©×§×•×œ ×œ×”×¤×—×™×ª ×¨×™×›×•×– ××• ×œ×”×—×œ×™×£ ×‘×—×•×ž×¨×™× ×‘×˜×•×—×™× ×™×•×ª×¨</p>
          </div>
        `;
      }

      html += `
        <div class="hr" style="margin:20px 0"></div>

        <h3>ðŸ“Š ×¡×™×›×•×</h3>
        <table style="margin:12px 0;font-size:1.1rem">
          <tr style="font-weight:600"><td style="padding:6px 12px">DPG</td><td class="mono" style="padding:6px 12px">${fmt(dpgAmount, 1)} ml</td></tr>
          <tr style="font-weight:600"><td style="padding:6px 12px">××œ×›×•×”×•×œ</td><td class="mono" style="padding:6px 12px">${fmt(alcoholAmount, 1)} ml</td></tr>
          <tr style="font-weight:600"><td style="padding:6px 12px">×ª×ž×¦×™×ª ×¨×™×—</td><td class="mono" style="padding:6px 12px">${fmt(fragranceAmount, 1)} ml</td></tr>
          <tr style="font-weight:700;background:rgba(212,168,83,0.2)"><td style="padding:8px 12px">×¡×”"×›</td><td class="mono" style="padding:8px 12px">${fmt(diffuserSize, 1)} ml</td></tr>
        </table>
      `;

      // Calculate and display cost for diffuser
      const diffuserCostIngredients = [
        { name: 'DPG', amount: dpgAmount, type: 'dpg' },
        { name: '××œ×›×•×”×•×œ', amount: alcoholAmount, type: 'alcohol' }
      ];
      // Add fragrance ingredients
      ingredientAmounts.forEach(ing => {
        const originalRow = rows.find(r => {
          const mat = getMaterial(r.materialId);
          return mat && mat.name === ing.name;
        });
        diffuserCostIngredients.push({
          name: ing.name,
          amount: ing.amount,
          materialId: originalRow ? originalRow.materialId : null
        });
      });

      const diffuserCostBreakdown = calculateCostBreakdown(diffuserCostIngredients, { unit: 'ml' });
      html += renderCostBreakdown(diffuserCostBreakdown, 'ðŸ’° ×¢×œ×•×ª ×ž×©×•×¢×¨×ª ×œ×“×™×¤×™×•×–×¨');

      html += `
        <div class="hr" style="margin:20px 0"></div>

        <h3>ðŸ“ ×”×•×¨××•×ª ×”×›× ×”</h3>
        <ol style="margin:12px 0;padding-right:24px;line-height:1.8">
          <li>×ž×“×•×“ ××ª ×”-DPG ×œ×‘×§×‘×•×§ ×”×“×™×¤×™×•×–×¨</li>
          <li>×”×•×¡×£ ××ª ×”××œ×›×•×”×•×œ ×•×¢×¨×‘×‘</li>
          <li>×”×•×¡×£ ××ª ×›×œ ×—×•×ž×¨×™ ×”×¨×™×— ×‘×–×” ××—×¨ ×–×”</li>
          <li>×¢×¨×‘×‘ ×”×™×˜×‘ ××• × ×¢×¨ ××ª ×”×‘×§×‘×•×§</li>
          <li><strong>×”×ž×ª×Ÿ 48 ×©×¢×•×ª ×œ×¤× ×™ ×”×›× ×¡×ª ×ž×§×œ×•×ª</strong></li>
          <li>×”×›× ×¡ 6-8 ×ž×§×œ×•×ª ×¨××˜×Ÿ</li>
          <li>×”×¤×•×š ××ª ×”×ž×§×œ×•×ª ×¤×¢× ×‘×©×‘×•×¢</li>
        </ol>

        <div class="warn-box" style="margin-top:16px">
          ðŸ’¡ <strong>×˜×™×¤×™×:</strong>
          <ul style="margin:8px 0 0 0;padding-right:20px">
            <li>×”×©×ª×ž×© ×‘×‘×§×‘×•×§ ×¢× ×¤×ª×— ×¦×¨</li>
            <li>×¤×—×•×ª ×ž×§×œ×•×ª = ×¨×™×— ×¢×“×™×Ÿ ×™×•×ª×¨</li>
            <li>×™×•×ª×¨ ×ž×§×œ×•×ª = ×¨×™×— ×—×–×§ ×™×•×ª×¨</li>
            <li>×”×—×œ×£ ×ž×§×œ×•×ª ×›×œ 2-3 ×—×•×“×©×™×</li>
            <li>×”×¨×—×§ ×ž××•×¨ ×©×ž×© ×™×©×™×¨</li>
          </ul>
        </div>

        <button class="btn" id="btnPrintDiffuser" style="margin-top:16px">ðŸ–¨ï¸ ×”×“×¤×¡ ×ž×ª×›×•×Ÿ</button>
      `;

      $("diffuserResult").innerHTML = html;

      // Wire print button
      $("btnPrintDiffuser").onclick = () => {
        const printContent = $("diffuserResult").innerHTML;
        const printWindow = window.open("", "_blank");
        printWindow.document.write(`
          <!DOCTYPE html>
          <html dir="rtl">
          <head>
            <meta charset="UTF-8">
            <title>×ž×ª×›×•×Ÿ ×“×™×¤×™×•×–×¨ - ${escapeHtml(perf.name)}</title>
            <style>
              body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
              table { border-collapse: collapse; width: 100%; margin: 10px 0; }
              td, th { border: 1px solid #ddd; padding: 8px; text-align: right; }
              th { background: #f5f5f5; }
              .mono { font-family: monospace; }
              .pill { background: #d4a853; color: white; padding: 10px 16px; border-radius: 20px; display: inline-block; }
              h3 { margin-top: 20px; border-bottom: 2px solid #d4a853; padding-bottom: 8px; }
              .warn-box { border: 1px solid #f59e0b; background: #fffbeb; padding: 12px; border-radius: 8px; margin: 12px 0; }
              @media print { .btn { display: none; } }
            </style>
          </head>
          <body>
            <h1 style="text-align:center">ðŸªµ ENIGMA - ×ž×ª×›×•×Ÿ ×“×™×¤×™×•×–×¨ ×ž×§×œ×•×ª</h1>
            ${printContent}
            <p style="text-align:center;margin-top:30px;color:#888">× ×•×¦×¨ ×‘-ENIGMA Perfume Manager</p>
          </body>
          </html>
        `);
        printWindow.document.close();
        printWindow.print();
      };
    };
  };

  // ==================== AI PERFUME BUILDER ====================

  // AI Builder State
  let aiBuilderState = {
    method: 'search', // 'search' or 'image'
    currentPerfume: null,
    currentMatches: null,
    currentFormula: null,
    uploadedImage: null,
    apiKey: localStorage.getItem('claudeApiKey') || ''
  };

  // ========== ENIGMA PARFUME MASTER RULES V3.4 ==========

  // Usage limits per 50ml (CRITICAL! NEVER EXCEED!)
  const maxUsageLimits = {
    // Aldehydes
    "Aldehyde C-7 10%": 0.03,
    "Aldehyde C-11": 0.04,
    "Aldehyde C-12 Lauric 10%": 0.05,
    "Mandarin Aldehyde": 0.01,
    "Cyclamen Aldehyde": 0.15,
    "Anisic Aldehyde": 0.22,
    "Hydratropic Aldehyde": 0.08,
    "Para Tolyl Aldehyde": 0.2,
    "Maltol Isobutyrate": 0.13,
    "Heliotropin 20% DPG": 0.5,
    "Hexyl Cinnamic Aldehyde": 1.0,
    // Modulators
    "Hedione": 7.5,
    "HedioneÂ®": 7.5,
    "Cashmeran": 2.0,
    "CashmeranÂ®": 2.0,
    "Galaxolide 50%": 5.0,
    "GalaxolideÂ® 50% IPM": 5.0,
    "Coumarin": 0.75,
    "Ethyl Maltol": 0.5,
    "Ethyl Vanillin": 0.5,
    "Vanillin Signature": 0.5,
    // Dangerous oils (10% dilution)
    "Cinnamon 10%": 0.3,
    "Clove 10%": 0.3,
    "Thyme 10%": 0.3,
    // IFRA Category 4 limits (at 40% concentration)
    "Oakmoss": 0.125 // 0.1% max in final product
  };

  // Fixatives list - minimum 3-4 per formula!
  const FIXATIVES = [
    "Iso E Super", "ISO E Super",
    "Another 13", "Another 13 23",
    "Benzoin 50%",
    "Sandalwood 50%",
    "Patchouli 50%",
    "Cedarwood 50%",
    "Vetiver Java 50%",
    "Frankincense 50%",
    "Myrrh 50%",
    "Labdanum 50%", "Labdanum Light Absolute 50% TEC",
    "Cashmeran", "CashmeranÂ®",
    "Galaxolide 50%", "GalaxolideÂ® 50% IPM",
    "Vanillin Signature",
    "White Musk",
    // Also marked as fixatives in extracts
    "Bois d'Argent", "Bois d'Argent 11",
    "Flowerbomb", "Flowerbomb 13",
    "Narciso Poudree", "Narciso Poudree 3",
    "Ombre Nomade", "Ombre Nomade 24",
    "Sakura", "Sakura 15",
    "×¨×™×— ×œ×™×œ×Ÿ", "×¨×™×— ×œ×™×œ×Ÿ 20"
  ];

  // Complete ENIGMA Inventory (127 materials)
  const ENIGMA_INVENTORY = {
    // Constants
    constants: [
      { id: "MAT_ISO", name: "Iso E Super", role: "×ž×•×“×•×œ×˜×•×¨ ×¨××©×™", fixative: true },
      { id: "MAT_DPG", name: "DPG", role: "×ž×ž×¡/×ž×“×œ×œ" },
      { id: "MAT_CIT", name: "Citrofol F", role: "×‘×”×™×¨×•×ª/×©×™×ž×•×¨" },
      { id: "MAT_ALC", name: "Alcohol", role: "× ×©×" }
    ],
    // Extracts (25)
    extracts: [
      { id: "MAT_00005", name: "Accento 1", notes: "×× × ×¡, ×”×™××¡×™× ×ª, ××™×¨×™×¡, ×™×¡×ž×™×Ÿ, ×¤×œ×¤×œ ×•×¨×•×“, ×ž×•×¡×§" },
      { id: "MAT_00006", name: "Another 13 23", notes: "87% Ambroxan, ×ž×•×¡×§×™-×ž×™× ×¨×œ×™", fixative: true },
      { id: "MAT_00007", name: "Aventus For Her 2", notes: "×× × ×¡, ×¤×œ×¤×œ ×•×¨×•×“, ×‘×¨×–×”, ×ž×•×¡×§" },
      { id: "MAT_00008", name: "Bois d'Argent 11", notes: "×¡× ×“×œ×•×•×“, ××™×¨×™×¡, ×“×‘×©", fixative: true },
      { id: "MAT_00009", name: "Cherry In Japan 12", notes: "×“×•×‘×“×‘×Ÿ ×¢×¡×™×¡×™" },
      { id: "MAT_00010", name: "Citrus Shadow 7", notes: "×œ×™×™×, ×‘×–×™×œ×™×§×•×, ×ž× ×“×¨×™× ×”" },
      { id: "MAT_00011", name: "Dior J'adore 14", notes: "××™×œ× ×’, ×•×¨×“ ×“×ž×©×§, ×™×¡×ž×™×Ÿ ×¡×ž×‘×§" },
      { id: "MAT_00012", name: "Earl Grey Harmony 25", notes: "×‘×¨×’×ž×•×˜, ×ª×”, ×•×™×•×œ×˜, ×§×©×ž×™×¨" },
      { id: "MAT_00013", name: "Erba Pura 5", notes: "×•× ×™×œ, ×ž×•×¡×§ ×œ×‘×Ÿ, ×ª×¤×•×–, ×‘×¨×’×ž×•×˜" },
      { id: "MAT_00014", name: "Flowerbomb 13", notes: "×™×¡×ž×™×Ÿ, ×•×¨×“, ×¡×—×œ×‘, ×¤×¦'×•×œ×™, ×˜×•× ×§×”", fixative: true },
      { id: "MAT_00015", name: "Fresh Mix 21", notes: "××‘×˜×™×—, ×§×¡×™×¡, ×™×¨×•×§, ××¤×¨×¡×§" },
      { id: "MAT_00016", name: "Honeysuckle 18", notes: "×™×¢×¨×”, ×“×‘×©, ×™×¨×•×§" },
      { id: "MAT_00017", name: "LIAV 19", notes: "×•×¨×“, ×¤×™×¨×•×ª ××“×•×ž×™×, ××‘×§×ª×™, ×ž×–×¨×—×™" },
      { id: "MAT_00018", name: "La Tulipe 10", notes: "×¦×‘×¢×•× ×™, ×•×¨×“, ×•×˜×™×‘×¨" },
      { id: "MAT_00019", name: "Miss Delicious 22", notes: "×•× ×™×œ, ×§×¨×ž×œ, ×©×§×“" },
      { id: "MAT_00020", name: "Montale Roses Musk 6", notes: "×•×¨×“ ×˜×•×¨×§×™, ×ž×•×¡×§ ×œ×‘×Ÿ, ×¢× ×‘×¨" },
      { id: "MAT_00021", name: "Narciso Poudree 3", notes: "××™×¨×™×¡, ×ž×•×¡×§ ×œ×‘×Ÿ, ××‘×§×ª×™", fixative: true },
      { id: "MAT_00022", name: "Ombre Nomade 24", notes: "××•×“, ×œ×‘×•× ×”, ×‘× ×–×•××™×Ÿ", fixative: true },
      { id: "MAT_00023", name: "Sakura 15", notes: "×¤×¨×™×—×ª ×“×•×‘×“×‘×Ÿ, ××’×¡, ×¡× ×“×œ×•×•×“", fixative: true },
      { id: "MAT_00024", name: "So Scandal 8", notes: "×ž×ª×•×§, ×¤×¨×—×•× ×™" },
      { id: "MAT_00025", name: "White Musk", notes: "×ž×•×¡×§ × ×§×™", fixative: true },
      { id: "MAT_00026", name: "Xeryus Rouge 16", notes: "××¨×–, ×˜×•× ×§×”" },
      { id: "MAT_00027", name: "YSL Libre 4", notes: "×œ×‘× ×“×¨, ×¤×¨×™×—×ª ×ª×¤×•×–" },
      { id: "MAT_00028", name: "×¨×™×— ×œ×™×œ×Ÿ 20", notes: "×˜×•× ×§×”, ×•× ×™×œ, ×¤×¦'×•×œ×™, ×¢× ×‘×¨", fixative: true },
      { id: "MAT_00029", name: "DON ROSA 9", notes: "×•×¨×“, ×ª×•×ª, ×¤×˜×œ, ×¤×¨×—×•× ×™" }
    ],
    // Essential Oils (42)
    essentialOils: [
      { id: "MAT_00030", name: "Artemisia 50%", dilution: "50%", layer: "Heart" },
      { id: "MAT_00031", name: "Benzoin 50%", dilution: "50%", layer: "Base", fixative: true },
      { id: "MAT_00033", name: "Black Pepper 50%", dilution: "50%", layer: "Heart" },
      { id: "MAT_00034", name: "Blood Orange 50%", dilution: "50%", layer: "Top" },
      { id: "MAT_00035", name: "Cardamom 50%", dilution: "50%", layer: "Heart" },
      { id: "MAT_00036", name: "Cedarwood 50%", dilution: "50%", layer: "Base", fixative: true },
      { id: "MAT_00037", name: "Cinnamon 10%", dilution: "10%", layer: "Heart", maxMl: 0.3 },
      { id: "MAT_00038", name: "Clove 10%", dilution: "10%", layer: "Heart", maxMl: 0.3 },
      { id: "MAT_00039", name: "Cypress 50%", dilution: "50%", layer: "Heart" },
      { id: "MAT_00040", name: "Elemi 50%", dilution: "50%", layer: "Top" },
      { id: "MAT_00041", name: "Frankincense 50%", dilution: "50%", layer: "Base", fixative: true },
      { id: "MAT_00042", name: "Ginger 50%", dilution: "50%", layer: "Heart" },
      { id: "MAT_00043", name: "Ho-Wood 50%", dilution: "50%", layer: "Heart" },
      { id: "MAT_00044", name: "Juniper Berries 50%", dilution: "50%", layer: "Top" },
      { id: "MAT_00045", name: "Lavender High Altitude 50%", dilution: "50%", layer: "Heart" },
      { id: "MAT_00046", name: "Lemon 50%", dilution: "50%", layer: "Top" },
      { id: "MAT_00047", name: "Lemongrass 50%", dilution: "50%", layer: "Top" },
      { id: "MAT_00048", name: "Mandarin 50%", dilution: "50%", layer: "Top" },
      { id: "MAT_00049", name: "Myrrh 50%", dilution: "50%", layer: "Base", fixative: true },
      { id: "MAT_00050", name: "Myrtle 50%", dilution: "50%", layer: "Heart" },
      { id: "MAT_00051", name: "Nutmeg 50%", dilution: "50%", layer: "Heart" },
      { id: "MAT_00052", name: "Orange Sweet 50%", dilution: "50%", layer: "Top" },
      { id: "MAT_00053", name: "Patchouli 50%", dilution: "50%", layer: "Base", fixative: true },
      { id: "MAT_00054", name: "Peppermint 50%", dilution: "50%", layer: "Top" },
      { id: "MAT_00055", name: "Petitgrain 50%", dilution: "50%", layer: "Top" },
      { id: "MAT_00056", name: "Rosemary 50%", dilution: "50%", layer: "Heart" },
      { id: "MAT_00057", name: "Sage 50%", dilution: "50%", layer: "Heart" },
      { id: "MAT_00058", name: "Sandalwood 50%", dilution: "50%", layer: "Base", fixative: true },
      { id: "MAT_00059", name: "Vetiver Java 50%", dilution: "50%", layer: "Base", fixative: true },
      { id: "MAT_00060", name: "Ylang Ylang Complete 50%", dilution: "50%", layer: "Heart" },
      { id: "MAT_00061", name: "Yuzu 50%", dilution: "50%", layer: "Top" },
      { id: "MAT_00062", name: "Spearmint 50%", dilution: "50%", layer: "Top" },
      { id: "MAT_00064", name: "Thyme 10%", dilution: "10%", layer: "Heart", maxMl: 0.3 },
      { id: "MAT_00065", name: "Grapefruit 50%", dilution: "50%", layer: "Top" },
      { id: "MAT_00069", name: "Bergamot FCF 50%", dilution: "50%", layer: "Top" },
      { id: "MAT_00070", name: "Lime 50%", dilution: "50%", layer: "Top" },
      { id: "MAT_00071", name: "Peppermint Arvensis 50%", dilution: "50%", layer: "Top" },
      { id: "MAT_00072", name: "Peppermint Piperita 50%", dilution: "50%", layer: "Top" },
      { id: "MAT_00073", name: "Petitgrain Myrtle 50%", dilution: "50%", layer: "Top" },
      { id: "MAT_00074", name: "GERANIUM", dilution: "-", layer: "Heart" },
      { id: "MAT_00075", name: "CITUS", dilution: "-", layer: "Top" },
      { id: "MAT_00119", name: "NEROLI OIL NI", dilution: "-", layer: "Top", maxMl: 0.5 }
    ],
    // Aromachemicals (56)
    aromachemicals: {
      aldehydes: [
        { id: "MAT_00076", name: "Aldehyde C-11", maxMl: 0.04, layer: "Top" },
        { id: "MAT_00077", name: "Aldehyde C-12 Lauric 10%", maxMl: 0.05, layer: "Top" },
        { id: "MAT_00078", name: "Aldehyde C-7 10%", maxMl: 0.03, layer: "Top" },
        { id: "MAT_00079", name: "Anisic Aldehyde", maxMl: 0.22, layer: "Heart" },
        { id: "MAT_00080", name: "Cyclamen Aldehyde", maxMl: 0.15, layer: "Top" },
        { id: "MAT_00081", name: "Heliotropin 20% DPG", maxMl: 0.5, layer: "Heart" },
        { id: "MAT_00082", name: "Hydratropic Aldehyde", maxMl: 0.08, layer: "Heart" },
        { id: "MAT_00083", name: "Maltol Isobutyrate", maxMl: 0.13, layer: "Heart" },
        { id: "MAT_00084", name: "Mandarin Aldehyde", maxMl: 0.01, layer: "Top" },
        { id: "MAT_00085", name: "Para Tolyl Aldehyde", maxMl: 0.2, layer: "Heart" },
        { id: "MAT_00103", name: "Hexyl Cinnamic Aldehyde", maxMl: 1.0, layer: "Heart" },
        { id: "MAT_00104", name: "Aldemone", maxMl: null, layer: "Heart" }
      ],
      modulators: [
        { id: "MAT_00087", name: "HedioneÂ®", maxMl: 7.5, role: "Bridge Material" },
        { id: "MAT_00091", name: "CashmeranÂ®", maxMl: 2.0, role: "×ž×•×¡×§×™-×¢×¦×™", fixative: true },
        { id: "MAT_00092", name: "GalaxolideÂ® 50% IPM", maxMl: 5.0, role: "×ž×•×¡×§ ×œ×‘×Ÿ", fixative: true },
        { id: "MAT_00090", name: "Coumarin", maxMl: 0.75, role: "×©×§×“×™-×—×" },
        { id: "MAT_00089", name: "Ethyl Maltol", maxMl: 0.5, role: "×ž×ª×™×§×•×ª" },
        { id: "MAT_00088", name: "Ethyl Vanillin", maxMl: 0.5, role: "×•× ×™×œ" },
        { id: "MAT_00086", name: "Vanillin Signature", maxMl: 0.5, role: "×•× ×™×œ", fixative: true }
      ],
      florals: [
        { id: "MAT_00114", name: "Ylang ImpÃ©riale", use: "××™×œ× ×’" },
        { id: "MAT_00115", name: "Tuberose Supreme", use: "×˜×•×‘×¨×•×–" },
        { id: "MAT_00116", name: "Narcisse Base 184092D", use: "× ×¨×§×™×¡" },
        { id: "MAT_00117", name: "Tilleul (Linden Blossom)", use: "×˜×™×œ×™×”" },
        { id: "MAT_00118", name: "Rose Orientale", use: "×•×¨×“ ×ž×–×¨×—×™" },
        { id: "MAT_00120", name: "Methyl Tuberate 10% DPG", use: "×˜×•×‘×¨×•×–" }
      ],
      greenFruity: [
        { id: "MAT_00066", name: "Violet Leaf Absolute France 1% TEC", use: "×•×™×•×œ×˜ ×¢×œ×™×" },
        { id: "MAT_00111", name: "Cis-3-Hexenyl Cis-3-Hexanoate 10% DPG", use: "×™×¨×•×§" },
        { id: "MAT_00113", name: "Verdox HC", use: "×™×¨×•×§" },
        { id: "MAT_00106", name: "Aphermate", use: "×¤×¨×—×•× ×™-×™×¨×•×§" },
        { id: "MAT_00105", name: "CaloneÂ® 1951 50%", use: "×™×ž×™" },
        { id: "MAT_00107", name: "Ethyl Butyrate", use: "×¤×™×¨×•×ª×™" },
        { id: "MAT_00108", name: "Isoamyl Acetate", use: "×‘× × ×”" },
        { id: "MAT_00109", name: "Hexyl Isovalerate", use: "×¤×™×¨×•×ª×™" },
        { id: "MAT_00110", name: "Hexyl Acetate", use: "×¤×™×¨×•×ª×™" }
      ],
      woodyResinous: [
        { id: "MAT_00067", name: "Labdanum Light Absolute 50% TEC", use: "×¢× ×‘×¨×™", fixative: true },
        { id: "MAT_00094", name: "Vetiver Acetate 53281", use: "×•×˜×™×‘×¨" },
        { id: "MAT_00112", name: "FauxmossÂ®", use: "××•×§×ž×•×¡" },
        { id: "MAT_00093", name: "Safranal", use: "×¡×¤×¨×Ÿ" }
      ],
      oudLeather: [
        { id: "MAT_00121", name: "Oudhbois", use: "×¢×•×“" },
        { id: "MAT_00122", name: "Pretty Oud", use: "×¢×•×“ ×¨×š" },
        { id: "MAT_00123", name: "Leather Oud 10% DPG", use: "×¢×•×“-×¢×•×¨" },
        { id: "MAT_00124", name: "Aetoxylon White Oud Oil", use: "×¢×•×“ ×œ×‘×Ÿ" },
        { id: "MAT_00125", name: "Royal Leather", use: "×¢×•×¨" },
        { id: "MAT_00126", name: "Cuir de Russie", use: "×¢×•×¨ ×¨×•×¡×™" },
        { id: "MAT_00127", name: "SuederalÂ® LT 0710", use: "×–×ž×©" }
      ],
      gourmand: [
        { id: "MAT_00131", name: "Coffee CO2", use: "×§×¤×”" },
        { id: "MAT_00095", name: "Amaretto Saronno", use: "×©×§×“-××ž×¨×˜×•" },
        { id: "MAT_00096", name: "Rum CO2 10% TEC", use: "×¨×•×" },
        { id: "MAT_00098", name: "Milk Lactone", use: "×—×œ×‘×™" },
        { id: "MAT_00099", name: "Delta Nonalactone", use: "×§×•×§×•×¡-×§×¨×ž×™" },
        { id: "MAT_00156", name: "Pistachio Thiazole 1% DPG", use: "×¤×™×¡×˜×•×§" }
      ],
      others: [
        { id: "MAT_00068", name: "Pink Peppercorn Molle Oil", use: "×¤×œ×¤×œ ×•×¨×•×“" },
        { id: "MAT_00100", name: "Linalool Oxide", use: "×¤×¨×—×•× ×™-×ª×‘×œ×™× ×™" },
        { id: "MAT_00101", name: "Phenyl Ethyl Tiglate", use: "×¤×¨×—×•× ×™" },
        { id: "MAT_00102", name: "Phenoxy Ethyl Isobutyrate", use: "×¤×¨×—×•× ×™-×¤×™×¨×•×ª×™" },
        { id: "MAT_00097", name: "Isobutyl Phenyl Acetate", use: "×¤×¨×—×•× ×™" }
      ]
    }
  };

  // Perfume type concentration ratios
  const PERFUME_TYPE_RATIOS = {
    "Citrus/Fresh": { fragrance: "18-22%", alcohol: "60-65%", modulators: "16-20%" },
    "Floral/Light": { fragrance: "22-26%", alcohol: "58-62%", modulators: "16-18%" },
    "Oriental/Amber": { fragrance: "26-30%", alcohol: "54-58%", modulators: "16-18%" },
    "Woody/Oud": { fragrance: "28-32%", alcohol: "52-56%", modulators: "16-18%" },
    "Gourmand": { fragrance: "24-28%", alcohol: "56-60%", modulators: "16-18%" }
  };

  // Pyramid architecture
  const PYRAMID_RULES = {
    top: { min: 15, max: 20, duration: "15-120 ×“×§×•×ª" },
    heart: { min: 30, max: 40, duration: "2-4 ×©×¢×•×ª" },
    base: { min: 40, max: 55, duration: "4+ ×©×¢×•×ª" }
  };

  // Maceration times
  const MACERATION_TIMES = {
    "Citrus/Fresh": { min: "1-2 ×©×‘×•×¢×•×ª", optimal: "2-4 ×©×‘×•×¢×•×ª" },
    "Floral": { min: "2-3 ×©×‘×•×¢×•×ª", optimal: "4-6 ×©×‘×•×¢×•×ª" },
    "Oriental/Woody": { min: "4 ×©×‘×•×¢×•×ª", optimal: "6-12 ×©×‘×•×¢×•×ª" },
    "Gourmand": { min: "4 ×©×‘×•×¢×•×ª", optimal: "6-12 ×©×‘×•×¢×•×ª" },
    "Oud/Heavy": { min: "6 ×©×‘×•×¢×•×ª", optimal: "3-6 ×—×•×“×©×™×" }
  };

  // Note translations to match inventory
  const noteTranslationsAI = {
    "rose": ["Montale Roses Musk", "Rose Orientale", "LIAV", "DON ROSA"],
    "oud": ["Ombre Nomade 24", "Oudhbois", "Pretty Oud", "Leather Oud 10% DPG"],
    "saffron": ["Safranal", "Cardamom 50%"],
    "jasmine": ["Hedione", "Dior J'adore", "So Scandal"],
    "vanilla": ["Vanillin Signature", "Benzoin 50%", "Miss Delicious"],
    "sandalwood": ["Sandalwood 50%", "Bois d'Argent", "Sakura"],
    "amber": ["Iso E Super", "Labdanum 50%", "Erba Pura"],
    "musk": ["White Musk", "Galaxolide 50%", "Narciso Poudree"],
    "benzoin": ["Benzoin 50%", "Ombre Nomade 24"],
    "patchouli": ["Patchouli 50%", "Flowerbomb", "LIAV"],
    "cedar": ["Cedarwood 50%", "Xeryus Rouge"],
    "bergamot": ["Bergamot FCF 50%", "Citrus Shadow"],
    "orange blossom": ["YSL Libre", "Petitgrain 50%"],
    "tonka": ["Coumarin", "Flowerbomb", "×¨×™×— ×œ×™×œ×Ÿ"],
    "violet": ["Violet Leaf Absolute France 1% TEC", "Cyclamen Aldehyde"],
    "iris": ["Accento 1", "Bois d'Argent"],
    "lavender": ["Lavender High Altitude 50%", "YSL Libre"],
    "ylang": ["Ylang Ylang Complete 50%", "Ylang ImpÃ©riale", "Dior J'adore"],
    "frankincense": ["Frankincense 50%", "Ombre Nomade 24"],
    "vetiver": ["Vetiver Java 50%", "La Tulipe"],
    "cardamom": ["Cardamom 50%"],
    "cinnamon": ["Cinnamon 10%"],
    "pink pepper": ["Pink Peppercorn Molle Oil", "Aventus For Her 2"],
    "honey": ["So Scandal", "Honeysuckle"],
    "caramel": ["Miss Delicious", "Ethyl Maltol"],
    "cherry": ["Cherry In Japan 12", "Sakura"],
    "peach": ["Fresh Mix 21", "×¨×™×— ×œ×™×œ×Ÿ"],
    "raspberry": ["Ombre Nomade 24"],
    "tuberose": ["Tuberose Supreme", "Methyl Tuberate 10% DPG"]
  };

  const renderAIBuilder = () => {
    const left = $("leftPanel");
    const right = $("rightPanel");

    // Check if API key is set
    const hasApiKey = !!aiBuilderState.apiKey;

    left.innerHTML = `
      <h2>ðŸ”® ×‘× ×” ×‘×•×©× ×œ×¤×™ ×”×©×¨××”</h2>
      <p class="small muted" style="margin-bottom:16px">×—×¤×© ×‘×•×©× ×ž×¤×•×¨×¡× ××• ×”×¢×œ×” ×ª×ž×•× ×” ×©×œ ×¤×™×¨×ž×™×“×ª ×ª×•×•×™×</p>

      ${!hasApiKey ? `
        <div class="warn-box" style="margin-bottom:16px">
          <strong>âš ï¸ × ×“×¨×© ×ž×¤×ª×— Claude API</strong>
          <div class="field" style="margin-top:12px">
            <label>×”×–×Ÿ ×ž×¤×ª×— API</label>
            <input type="password" id="aiApiKeyInput" placeholder="sk-ant-..." style="width:100%">
          </div>
          <button class="btn primary" id="btnSaveAiApiKey" style="margin-top:8px">ðŸ’¾ ×©×ž×•×¨ ×ž×¤×ª×—</button>
        </div>
      ` : `
        <div class="success-box" style="margin-bottom:16px;padding:8px 12px;background:rgba(34,197,94,0.1);border:1px solid var(--success);border-radius:8px">
          âœ… ×ž×¤×ª×— API ×ž×•×’×“×¨
          <button class="btn" id="btnChangeApiKey" style="margin-right:12px;padding:4px 8px;font-size:0.85rem">×©× ×”</button>
        </div>
      `}

      <div class="hr"></div>

      <h3 style="margin:16px 0 12px">×‘×—×¨ ×©×™×˜×”</h3>
      <div style="display:flex;gap:8px;margin-bottom:16px">
        <button class="btn ${aiBuilderState.method === 'search' ? 'primary' : ''}" id="btnMethodSearch" style="flex:1">ðŸ” ×—×™×¤×•×© ×©×</button>
        <button class="btn ${aiBuilderState.method === 'image' ? 'primary' : ''}" id="btnMethodImage" style="flex:1">ðŸ“· ×ª×ž×•× ×”</button>
      </div>

      ${aiBuilderState.method === 'search' ? `
        <div class="field">
          <label>×©× ×”×‘×•×©× ×œ×—×™×¤×•×©</label>
          <input type="text" id="aiPerfumeName" placeholder="×œ×“×•×’×ž×”: Oud Satin Mood" style="width:100%">
        </div>
        <button class="btn primary" id="btnAiSearch" style="width:100%" ${!hasApiKey ? 'disabled' : ''}>ðŸ” ×—×¤×© ×ª×•×•×™× ×‘××™× ×˜×¨× ×˜</button>
      ` : `
        <div id="aiDropZone" style="border:2px dashed var(--line);border-radius:12px;padding:30px;text-align:center;cursor:pointer;background:var(--panel)">
          <div style="font-size:2rem;margin-bottom:8px">ðŸ“</div>
          <p>×’×¨×•×¨ ×ª×ž×•× ×” ×œ×›××Ÿ ××• ×œ×—×¥ ×œ×‘×—×™×¨×”</p>
          <input type="file" id="aiImageInput" accept="image/*" style="display:none">
          ${aiBuilderState.uploadedImage ? `<img src="${aiBuilderState.uploadedImage}" style="max-width:100%;max-height:200px;margin-top:12px;border-radius:8px">` : ''}
        </div>
        <button class="btn primary" id="btnAiAnalyze" style="width:100%;margin-top:12px" ${!hasApiKey || !aiBuilderState.uploadedImage ? 'disabled' : ''}>ðŸ”¬ × ×ª×— ×ª×ž×•× ×”</button>
      `}

      <div id="aiLoading" style="display:none;text-align:center;padding:30px">
        <div class="spinner" style="width:40px;height:40px;border:3px solid var(--line);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto"></div>
        <p id="aiLoadingText" style="margin-top:12px;color:var(--muted)">×ž×—×¤×©...</p>
      </div>
    `;

    right.innerHTML = `
      <h2>ðŸ“Š ×ª×•×¦××•×ª × ×™×ª×•×—</h2>
      <div id="aiResults">
        <p class="muted" style="text-align:center;padding:40px">×‘×—×¨ ×©×™×˜×” ×•×—×¤×© ×‘×•×©× ×œ×”×ª×—×œ×”</p>
      </div>
    `;

    // Wire up event handlers
    wireAIBuilderEvents(hasApiKey);
  };

  const wireAIBuilderEvents = (hasApiKey) => {
    // API key save
    const saveApiKeyBtn = $("btnSaveAiApiKey");
    if (saveApiKeyBtn) {
      saveApiKeyBtn.onclick = () => {
        const key = $("aiApiKeyInput").value.trim();
        if (key) {
          aiBuilderState.apiKey = key;
          localStorage.setItem('claudeApiKey', key);
          renderAIBuilder();
        }
      };
    }

    const changeApiKeyBtn = $("btnChangeApiKey");
    if (changeApiKeyBtn) {
      changeApiKeyBtn.onclick = () => {
        aiBuilderState.apiKey = '';
        localStorage.removeItem('claudeApiKey');
        renderAIBuilder();
      };
    }

    // Method selection
    const methodSearchBtn = $("btnMethodSearch");
    const methodImageBtn = $("btnMethodImage");
    if (methodSearchBtn) methodSearchBtn.onclick = () => { aiBuilderState.method = 'search'; renderAIBuilder(); };
    if (methodImageBtn) methodImageBtn.onclick = () => { aiBuilderState.method = 'image'; renderAIBuilder(); };

    // Search
    const searchBtn = $("btnAiSearch");
    const searchInput = $("aiPerfumeName");
    if (searchBtn && hasApiKey) {
      searchBtn.onclick = () => aiSearchPerfume();
    }
    if (searchInput) {
      searchInput.onkeydown = (e) => { if (e.key === 'Enter' && hasApiKey) aiSearchPerfume(); };
    }

    // Image upload
    const dropZone = $("aiDropZone");
    const imageInput = $("aiImageInput");
    if (dropZone && imageInput) {
      dropZone.onclick = () => imageInput.click();
      dropZone.ondragover = (e) => { e.preventDefault(); dropZone.style.borderColor = 'var(--accent)'; };
      dropZone.ondragleave = () => { dropZone.style.borderColor = 'var(--line)'; };
      dropZone.ondrop = (e) => {
        e.preventDefault();
        dropZone.style.borderColor = 'var(--line)';
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) handleAIImageFile(file);
      };
      imageInput.onchange = (e) => {
        const file = e.target.files[0];
        if (file) handleAIImageFile(file);
      };
    }

    // Analyze image
    const analyzeBtn = $("btnAiAnalyze");
    if (analyzeBtn && hasApiKey) {
      analyzeBtn.onclick = () => aiAnalyzeImage();
    }
  };

  const handleAIImageFile = (file) => {
    const reader = new FileReader();
    reader.onload = (e) => {
      aiBuilderState.uploadedImage = e.target.result;
      renderAIBuilder();
    };
    reader.readAsDataURL(file);
  };

  const showAILoading = (text) => {
    const loading = $("aiLoading");
    const loadingText = $("aiLoadingText");
    if (loading) loading.style.display = 'block';
    if (loadingText) loadingText.textContent = text;
  };

  const hideAILoading = () => {
    const loading = $("aiLoading");
    if (loading) loading.style.display = 'none';
  };

  const callClaudeAPI = async (messages, useWebSearch = false) => {
    if (!aiBuilderState.apiKey) throw new Error('× ×“×¨×© ×ž×¤×ª×— API');

    const body = {
      model: "claude-sonnet-4-20250514",
      max_tokens: 4000,
      messages: messages
    };

    if (useWebSearch) {
      body.tools = [{ type: "web_search_20250305", name: "web_search" }];
    }

    const response = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-api-key": aiBuilderState.apiKey,
        "anthropic-version": "2023-06-01",
        "anthropic-dangerous-direct-browser-access": "true"
      },
      body: JSON.stringify(body)
    });

    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.error?.message || '×©×’×™××ª API');
    }

    return await response.json();
  };

  const extractJsonFromAIResponse = (data) => {
    for (const block of data.content) {
      if (block.type === 'text') {
        const jsonMatch = block.text.match(/\{[\s\S]*\}/);
        if (jsonMatch) {
          try { return JSON.parse(jsonMatch[0]); } catch (e) { console.error('JSON parse error:', e); }
        }
      }
    }
    return null;
  };

  const aiSearchPerfume = async () => {
    const name = $("aiPerfumeName")?.value.trim();
    if (!name) { alert('× × ×œ×”×–×™×Ÿ ×©× ×‘×•×©×'); return; }

    showAILoading('×ž×—×¤×© ×ª×•×•×™ ×‘×•×©× ×‘××™× ×˜×¨× ×˜...');

    try {
      const response = await callClaudeAPI([{
        role: "user",
        content: `Search for the fragrance notes pyramid of "${name}" perfume.

Return ONLY a JSON object in this exact format:
{
  "perfumeName": "full official name",
  "brand": "brand name",
  "topNotes": ["note1", "note2"],
  "heartNotes": ["note1", "note2"],
  "baseNotes": ["note1", "note2"],
  "family": "olfactive family"
}

Return ONLY the JSON, no other text.`
      }], true);

      const perfumeData = extractJsonFromAIResponse(response);
      if (perfumeData) {
        aiBuilderState.currentPerfume = perfumeData;
        displayAIResults(perfumeData);
      } else {
        throw new Error('×œ× ×”×¦×œ×—×ª×™ ×œ× ×ª×— ××ª ×”×ª×•×¦××•×ª');
      }
    } catch (error) {
      hideAILoading();
      alert('×©×’×™××”: ' + error.message);
    }
  };

  const aiAnalyzeImage = async () => {
    if (!aiBuilderState.uploadedImage) { alert('× × ×œ×”×¢×œ×•×ª ×ª×ž×•× ×”'); return; }

    showAILoading('×ž× ×ª×— ×ª×ž×•× ×ª ×¤×™×¨×ž×™×“×”...');

    try {
      const base64Data = aiBuilderState.uploadedImage.split(',')[1];
      const mediaType = aiBuilderState.uploadedImage.match(/data:([^;]+)/)[1];

      const response = await callClaudeAPI([{
        role: "user",
        content: [
          { type: "image", source: { type: "base64", media_type: mediaType, data: base64Data } },
          { type: "text", text: `Analyze this perfume notes pyramid image.

Extract all visible fragrance notes and categorize them.

Return ONLY a JSON object:
{
  "perfumeName": "name if visible, or 'Unknown'",
  "topNotes": ["note1", "note2"],
  "heartNotes": ["note1", "note2"],
  "baseNotes": ["note1", "note2"]
}

Return ONLY the JSON.` }
        ]
      }]);

      const perfumeData = extractJsonFromAIResponse(response);
      if (perfumeData) {
        aiBuilderState.currentPerfume = perfumeData;
        displayAIResults(perfumeData);
      } else {
        throw new Error('×œ× ×”×¦×œ×—×ª×™ ×œ× ×ª×— ××ª ×”×ª×ž×•× ×”');
      }
    } catch (error) {
      hideAILoading();
      alert('×©×’×™××”: ' + error.message);
    }
  };

  const displayAIResults = (perfumeData) => {
    hideAILoading();

    // Find matches from our inventory
    const allNotes = [
      ...(perfumeData.topNotes || []).map(n => ({ note: n, level: 'top' })),
      ...(perfumeData.heartNotes || []).map(n => ({ note: n, level: 'heart' })),
      ...(perfumeData.baseNotes || []).map(n => ({ note: n, level: 'base' }))
    ];

    aiBuilderState.currentMatches = findAIMatches(allNotes);

    // Render results
    let html = `
      <div style="background:linear-gradient(135deg,rgba(212,168,83,0.15),rgba(184,134,11,0.1));padding:16px;border-radius:12px;margin-bottom:16px">
        <h3 style="color:var(--accent);margin-bottom:8px">ðŸŽ¯ ${escapeHtml(perfumeData.perfumeName || 'Unknown')}</h3>
        ${perfumeData.brand ? `<p><strong>×ž×•×ª×’:</strong> ${escapeHtml(perfumeData.brand)}</p>` : ''}
        ${perfumeData.family ? `<p><strong>×ž×©×¤×—×”:</strong> ${escapeHtml(perfumeData.family)}</p>` : ''}
      </div>

      <h3 style="margin:16px 0 12px">ðŸ”º ×¤×™×¨×ž×™×“×ª ×ª×•×•×™×</h3>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px">
        <div style="background:var(--panel);padding:12px;border-radius:8px;text-align:center">
          <h4 style="color:#f59e0b;margin-bottom:8px">TOP</h4>
          <div style="display:flex;flex-wrap:wrap;gap:4px;justify-content:center">
            ${(perfumeData.topNotes || []).map(n => `<span style="background:rgba(245,158,11,0.2);padding:2px 8px;border-radius:12px;font-size:0.8rem">${escapeHtml(n)}</span>`).join('')}
          </div>
        </div>
        <div style="background:var(--panel);padding:12px;border-radius:8px;text-align:center">
          <h4 style="color:#ec4899;margin-bottom:8px">HEART</h4>
          <div style="display:flex;flex-wrap:wrap;gap:4px;justify-content:center">
            ${(perfumeData.heartNotes || []).map(n => `<span style="background:rgba(236,72,153,0.2);padding:2px 8px;border-radius:12px;font-size:0.8rem">${escapeHtml(n)}</span>`).join('')}
          </div>
        </div>
        <div style="background:var(--panel);padding:12px;border-radius:8px;text-align:center">
          <h4 style="color:#8b5cf6;margin-bottom:8px">BASE</h4>
          <div style="display:flex;flex-wrap:wrap;gap:4px;justify-content:center">
            ${(perfumeData.baseNotes || []).map(n => `<span style="background:rgba(139,92,246,0.2);padding:2px 8px;border-radius:12px;font-size:0.8rem">${escapeHtml(n)}</span>`).join('')}
          </div>
        </div>
      </div>

      <h3 style="margin:16px 0 12px">âœ… ×”×ª××ž×•×ª ×ž×”×ž×œ××™ ×©×œ×š</h3>
      ${renderAIMatchesTable(aiBuilderState.currentMatches)}

      <div class="hr" style="margin:20px 0"></div>

      <div style="display:flex;gap:12px;align-items:center;margin-bottom:16px">
        <div class="field" style="margin:0;flex:1">
          <label>×’×•×“×œ (ml)</label>
          <input type="number" id="aiBottleSize" value="50" min="10" max="500" style="width:100%">
        </div>
        <div class="field" style="margin:0;flex:1">
          <label>×¨×™×›×•×– (%)</label>
          <input type="number" id="aiConcentration" value="40" min="10" max="50" style="width:100%">
        </div>
      </div>

      <button class="btn primary" id="btnAiGenerateFormula" style="width:100%;padding:14px;font-size:1.1rem">ðŸ§ª ×¦×•×¨ ×¤×•×¨×ž×•×œ×” ×ž×•×¦×¢×ª</button>

      <div id="aiFormulaResult"></div>
    `;

    $("aiResults").innerHTML = html;

    // Wire generate button
    $("btnAiGenerateFormula").onclick = () => aiGenerateFormula();
  };

  const findAIMatches = (notes) => {
    const matches = [];
    const missingNotes = [];

    for (const { note, level } of notes) {
      const normalizedNote = note.toLowerCase().trim();
      const noteMatches = [];

      // Check translations
      for (const [key, materials] of Object.entries(noteTranslationsAI)) {
        if (normalizedNote.includes(key) || key.includes(normalizedNote)) {
          for (const matName of materials) {
            // Find in our actual inventory
            const mat = state.materials.find(m => m.name === matName || m.name.includes(matName));
            if (mat && !noteMatches.find(m => m.id === mat.id)) {
              noteMatches.push({
                id: mat.id,
                name: mat.name,
                category: mat.category,
                score: normalizedNote === key ? 95 : 75,
                isFixative: FIXATIVES.some(f => mat.name.includes(f))
              });
            }
          }
        }
      }

      // Also search in material notes/descriptions
      if (noteMatches.length === 0) {
        for (const mat of state.materials) {
          const matDesc = (mat.desc || '').toLowerCase();
          const matName = mat.name.toLowerCase();
          if (matDesc.includes(normalizedNote) || matName.includes(normalizedNote)) {
            noteMatches.push({
              id: mat.id,
              name: mat.name,
              category: mat.category,
              score: 60,
              isFixative: FIXATIVES.some(f => mat.name.includes(f))
            });
          }
        }
      }

      if (noteMatches.length > 0) {
        matches.push({
          note: note,
          level: level,
          matches: noteMatches.sort((a, b) => b.score - a.score).slice(0, 3)
        });
      } else {
        missingNotes.push(note);
      }
    }

    return { matches, missingNotes };
  };

  const renderAIMatchesTable = (matchData) => {
    const { matches, missingNotes } = matchData;

    let html = '<table style="width:100%;border-collapse:collapse;font-size:0.9rem">';
    html += '<thead><tr style="background:var(--panel)"><th style="padding:8px;text-align:right">×ª×•</th><th style="padding:8px;text-align:right">×©×›×‘×”</th><th style="padding:8px;text-align:right">×—×•×ž×¨ ×ž×•×ž×œ×¥</th><th style="padding:8px;text-align:right">×”×ª××ž×”</th></tr></thead><tbody>';

    for (const match of matches) {
      const levelColor = { top: '#f59e0b', heart: '#ec4899', base: '#8b5cf6' }[match.level];
      const levelName = { top: 'TOP', heart: 'HEART', base: 'BASE' }[match.level];

      for (let i = 0; i < match.matches.length; i++) {
        const m = match.matches[i];
        const scoreColor = m.score >= 80 ? 'var(--success)' : m.score >= 60 ? 'var(--warn)' : 'var(--error)';
        const fixativeIcon = m.isFixative ? ' ðŸ”¥' : '';

        html += '<tr style="border-bottom:1px solid var(--line)">';
        if (i === 0) {
          html += `<td rowspan="${match.matches.length}" style="padding:8px;font-weight:600">${escapeHtml(match.note)}</td>`;
          html += `<td rowspan="${match.matches.length}" style="padding:8px;color:${levelColor}">${levelName}</td>`;
        }
        html += `<td style="padding:8px">${escapeHtml(m.name)}${fixativeIcon}</td>`;
        html += `<td style="padding:8px"><span style="background:${scoreColor}22;color:${scoreColor};padding:2px 8px;border-radius:12px;font-size:0.8rem">${m.score}%</span></td>`;
        html += '</tr>';
      }
    }

    html += '</tbody></table>';

    if (missingNotes.length > 0) {
      html += `<div class="warn-box" style="margin-top:12px"><strong>âš ï¸ ×ª×•×•×™× ×œ×œ× ×”×ª××ž×”:</strong> ${missingNotes.join(', ')}</div>`;
    }

    return html;
  };

  const aiGenerateFormula = async () => {
    if (!aiBuilderState.currentMatches) return;

    const bottleSize = parseInt($("aiBottleSize")?.value) || 50;
    const concentration = parseInt($("aiConcentration")?.value) || 40;
    const totalFragrance = bottleSize * concentration / 100;
    const dpg = totalFragrance * 0.1;
    const alcohol = bottleSize - totalFragrance - dpg;

    showAILoading('×™×•×¦×¨ ×¤×•×¨×ž×•×œ×” ×ž×•×ª××ž×ª...');

    try {
      // Detect perfume type
      const perfumeName = (aiBuilderState.currentPerfume.perfumeName || '').toLowerCase();
      let perfumeType = 'oriental';
      if (perfumeName.includes('oud') || perfumeName.includes('wood')) perfumeType = 'oud';
      else if (perfumeName.includes('citrus') || perfumeName.includes('fresh')) perfumeType = 'citrus';
      else if (perfumeName.includes('floral') || perfumeName.includes('rose')) perfumeType = 'floral';

      const response = await callClaudeAPI([{
        role: "user",
        content: `You are ENIGMA Parfume's expert AI formulator (V3.4). Create a formula for "${aiBuilderState.currentPerfume.perfumeName || 'Unknown'}".

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
IRON RULES - MUST FOLLOW FOR EVERY FORMULA:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
1. Alcohol minimum: 27.5ml (55%+) for 50ml bottle - ALWAYS!
2. Include 3-4 FIXATIVES ðŸ”¥ from this list:
   - Iso E Super ðŸ”¥, Another 13 23 ðŸ”¥, Benzoin 50% ðŸ”¥
   - Sandalwood 50% ðŸ”¥, Patchouli 50% ðŸ”¥, Cedarwood 50% ðŸ”¥
   - Vetiver Java 50% ðŸ”¥, Frankincense 50% ðŸ”¥, Myrrh 50% ðŸ”¥
   - Labdanum 50% ðŸ”¥, Cashmeran ðŸ”¥, Galaxolide 50% ðŸ”¥
   - Vanillin Signature ðŸ”¥, White Musk ðŸ”¥
3. Pyramid Architecture:
   - TOP: 15-20% (15-120 min)
   - HEART: 30-40% (2-4 hours)
   - BASE: 40-55% (4+ hours) - MOST IMPORTANT!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CRITICAL USAGE LIMITS (per 50ml) - NEVER EXCEED!!!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ALDEHYDES:
- Aldehyde C-7 10%: MAX 0.03ml
- Aldehyde C-11: MAX 0.04ml
- Aldehyde C-12 Lauric 10%: MAX 0.05ml
- Mandarin Aldehyde: MAX 0.01ml
- Cyclamen Aldehyde: MAX 0.15ml
- Anisic Aldehyde: MAX 0.22ml
- Hydratropic Aldehyde: MAX 0.08ml
- Para Tolyl Aldehyde: MAX 0.2ml
- Maltol Isobutyrate: MAX 0.13ml
- Heliotropin 20% DPG: MAX 0.5ml
- Hexyl Cinnamic Aldehyde: MAX 1.0ml

MODULATORS:
- Hedione: MAX 7.5ml
- Cashmeran: MAX 2.0ml
- Galaxolide 50%: MAX 5.0ml
- Coumarin: MAX 0.75ml
- Ethyl Maltol: MAX 0.5ml
- Ethyl Vanillin: MAX 0.5ml
- Vanillin Signature: MAX 0.5ml

DANGEROUS OILS (10% dilution):
- Cinnamon 10%: MAX 0.3ml âš ï¸
- Clove 10%: MAX 0.3ml âš ï¸
- Thyme 10%: MAX 0.3ml âš ï¸

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PERFUME TYPE CONCENTRATION GUIDE:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- Citrus/Fresh: 18-22% fragrance, 60-65% alcohol
- Floral/Light: 22-26% fragrance, 58-62% alcohol
- Oriental/Amber: 26-30% fragrance, 54-58% alcohol
- Woody/Oud: 28-32% fragrance, 52-56% alcohol
- Gourmand: 24-28% fragrance, 56-60% alcohol

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
MATCHED MATERIALS FROM ENIGMA INVENTORY:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
${JSON.stringify(aiBuilderState.currentMatches.matches.map(m => ({
  note: m.note, level: m.level, materials: m.matches.slice(0, 2).map(x => x.name)
})), null, 2)}

PERFUME TYPE: ${perfumeType.toUpperCase()}
${perfumeType === 'oud' ? `
OUD PERFUME REQUIREMENTS:
- MUST include OUD materials (Ombre Nomade 24, Oudhbois, Pretty Oud)
- MUST include ROSE (Montale Roses Musk, Rose Orientale, LIAV)
- BASE must be 50%+ with benzoin, sandalwood, frankincense
- Add Safranal for saffron note if present` : ''}
${perfumeType === 'citrus' ? `
CITRUS PERFUME REQUIREMENTS:
- TOP should be 20% with citrus oils (Bergamot FCF 50%, Lemon 50%, etc.)
- Use Hedione as bridge material
- Light BASE with vetiver, musk` : ''}
${perfumeType === 'floral' ? `
FLORAL PERFUME REQUIREMENTS:
- HEART dominant with rose, jasmine notes
- Use Hedione to boost florals
- Light woody BASE` : ''}

Formula specs: ${bottleSize}ml, ${concentration}% concentration
Fragrance total: ${totalFragrance}ml | DPG: ${dpg.toFixed(1)}ml | Alcohol: ${alcohol.toFixed(1)}ml

Return ONLY valid JSON:
{
  "name": "Perfume Name Inspired",
  "topNotes": [{"material": "exact name from inventory", "percentage": 18}],
  "heartNotes": [{"material": "exact name", "percentage": 32}],
  "baseNotes": [{"material": "exact name", "percentage": 50}]
}

REMEMBER: Percentages must total 100%. BASE must be 40-55%!
Use ONLY materials that exist in ENIGMA inventory.
NEVER exceed usage limits - this will cause formula to be BLOCKED!`
      }]);

      const formulaData = extractJsonFromAIResponse(response);
      if (formulaData) {
        // Normalize percentages
        const allIngs = [...(formulaData.topNotes || []), ...(formulaData.heartNotes || []), ...(formulaData.baseNotes || [])];
        const total = allIngs.reduce((sum, i) => sum + (i.percentage || 0), 0);
        if (total > 0 && Math.abs(total - 100) > 1) {
          const factor = 100 / total;
          allIngs.forEach(i => i.percentage = Math.round(i.percentage * factor * 10) / 10);
        }

        aiBuilderState.currentFormula = formulaData;
        displayAIFormula(formulaData, bottleSize, concentration);
      } else {
        throw new Error('×œ× ×”×¦×œ×—×ª×™ ×œ×™×¦×•×¨ ×¤×•×¨×ž×•×œ×”');
      }
    } catch (error) {
      hideAILoading();
      alert('×©×’×™××”: ' + error.message);
    }
  };

  const displayAIFormula = (formulaData, bottleSize, concentration) => {
    hideAILoading();

    const totalFragrance = bottleSize * concentration / 100;
    const dpg = totalFragrance * 0.1;
    const alcohol = bottleSize - totalFragrance - dpg;

    // Validate formula
    const validation = validateAIFormula(formulaData, bottleSize, concentration);

    // Calculate totals
    const topTotal = (formulaData.topNotes || []).reduce((s, i) => s + (i.percentage || 0), 0);
    const heartTotal = (formulaData.heartNotes || []).reduce((s, i) => s + (i.percentage || 0), 0);
    const baseTotal = (formulaData.baseNotes || []).reduce((s, i) => s + (i.percentage || 0), 0);

    let html = `
      <div class="hr" style="margin:20px 0"></div>
      <h3 style="margin-bottom:16px">ðŸ“ ×¤×•×¨×ž×•×œ×”: ${escapeHtml(formulaData.name || aiBuilderState.currentPerfume?.perfumeName + ' Inspired')}</h3>
    `;

    // Validation errors/warnings
    if (validation.errors.length > 0) {
      html += `<div class="error-box" style="margin-bottom:16px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <strong>âŒ ×©×’×™××•×ª ×ž×’×‘×œ×•×ª (${validation.errors.length}):</strong>
          <button class="btn" id="btnAutoFixLimits" style="padding:6px 12px;font-size:0.85rem;background:var(--error)">ðŸ”§ ×ª×§×Ÿ ××•×˜×•×ž×˜×™×ª</button>
        </div>
        <ul style="margin:0;padding-right:20px">
          ${validation.errors.map(e => `<li>${e.material}: <strong style="color:var(--error)">${e.ml}ml</strong> â†’ ×ž×§×¡×™×ž×•×: <strong style="color:var(--success)">${e.limit}ml</strong></li>`).join('')}
        </ul>
      </div>`;
    }

    if (validation.warnings.length > 0) {
      html += '<div class="warn-box" style="margin-bottom:16px"><strong>××–×”×¨×•×ª:</strong><ul style="margin:8px 0 0 0;padding-right:20px">';
      validation.warnings.forEach(w => html += `<li>${w}</li>`);
      html += '</ul></div>';
    }

    // Fixatives count
    const fixColor = validation.fixativesCount >= 3 ? 'var(--success)' : 'var(--warn)';
    html += `<div style="padding:10px;background:var(--panel);border-radius:8px;border:1px solid ${fixColor};margin-bottom:16px">
      <strong style="color:${fixColor}">ðŸ”¥ Fixatives: ${validation.fixativesCount}</strong>${validation.fixativesCount >= 3 ? ' âœ…' : ' - ×ž×•×ž×œ×¥ ×ž×™× ×™×ž×•× 3'}
    </div>`;

    // Formula groups (with group keys for editing)
    html += renderAIFormulaGroup('ðŸ” TOP NOTES', formulaData.topNotes || [], totalFragrance, topTotal, '#f59e0b', 'topNotes');
    html += renderAIFormulaGroup('ðŸ’• HEART NOTES', formulaData.heartNotes || [], totalFragrance, heartTotal, '#ec4899', 'heartNotes');
    html += renderAIFormulaGroup('ðŸŒ³ BASE NOTES', formulaData.baseNotes || [], totalFragrance, baseTotal, '#8b5cf6', 'baseNotes');

    // Summary
    html += `
      <div style="background:linear-gradient(135deg,rgba(212,168,83,0.1),rgba(184,134,11,0.05));border:1px solid var(--accent);border-radius:12px;padding:16px;margin-top:16px">
        <h4 style="margin-bottom:12px">ðŸ“Š ×¡×™×›×•×</h4>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:0.9rem">
          <div>TOP (${topTotal}%): <strong style="color:#f59e0b">${(totalFragrance * topTotal / 100).toFixed(1)} ml</strong></div>
          <div>HEART (${heartTotal}%): <strong style="color:#ec4899">${(totalFragrance * heartTotal / 100).toFixed(1)} ml</strong></div>
          <div>BASE (${baseTotal}%): <strong style="color:#8b5cf6">${(totalFragrance * baseTotal / 100).toFixed(1)} ml</strong></div>
          <div>×ª×ž×¦×™×ª (${concentration}%): <strong>${totalFragrance.toFixed(1)} ml</strong></div>
          <div>DPG: <strong>${dpg.toFixed(1)} ml</strong></div>
          <div>××œ×›×•×”×•×œ (${((alcohol/bottleSize)*100).toFixed(0)}%): <strong>${alcohol.toFixed(1)} ml</strong></div>
        </div>
        <div style="margin-top:12px;padding-top:12px;border-top:2px solid var(--accent);font-size:1.1rem">
          <strong>×¡×”"×›: ${bottleSize} ml</strong>
        </div>
      </div>

      <div style="display:flex;gap:12px;margin-top:16px;flex-wrap:wrap">
        ${validation.errors.length > 0 ? `
          <button class="btn" id="btnSaveAiFormula" style="flex:1;min-width:150px;opacity:0.5;cursor:not-allowed;background:#444" disabled>ðŸš« ×œ× × ×™×ª×Ÿ ×œ×©×ž×•×¨ - ×ª×§×Ÿ ×©×’×™××•×ª</button>
        ` : `
          <button class="btn success" id="btnSaveAiFormula" style="flex:1;min-width:150px">ðŸ’¾ ×©×ž×•×¨ ×œ×¤×•×¨×ž×•×œ×•×ª</button>
        `}
        <button class="btn" id="btnCopyAiFormula">ðŸ“‹ ×”×¢×ª×§</button>
      </div>
      ${validation.errors.length > 0 ? `
        <div class="error-box" style="margin-top:12px;font-size:0.85rem">
          <strong>âš ï¸ ×©×ž×™×¨×” ×—×¡×•×ž×”:</strong> ×™×© ×—×•×ž×¨×™× ×©×¢×•×‘×¨×™× ××ª ×”×ž×’×‘×œ×•×ª ×”×ž×•×ª×¨×•×ª. ×¦×•×¨ ×¤×•×¨×ž×•×œ×” ×—×“×©×” ××• ×¢×¨×•×š ×™×“× ×™×ª.
        </div>
      ` : ''}
    `;

    $("aiFormulaResult").innerHTML = html;

    // Wire auto-fix button
    const autoFixBtn = $("btnAutoFixLimits");
    if (autoFixBtn) {
      autoFixBtn.onclick = () => autoFixAIFormula(formulaData, bottleSize, concentration);
    }

    // Wire ingredient inputs for manual editing
    document.querySelectorAll('.ai-ing-input').forEach(input => {
      input.onchange = (e) => {
        const group = e.target.dataset.group;
        const index = parseInt(e.target.dataset.index);
        const newValue = parseFloat(e.target.value) || 0;
        updateAIIngredient(formulaData, group, index, newValue, bottleSize, concentration);
      };
    });

    // Wire save button only if no errors
    if (validation.errors.length === 0) {
      $("btnSaveAiFormula").onclick = () => saveAIFormula(formulaData, bottleSize, concentration);
    }
    $("btnCopyAiFormula").onclick = () => copyAIFormula(formulaData, bottleSize, concentration);
  };

  // Auto-fix formula - reduce all exceeded materials to their max limit
  const autoFixAIFormula = (formulaData, bottleSize, concentration) => {
    const totalFragrance = bottleSize * concentration / 100;

    const fixGroup = (notes) => {
      if (!notes) return;
      for (const ing of notes) {
        const limit = maxUsageLimits[ing.material];
        if (limit) {
          const ml = totalFragrance * (ing.percentage || 0) / 100;
          if (ml > limit) {
            // Calculate the new percentage that gives exactly the limit
            const newPercentage = (limit / totalFragrance) * 100;
            ing.percentage = Math.round(newPercentage * 10) / 10;
          }
        }
      }
    };

    fixGroup(formulaData.topNotes);
    fixGroup(formulaData.heartNotes);
    fixGroup(formulaData.baseNotes);

    // Update state and re-render
    aiBuilderState.currentFormula = formulaData;
    displayAIFormula(formulaData, bottleSize, concentration);
  };

  // Update a single ingredient and re-render
  const updateAIIngredient = (formulaData, group, index, newPercentage, bottleSize, concentration) => {
    if (formulaData[group] && formulaData[group][index]) {
      formulaData[group][index].percentage = newPercentage;
    }

    // Update state and re-render
    aiBuilderState.currentFormula = formulaData;
    displayAIFormula(formulaData, bottleSize, concentration);
  };

  const renderAIFormulaGroup = (title, ingredients, totalFragrance, groupTotal, color, groupKey) => {
    let html = `<div style="background:var(--panel);border-radius:12px;padding:12px;margin-bottom:12px">
      <h4 style="color:${color};margin-bottom:12px">${title} <span style="font-weight:normal;font-size:0.85rem;opacity:0.7">(${groupTotal}% = ${(totalFragrance * groupTotal / 100).toFixed(1)} ml)</span></h4>`;

    for (let i = 0; i < ingredients.length; i++) {
      const ing = ingredients[i];
      const ml = totalFragrance * (ing.percentage || 0) / 100;
      const limit = maxUsageLimits[ing.material];
      const exceedsLimit = limit && ml > limit;
      const isFixativeMat = FIXATIVES.some(f => ing.material.includes(f));

      const rowStyle = exceedsLimit
        ? 'background:rgba(239,68,68,0.15);border:1px solid var(--error);border-radius:8px;margin:4px 0;padding:8px'
        : 'padding:8px 0;border-bottom:1px solid var(--line)';
      const mlColor = exceedsLimit ? 'color:var(--error)' : 'color:var(--accent)';

      html += `<div style="${rowStyle};display:flex;justify-content:space-between;align-items:center;gap:8px">
        <span style="flex:1">${escapeHtml(ing.material)}${isFixativeMat ? ' ðŸ”¥' : ''}</span>
        <div style="display:flex;align-items:center;gap:8px">
          <input type="number" class="ai-ing-input" data-group="${groupKey}" data-index="${i}"
            value="${ing.percentage}" step="0.5" min="0" max="100"
            style="width:55px;padding:4px 6px;border:1px solid ${exceedsLimit ? 'var(--error)' : 'var(--line)'};border-radius:4px;background:var(--bg);color:var(--text);text-align:center;font-size:0.9rem">
          <span style="color:var(--muted);font-size:0.85rem">%</span>
          <span style="min-width:60px;text-align:left"><strong style="${mlColor}">${ml.toFixed(2)} ml</strong></span>
          ${exceedsLimit ? `<span style="color:var(--error);font-size:0.7rem;white-space:nowrap">(×ž×§×¡ ${limit})</span>` : ''}
        </div>
      </div>`;
    }

    html += '</div>';
    return html;
  };

  const validateAIFormula = (formula, bottleSize, concentration) => {
    const errors = [];
    const warnings = [];
    const totalFragrance = bottleSize * concentration / 100;

    const allIngs = [
      ...(formula.topNotes || []),
      ...(formula.heartNotes || []),
      ...(formula.baseNotes || [])
    ];

    // Check usage limits
    for (const ing of allIngs) {
      const ml = totalFragrance * (ing.percentage || 0) / 100;
      const limit = maxUsageLimits[ing.material];
      if (limit && ml > limit) {
        errors.push({ material: ing.material, ml: ml.toFixed(2), limit, message: `${ing.material}: ${ml.toFixed(2)}ml ×¢×•×‘×¨ ×ž×’×‘×œ×” ×©×œ ${limit}ml!` });
      }
    }

    // Check fixatives
    const fixativesUsed = allIngs.filter(i => FIXATIVES.some(f => i.material.includes(f)));
    if (fixativesUsed.length < 3) {
      warnings.push(`×¨×§ ${fixativesUsed.length} Fixatives - ×ž×•×ž×œ×¥ ×ž×™× ×™×ž×•× 3-4`);
    }

    // Check alcohol
    const dpg = totalFragrance * 0.1;
    const alcohol = bottleSize - totalFragrance - dpg;
    const alcoholPercent = (alcohol / bottleSize) * 100;
    if (alcoholPercent < 55) {
      warnings.push(`××œ×›×•×”×•×œ ${alcoholPercent.toFixed(1)}% - ×¤×—×•×ª ×ž-55% ×ž×™× ×™×ž×•×`);
    }

    // Check BASE
    const baseTotal = (formula.baseNotes || []).reduce((s, i) => s + (i.percentage || 0), 0);
    if (baseTotal < 40) {
      warnings.push(`BASE ×¨×§ ${baseTotal}% - ×ž×•×ž×œ×¥ 40-55% ×œ×¢×ž×™×“×•×ª`);
    }

    return { errors, warnings, fixativesCount: fixativesUsed.length };
  };

  const saveAIFormula = (formulaData, bottleSize, concentration) => {
    // CRITICAL: Validate formula before saving!
    const validation = validateAIFormula(formulaData, bottleSize, concentration);

    // BLOCK saving if there are limit violations
    if (validation.errors.length > 0) {
      let errorMsg = 'âŒ ×œ× × ×™×ª×Ÿ ×œ×©×ž×•×¨ - ×™×© ×—×¨×™×’×•×ª ×ž×ž×’×‘×œ×•×ª!\n\n';
      errorMsg += validation.errors.map(e => `â€¢ ${e.message}`).join('\n');
      errorMsg += '\n\n×ª×§×Ÿ ××ª ×”×¤×•×¨×ž×•×œ×” ×œ×¤× ×™ ×©×ž×™×¨×”.';
      alert(errorMsg);
      return; // BLOCK SAVE
    }

    const totalFragrance = bottleSize * concentration / 100;

    // Build rows for ENIGMA format
    const rows = [];
    const addRows = (notes) => {
      for (const ing of (notes || [])) {
        const mat = state.materials.find(m => m.name === ing.material || m.name.includes(ing.material));
        const ml = totalFragrance * (ing.percentage || 0) / 100;
        rows.push({
          materialId: mat ? mat.id : ing.material,
          ml: parseFloat(ml.toFixed(2))
        });
      }
    };

    addRows(formulaData.topNotes);
    addRows(formulaData.heartNotes);
    addRows(formulaData.baseNotes);

    // Create new formula
    const newFormula = {
      id: uid(),
      name: formulaData.name || (aiBuilderState.currentPerfume?.perfumeName || 'AI') + ' Inspired',
      code: 'AI-' + Math.random().toString(36).substring(2, 6).toUpperCase(),
      rows: rows,
      notes: `×ž×‘×•×¡×¡ ×¢×œ: ${aiBuilderState.currentPerfume?.perfumeName || 'Unknown'}\n× ×•×¦×¨ ×‘-AI Perfume Builder\n${new Date().toLocaleDateString('he-IL')}\n\nFixatives: ${validation.fixativesCount} ðŸ”¥`
    };

    // Add to dev formulas
    state.perfumesDev.push(newFormula);
    saveState();

    alert(`âœ… ×”×¤×•×¨×ž×•×œ×” "${newFormula.name}" × ×©×ž×¨×” ×‘×¤×™×ª×•×—×™×!\n\nðŸ”¥ Fixatives: ${validation.fixativesCount}`);
    state.ui.tab = 'dev';
    render();
  };

  const copyAIFormula = (formulaData, bottleSize, concentration) => {
    const totalFragrance = bottleSize * concentration / 100;
    const dpg = totalFragrance * 0.1;
    const alcohol = bottleSize - totalFragrance - dpg;

    let text = `${formulaData.name || aiBuilderState.currentPerfume?.perfumeName + ' Inspired'}\n`;
    text += `${bottleSize}ml | ${concentration}%\n\n`;

    const addSection = (title, notes) => {
      text += `${title}:\n`;
      for (const ing of (notes || [])) {
        const ml = (totalFragrance * ing.percentage / 100).toFixed(2);
        text += `  ${ing.material}: ${ing.percentage}% (${ml}ml)\n`;
      }
      text += '\n';
    };

    addSection('TOP NOTES', formulaData.topNotes);
    addSection('HEART NOTES', formulaData.heartNotes);
    addSection('BASE NOTES', formulaData.baseNotes);

    text += `DPG: ${dpg.toFixed(1)}ml\n`;
    text += `Alcohol: ${alcohol.toFixed(1)}ml\n`;
    text += `Total: ${bottleSize}ml\n`;

    navigator.clipboard.writeText(text);
    alert('ðŸ“‹ ×”×¤×•×¨×ž×•×œ×” ×”×•×¢×ª×§×”!');
  };

  // ==================== SETTINGS PAGE ====================
  const renderSettings = () => {
    if (!isAdmin()) {
      // Guest cannot see settings
      $("leftPanel").innerHTML = `<h2>âš™ï¸ ×”×’×“×¨×•×ª</h2><p class="muted">××™×Ÿ ×œ×š ×”×¨×©××” ×œ×¦×¤×•×ª ×‘×”×’×“×¨×•×ª</p>`;
      $("rightPanel").innerHTML = "";
      return;
    }

    const left = $("leftPanel");
    const right = $("rightPanel");
    const auth = state.auth || {};
    const gp = auth.guestPermissions || {};

    left.innerHTML = `
      <h2>âš™ï¸ ×”×’×“×¨×•×ª ×ª×¦×•×’×”</h2>
      ${renderToggles()}
      <div class="hr"></div>
      <div class="small">
        <p><strong>×”×¡×‘×¨:</strong></p>
        <ul style="margin:10px 0;padding-right:20px">
          <li>"×§×•×“×™× ×œ×ª×ž×¦×™×•×ª" - ×ž×¦×™×’ ×ž×¡×¤×¨×™× ×‘×ž×§×•× ×©×ž×•×ª</li>
          <li>"×”×¡×ª×¨ ×ª×ž×¦×™×•×ª" - ×ž×¡×ª×™×¨ ×§×˜×’×•×¨×™×” ×‘×ª×¦×•×’×”</li>
          <li>"×ž×¦×‘ ×˜×›× ×™" - ×ž×¦×™×’ ××–×”×¨×•×ª ×•×‘××’×™×</li>
          <li>"×”×©×œ× ×œ-100%" - ×ž×•×¡×™×£ ××œ×›×•×”×•×œ ××•×˜×•×ž×˜×™×ª</li>
        </ul>
      </div>
    `;

    right.innerHTML = `
      <h2>ðŸ” × ×™×”×•×œ ×ž×©×ª×ž×©×™×</h2>
      
      <div class="card" style="background:rgba(212,168,83,0.08);padding:16px;margin-bottom:16px">
        <h3 style="margin-top:0">ðŸ‘‘ Admin</h3>
        <div class="field">
          <label>×¡×™×¡×ž×ª Admin</label>
          <input type="password" id="adminPass" value="${escapeHtml(auth.adminPassword || '')}" placeholder="×¡×™×¡×ž×”">
        </div>
      </div>

      <div class="card" style="background:rgba(100,100,100,0.08);padding:16px;margin-bottom:16px">
        <h3 style="margin-top:0">ðŸ‘¤ ×ž×©×ª×ž×© ××•×¨×— (Guest)</h3>
        <div class="row" style="gap:12px;margin-bottom:12px">
          <div class="field" style="flex:1">
            <label>×©× ×ž×©×ª×ž×©</label>
            <input type="text" id="guestUser" value="${escapeHtml(auth.guestUser || '')}" placeholder="guest">
          </div>
          <div class="field" style="flex:1">
            <label>×¡×™×¡×ž×”</label>
            <input type="password" id="guestPass" value="${escapeHtml(auth.guestPassword || '')}" placeholder="×¡×™×¡×ž×”">
          </div>
        </div>
        
        <div class="hr"></div>
        <h4>ðŸŽ›ï¸ ×”×¨×©××•×ª Guest:</h4>
        
        <div style="display:grid;gap:10px">
          <label style="display:flex;align-items:center;gap:8px">
            <input type="checkbox" id="gpViewDev" ${gp.viewDev !== false ? 'checked' : ''} style="width:20px;height:20px">
            <span>×¦×¤×™×™×” ×‘×¤×™×ª×•×—×™×</span>
          </label>
          <label style="display:flex;align-items:center;gap:8px">
            <input type="checkbox" id="gpViewFinal" ${gp.viewFinal !== false ? 'checked' : ''} style="width:20px;height:20px">
            <span>×¦×¤×™×™×” ×‘×‘×©×ž×™× ×¡×•×¤×™×™×</span>
          </label>
          <label style="display:flex;align-items:center;gap:8px">
            <input type="checkbox" id="gpViewMaterials" ${gp.viewMaterials ? 'checked' : ''} style="width:20px;height:20px">
            <span>×¦×¤×™×™×” ×‘×—×•×ž×¨×™ ×’×œ×</span>
          </label>
          <label style="display:flex;align-items:center;gap:8px">
            <input type="checkbox" id="gpViewPricing" ${gp.viewPricing ? 'checked' : ''} style="width:20px;height:20px">
            <span>×¦×¤×™×™×” ×‘×ª×ž×—×•×¨</span>
          </label>
          <div class="hr"></div>
          <label style="display:flex;align-items:center;gap:8px">
            <input type="checkbox" id="gpCodesOnly" ${gp.showCodesOnly ? 'checked' : ''} style="width:20px;height:20px">
            <span>×ª×ž×¦×™×•×ª ×›×§×•×“×™× ×‘×œ×‘×“ (×ž×¡×ª×™×¨ ×©×ž×•×ª)</span>
          </label>
          <label style="display:flex;align-items:center;gap:8px">
            <input type="checkbox" id="gpCanEdit" ${gp.canEdit ? 'checked' : ''} style="width:20px;height:20px">
            <span>×™×›×•×œ ×œ×¢×¨×•×š (×œ× ×¨×§ ×œ×¦×¤×•×ª)</span>
          </label>
        </div>
      </div>

      <button class="btn primary" id="btnSaveAuth" style="width:100%;padding:12px">ðŸ’¾ ×©×ž×•×¨ ×”×’×“×¨×•×ª ×ž×©×ª×ž×©×™×</button>

      <div class="hr"></div>
      
      <h2>ðŸ”§ ×ª×—×–×•×§×”</h2>
      <div class="row" style="gap:12px;flex-wrap:wrap">
        <button class="btn" id="btnRepair">ðŸ”§ ×ª×™×§×•×Ÿ × ×ª×•× ×™×</button>
        <button class="btn danger" id="btnHardReset">ðŸ’£ ××™×¤×•×¡ ×ž×œ×</button>
      </div>
      <div class="hr"></div>
      <div class="small">
        <p><strong>×¡×˜×˜×™×¡×˜×™×§×•×ª:</strong></p>
        <ul style="margin:10px 0;padding-right:20px">
          <li>×—×•×ž×¨×™ ×’×œ×: ${state.materials.length}</li>
          <li>×¤×™×ª×•×—×™×: ${state.perfumesDev.length}</li>
          <li>×‘×©×ž×™× ×¡×•×¤×™×™×: ${state.perfumesFinal.length}</li>
        </ul>
      </div>
    `;

    wireToggles(left);

    // Save auth settings
    $("btnSaveAuth").onclick = () => {
      const newAdminPass = $("adminPass").value.trim();
      if (!newAdminPass) {
        alert("âŒ ×—×•×‘×” ×¡×™×¡×ž×ª Admin!");
        return;
      }

      state.auth = {
        adminPassword: newAdminPass,
        guestUser: $("guestUser").value.trim() || "guest",
        guestPassword: $("guestPass").value.trim() || "guest123",
        guestPermissions: {
          viewDev: $("gpViewDev").checked,
          viewFinal: $("gpViewFinal").checked,
          viewMaterials: $("gpViewMaterials").checked,
          viewPricing: $("gpViewPricing").checked,
          showCodesOnly: $("gpCodesOnly").checked,
          canEdit: $("gpCanEdit").checked
        }
      };

      saveState();
      alert("âœ… ×”×’×“×¨×•×ª × ×©×ž×¨×•!\n\n××œ ×ª×©×›×— ×œ×¡× ×›×¨×Ÿ ×œ×¢× ×Ÿ â˜ï¸â†‘");
    };

    $("btnRepair").onclick = () => {
      // Ensure DPG exists
      if (!getDPG()) {
        state.materials.unshift({ id: "MAT_DPG", name: "DPG", code: "DPG", category: "×§×‘×•×¢×™×", desc: "Dipropylene Glycol", pricePerKg: null, pricePerMl: null, diluted: false, dilutionPercent: null });
      }
      // Clean invalid material references
      const ids = new Set(state.materials.map(m => m.id));
      const clean = (arr) => arr.map(p => ({ ...p, rows: (p.rows || []).filter(r => ids.has(r.materialId)) }));
      state.perfumesDev = clean(state.perfumesDev);
      state.perfumesFinal = clean(state.perfumesFinal);
      saveState();
      render();
      alert("×ª×™×§×•×Ÿ ×‘×•×¦×¢!");
    };

    $("btnHardReset").onclick = () => {
      if (!confirm("××™×¤×•×¡ ×™×ž×—×§ ××ª ×›×œ ×”× ×ª×•× ×™×. ×‘×˜×•×—?")) return;
      if (!confirm("×‘××ž×ª ×‘×˜×•×—? ×–×” ×‘×œ×ª×™ ×”×¤×™×š!")) return;
      state = defaultState();
      saveState();
      render();
    };
  };

  // ==================== EXPORT/IMPORT ====================
  const exportJSON = () => {
    saveState();
    const out = JSON.parse(JSON.stringify(state));
    // Remove temp keys
    Object.keys(out).filter(k => k.startsWith("_")).forEach(k => delete out[k]);
    const blob = new Blob([JSON.stringify(out, null, 2)], { type: "application/json" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = `enigma-backup-${todayISO()}.json`;
    a.click();
    URL.revokeObjectURL(a.href);
  };

  // Show import menu
  const showImportMenu = () => {
    openModal({
      title: "ðŸ“¥ ×‘×—×¨ ×¡×•×’ ×™×™×‘×•×",
      body: `
        <div style="display:flex;flex-direction:column;gap:12px">
          <button class="btn primary" id="impFormulas" style="padding:16px;font-size:1.1rem">
            ðŸ§ª ×”×•×¡×£ ×¤×•×¨×ž×•×œ×•×ª<br>
            <span class="small muted">×ž×•×¡×™×£ ×¤×•×¨×ž×•×œ×•×ª ×œ×¤×™×ª×•×—×™× (×¢×“ 20)</span>
          </button>
          <button class="btn" id="impMaterials" style="padding:16px;font-size:1.1rem">
            ðŸ“¦ ×™×™×‘×•× ×—×•×ž×¨×™ ×’×œ× (JSON)<br>
            <span class="small muted">×™×™×‘×•× ×§×•×‘×¥ JSON ×©×œ ×—×•×ž×¨×™×</span>
          </button>
          <button class="btn" id="impMaterialsSmart" style="padding:16px;font-size:1.1rem;background:linear-gradient(135deg,#10b981,#059669);border:none">
            ðŸ¤– ×™×™×‘×•× ×—×•×ž×¨×™ ×’×œ× ×—×›×<br>
            <span class="small" style="opacity:0.8">×”×“×‘×§ ×˜×§×¡×˜ ×¤×©×•×˜ - ×”×ž×¢×¨×›×ª ×ª×ž×™×¨ ××•×˜×•×ž×˜×™×ª</span>
          </button>
          <button class="btn" id="impSmart" style="padding:16px;font-size:1.1rem;background:linear-gradient(135deg,#667eea,#764ba2);border:none">
            ðŸ¤– ×™×™×‘×•× ×—×›× (Claude)<br>
            <span class="small" style="opacity:0.8">×”×“×‘×§ ×˜×§×¡×˜ ×¤×©×•×˜ - ×”×ž×¢×¨×›×ª ×ª×ž×™×¨ ××•×˜×•×ž×˜×™×ª</span>
          </button>
          <div class="hr"></div>
          <button class="btn danger" id="impFull" style="padding:16px;font-size:1.1rem">
            ðŸ”„ ×™×™×‘×•× ×ž×œ×<br>
            <span class="small muted">âš ï¸ ×ž×—×œ×™×£ ××ª ×›×œ ×”× ×ª×•× ×™×! ×œ×’×™×‘×•×™/×©×—×–×•×¨ ×‘×œ×‘×“</span>
          </button>
        </div>
      `
    });
    $("impFormulas").onclick = () => { closeModal(); $("importFormulasFile").click(); };
    $("impMaterials").onclick = () => { closeModal(); $("importMaterialsFile").click(); };
    $("impMaterialsSmart").onclick = () => { closeModal(); showSmartMaterialImport(); };
    $("impSmart").onclick = () => { closeModal(); showSmartImport(); };
    $("impFull").onclick = () => { closeModal(); $("importFile").click(); };
  };

  
  // ==================== SMART MATERIAL IMPORT (Claude-friendly) ====================
  const showSmartMaterialImport = () => {
    openFullPage({
      title: "ðŸ¤– ×™×™×‘×•× ×—×•×ž×¨×™ ×’×œ× ×—×›×",
      pill: "Claude",
      body: `
        <div style="max-width:800px;margin:0 auto">
          <div class="card" style="background:linear-gradient(135deg,rgba(16,185,129,0.2),rgba(5,150,105,0.2));margin-bottom:20px;padding:16px">
            <h3 style="color:#34d399;margin-bottom:12px">ðŸ“‹ ×¤×•×¨×ž×˜ ×¤×©×•×˜ ×œ×§×œ××•×“</h3>
            <p style="margin-bottom:12px">×”×¢×ª×§ ××ª ×”×¤×•×¨×ž×˜ ×”×–×” ×œ×§×œ××•×“ ×•×‘×§×© ×ž×ž× ×• ×œ×ž×œ×:</p>
            <pre style="background:rgba(0,0,0,0.3);padding:12px;border-radius:8px;font-size:0.85rem;overflow-x:auto;direction:ltr;text-align:left">
NAME: ×©× ×”×—×•×ž×¨
CODE: ×§×•×“ ×§×¦×¨ (××•×¤×¦×™×•× ×œ×™)
CATEGORY: ×ª×ž×¦×™×•×ª / ×©×ž× ×™× / ××¨×•×ž×›×™×ž×™×§×œ×™× / ×§×‘×•×¢×™×
DESC: ×ª×™××•×¨ ×¨×™×— ×§×¦×¨
PRICE_KG: ×ž×—×™×¨ ×œ×§"×’ (××•×¤×¦×™×•× ×œ×™)
DILUTED: yes / no
DILUTION: ××—×•×– ×“×™×œ×•×œ (×× ×ž×“×•×œ×œ)
---
NAME: ×—×•×ž×¨ × ×•×¡×£
...</pre>
            <p style="margin-top:10px;font-size:0.85rem;color:#9ca3af">ðŸ’¡ × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×ž×¡×¤×¨ ×—×•×ž×¨×™× - ×”×¤×¨×“ ×‘×™× ×™×”× ×¢× ---</p>
          </div>

          <div class="field" style="margin-bottom:16px">
            <label style="font-size:1.1rem;margin-bottom:8px;display:block">ðŸ“ ×”×“×‘×§ ×›××Ÿ ××ª ×”×˜×§×¡×˜ ×ž×§×œ××•×“:</label>
            <textarea id="smartMatInput" style="width:100%;height:250px;font-family:monospace;font-size:0.9rem;direction:ltr;text-align:left" placeholder="NAME: Hedione
CODE: HED
CATEGORY: ××¨×•×ž×›×™×ž×™×§×œ×™×
DESC: ×¤×¨×—×•× ×™, ×’'×¡×ž×™×Ÿ, ×¨×¢× ×Ÿ
PRICE_KG: 500
DILUTED: no
---
NAME: Sandalwood Oil
CODE: SAND
CATEGORY: ×©×ž× ×™×
DESC: ×¢×¦×™, ×§×¨×ž×™, ×—×
PRICE_KG: 3500
DILUTED: yes
DILUTION: 50"></textarea>
          </div>

          <div class="row" style="gap:12px">
            <button class="btn primary" id="smartMatParse" style="flex:1;padding:14px;font-size:1.1rem;background:linear-gradient(135deg,#10b981,#059669)">ðŸ” ×”×ž×¨ ×•×‘×“×•×§</button>
            <button class="btn" id="smartMatCancel" style="padding:14px">×‘×™×˜×•×œ</button>
          </div>

          <div id="smartMatPreview" style="margin-top:20px"></div>
        </div>
      `
    });

    $("smartMatCancel").onclick = closeFullPage;
    $("smartMatParse").onclick = () => parseSmartMaterialImport($("smartMatInput").value);
  };

  const parseSmartMaterialImport = (text) => {
    const preview = $("smartMatPreview");
    if (!text.trim()) {
      preview.innerHTML = '<div class="card" style="background:rgba(216,67,21,0.2);padding:16px">âŒ ×”×˜×§×¡×˜ ×¨×™×§</div>';
      return;
    }

    try {
      // Split by --- to get multiple materials
      const materialBlocks = text.split(/---+/).filter(b => b.trim());
      const parsedMaterials = [];
      const errors = [];

      materialBlocks.forEach((block, idx) => {
        const lines = block.split("\n").map(l => l.trim()).filter(l => l);
        const mat = {
          id: uid(),
          name: "",
          code: "",
          category: "",
          desc: "",
          pricePerKg: null,
          pricePerMl: null,
          diluted: false,
          dilutionPercent: null
        };

        for (const line of lines) {
          const match = line.match(/^(NAME|CODE|CATEGORY|DESC|PRICE_KG|PRICE_ML|DILUTED|DILUTION|×©×|×§×•×“|×§×˜×’×•×¨×™×”|×ª×™××•×¨|×ž×—×™×¨)\s*[:ï¼š]\s*(.+)$/i);
          if (match) {
            const key = match[1].toUpperCase();
            const val = match[2].trim();

            if (key === "NAME" || key === "×©×") mat.name = val;
            else if (key === "CODE" || key === "×§×•×“") mat.code = val;
            else if (key === "CATEGORY" || key === "×§×˜×’×•×¨×™×”") {
              // Map to valid category
              if (val.includes("×ª×ž×¦×™") || val.toLowerCase().includes("concentrate")) mat.category = "×ª×ž×¦×™×•×ª";
              else if (val.includes("×©×ž×Ÿ") || val.toLowerCase().includes("oil")) mat.category = "×©×ž× ×™×";
              else if (val.includes("××¨×•×ž") || val.toLowerCase().includes("aroma")) mat.category = "××¨×•×ž×›×™×ž×™×§×œ×™×";
              else if (val.includes("×§×‘×•×¢") || val.toLowerCase().includes("fix")) mat.category = "×§×‘×•×¢×™×";
              else if (val.includes("×ª×•×¡×¤") || val.toLowerCase().includes("add")) mat.category = "×ª×•×¡×¤×•×ª";
              else mat.category = val;
            }
            else if (key === "DESC" || key === "×ª×™××•×¨") mat.desc = val;
            else if (key === "PRICE_KG" || key === "×ž×—×™×¨") mat.pricePerKg = parseFloat(val.replace(/[^0-9.]/g, "")) || null;
            else if (key === "PRICE_ML") mat.pricePerMl = parseFloat(val.replace(/[^0-9.]/g, "")) || null;
            else if (key === "DILUTED") mat.diluted = val.toLowerCase() === "yes" || val.toLowerCase() === "×›×Ÿ" || val === "true";
            else if (key === "DILUTION") {
              mat.dilutionPercent = parseInt(val.replace(/[^0-9]/g, "")) || null;
              if (mat.dilutionPercent) mat.diluted = true;
            }
          }
        }

        if (!mat.name) {
          errors.push(`×—×•×ž×¨ #${idx + 1}: ×—×¡×¨ ×©×`);
        } else if (!mat.category || !CATEGORIES.includes(mat.category)) {
          errors.push(`${mat.name}: ×§×˜×’×•×¨×™×” ×œ× ×ª×§×™× ×” ("${mat.category}")`);
        } else {
          parsedMaterials.push(mat);
        }
      });

      // Check for duplicates
      const existingNames = new Set(state.materials.map(m => m.name.toLowerCase()));
      const duplicates = parsedMaterials.filter(m => existingNames.has(m.name.toLowerCase()));

      // Build preview
      let html = '<div class="card" style="padding:16px">';

      if (errors.length > 0) {
        html += '<div style="background:rgba(216,67,21,0.2);padding:12px;border-radius:8px;margin-bottom:16px">';
        html += '<h4 style="color:#f87171;margin-bottom:8px">âš ï¸ ×©×’×™××•×ª:</h4>';
        html += '<ul style="margin:0;padding-right:20px">' + errors.map(e => `<li>${e}</li>`).join("") + '</ul>';
        html += '</div>';
      }

      if (duplicates.length > 0) {
        html += '<div style="background:rgba(251,191,36,0.2);padding:12px;border-radius:8px;margin-bottom:16px">';
        html += '<h4 style="color:#fbbf24;margin-bottom:8px">âš ï¸ ×›×¤×™×œ×•×™×•×ª (×™×“×•×œ×’×•):</h4>';
        html += '<ul style="margin:0;padding-right:20px">' + duplicates.map(m => `<li>${m.name}</li>`).join("") + '</ul>';
        html += '</div>';
      }

      const validMaterials = parsedMaterials.filter(m => !existingNames.has(m.name.toLowerCase()));

      if (validMaterials.length > 0) {
        html += '<h4 style="color:#34d399;margin-bottom:12px">âœ… ×—×•×ž×¨×™× ×ª×§×™× ×™× (${validMaterials.length}):</h4>';
        html += '<table style="width:100%;border-collapse:collapse;font-size:0.9rem">';
        html += '<tr style="background:rgba(0,0,0,0.2)"><th style="padding:8px;text-align:right">×©×</th><th style="padding:8px;text-align:right">×§×•×“</th><th style="padding:8px;text-align:right">×§×˜×’×•×¨×™×”</th><th style="padding:8px;text-align:right">×ª×™××•×¨</th><th style="padding:8px;text-align:right">×ž×“×•×œ×œ</th></tr>';
        validMaterials.forEach(m => {
          html += `<tr style="border-bottom:1px solid var(--line)">
            <td style="padding:8px">${m.name}</td>
            <td style="padding:8px">${m.code || "-"}</td>
            <td style="padding:8px">${m.category}</td>
            <td style="padding:8px">${m.desc || "-"}</td>
            <td style="padding:8px">${m.diluted ? m.dilutionPercent + "%" : "×œ×"}</td>
          </tr>`;
        });
        html += '</table>';

        html += '<div class="row" style="gap:12px;margin-top:16px">';
        html += '<button class="btn success" id="smartMatConfirm" style="flex:1;padding:14px;font-size:1.1rem">âœ… ×”×•×¡×£ ' + validMaterials.length + ' ×—×•×ž×¨×™×</button>';
        html += '</div>';

        preview.innerHTML = html + '</div>';

        $("smartMatConfirm").onclick = () => {
          validMaterials.forEach(m => state.materials.push(m));
          saveState();
          closeFullPage();
          render();
          alert(`âœ… × ×•×¡×¤×• ${validMaterials.length} ×—×•×ž×¨×™× ×—×“×©×™×!`);
        };
      } else {
        html += '<p style="color:#9ca3af;text-align:center;padding:20px">××™×Ÿ ×—×•×ž×¨×™× ×—×“×©×™× ×œ×”×•×¡×¤×”</p>';
        preview.innerHTML = html + '</div>';
      }

    } catch (e) {
      console.error(e);
      preview.innerHTML = '<div class="card" style="background:rgba(216,67,21,0.2);padding:16px">âŒ ×©×’×™××” ×‘× ×™×ª×•×—: ' + e.message + '</div>';
    }
  };

  // ==================== SMART IMPORT (Claude-friendly) ====================
  const showSmartImport = () => {
    openFullPage({
      title: "ðŸ¤– ×™×™×‘×•× ×—×›×",
      pill: "Claude",
      body: `
        <div style="max-width:800px;margin:0 auto">
          <div class="card" style="background:linear-gradient(135deg,rgba(102,126,234,0.2),rgba(118,75,162,0.2));margin-bottom:20px;padding:16px">
            <h3 style="color:#a78bfa;margin-bottom:12px">ðŸ“‹ ×¤×•×¨×ž×˜ ×¤×©×•×˜ ×œ×§×œ××•×“</h3>
            <p style="margin-bottom:12px">×”×¢×ª×§ ××ª ×”×¤×•×¨×ž×˜ ×”×–×” ×œ×§×œ××•×“ ×•×‘×§×© ×ž×ž× ×• ×œ×ž×œ×:</p>
            <pre style="background:rgba(0,0,0,0.3);padding:12px;border-radius:8px;font-size:0.85rem;overflow-x:auto;direction:ltr;text-align:left">
NAME: ×©× ×”×‘×•×©×
CODE: ABC123
INSPIRED: ×©× ×”×‘×•×©× ×”×ž×§×•×¨×™
QTY: 50
NOTES: ×”×¢×¨×•×ª ×›×œ×œ×™×•×ª
---
×—×•×ž×¨ ×’×œ× 1: 5ml
×—×•×ž×¨ ×’×œ× 2: 3.5ml
Bergamot 10%: 2ml
Rose Absolute: 1.5ml</pre>
          </div>

          <div class="field" style="margin-bottom:16px">
            <label style="font-size:1.1rem;margin-bottom:8px;display:block">ðŸ“ ×”×“×‘×§ ×›××Ÿ ××ª ×”×˜×§×¡×˜ ×ž×§×œ××•×“:</label>
            <textarea id="smartInput" style="width:100%;height:250px;font-family:monospace;font-size:0.9rem;direction:ltr;text-align:left" placeholder="NAME: My Perfume
CODE: P001
INSPIRED: Dior Sauvage
QTY: 50
---
Bergamot 10%: 15ml
Lavender: 8ml
Sandalwood: 5ml
DPG: 20ml"></textarea>
          </div>

          <div class="row" style="gap:12px">
            <button class="btn primary" id="smartParse" style="flex:1;padding:14px;font-size:1.1rem">ðŸ” ×”×ž×¨ ×•×‘×“×•×§</button>
            <button class="btn" id="smartCancel" style="padding:14px">×‘×™×˜×•×œ</button>
          </div>

          <div id="smartPreview" style="margin-top:20px"></div>
        </div>
      `
    });

    $("smartCancel").onclick = closeFullPage;
    $("smartParse").onclick = () => parseSmartImport($("smartInput").value);
  };

  const parseSmartImport = (text) => {
    const preview = $("smartPreview");
    if (!text.trim()) {
      preview.innerHTML = '<div class="card" style="background:rgba(216,67,21,0.2);padding:16px">âŒ ×”×˜×§×¡×˜ ×¨×™×§</div>';
      return;
    }

    try {
      const lines = text.split("\n").map(l => l.trim()).filter(l => l);
      const formula = {
        id: uid(),
        name: "",
        code: "",
        inspiredBy: "",
        qtyMl: 50,
        notes: "",
        date: todayISO(),
        updatedAt: todayISO(),
        rows: []
      };

      let inIngredients = false;
      const unmatchedIngredients = [];

      for (const line of lines) {
        // Check for separator (---, ===, ___, or empty-ish line after headers)
        if (line.match(/^[-=_]{2,}$/) || line === "") {
          inIngredients = true;
          continue;
        }

        // Try to parse as header field first
        const headerMatch = line.match(/^(NAME|CODE|INSPIRED|QTY|NOTES|×©×|×§×•×“|×‘×”×©×¨××ª|×›×ž×•×ª|×”×¢×¨×•×ª)\s*[:ï¼š]\s*(.+)$/i);
        if (headerMatch && !inIngredients) {
          const key = headerMatch[1].toUpperCase();
          const val = headerMatch[2].trim();
          if (key === "NAME" || key === "×©×") formula.name = val;
          else if (key === "CODE" || key === "×§×•×“") formula.code = val;
          else if (key === "INSPIRED" || key === "×‘×”×©×¨××ª") formula.inspiredBy = val;
          else if (key === "QTY" || key === "×›×ž×•×ª") formula.qtyMl = num(val.replace(/ml|×ž"×œ/gi, "").trim(), 50);
          else if (key === "NOTES" || key === "×”×¢×¨×•×ª") formula.notes = val;
          continue;
        }

        // Check if line looks like an ingredient (name: number with optional ml)
        const looksLikeIngredient = line.match(/^(.+?)[:ï¼š]\s*([\d.,]+)\s*(ml|×ž"×œ|g|gr)?$/i);
        if (looksLikeIngredient) {
          // This is an ingredient line - switch to ingredient mode
          inIngredients = true;
        }

        if (inIngredients) {
          // Parse ingredient line: "Material Name: 5ml" or "Material Name: 5"
          const ingMatch = line.match(/^(.+?)[:ï¼š]\s*([\d.,]+)\s*(ml|×ž"×œ)?$/i);
          if (ingMatch) {
            const ingName = ingMatch[1].trim().toLowerCase();
            const ingMl = num(ingMatch[2], 0);

            // Try to find matching material (flexible matching)
            let mat = null;

            // 1. Exact match on name or code
            mat = state.materials.find(m =>
              m.name.toLowerCase() === ingName ||
              (m.code && m.code.toLowerCase() === ingName)
            );

            // 2. Partial match - material name contains search or search contains material name
            if (!mat) {
              mat = state.materials.find(m =>
                m.name.toLowerCase().includes(ingName) ||
                ingName.includes(m.name.toLowerCase()) ||
                (m.code && (m.code.toLowerCase().includes(ingName) || ingName.includes(m.code.toLowerCase())))
              );
            }

            // 3. Word match - any word matches
            if (!mat) {
              const searchWords = ingName.split(/[\s\-_]+/).filter(w => w.length > 2);
              mat = state.materials.find(m => {
                const matWords = m.name.toLowerCase().split(/[\s\-_]+/);
                return searchWords.some(sw => matWords.some(mw => mw.includes(sw) || sw.includes(mw)));
              });
            }

            if (mat) {
              formula.rows.push({ materialId: mat.id, ml: ingMl, matchedFrom: ingMatch[1].trim() });
            } else {
              unmatchedIngredients.push({ name: ingMatch[1].trim(), ml: ingMl });
            }
          }
        }
      }

      if (!formula.name) {
        preview.innerHTML = '<div class="card" style="background:rgba(216,67,21,0.2);padding:16px">âŒ ×—×•×‘×” ×©× ×œ×¤×•×¨×ž×•×œ×” (NAME: ...)</div>';
        return;
      }

      // Show preview
      const calc = computeFormula(formula);
      let previewHtml = `
        <div class="card" style="background:rgba(124,179,66,0.15);padding:16px;margin-bottom:16px">
          <h3 style="color:var(--success);margin-bottom:12px">âœ… ×¤×•×¨×ž×•×œ×” ×–×•×”×ª×”!</h3>
          <div class="stats" style="margin-bottom:16px">
            <div class="stat"><div class="k">×©×</div><div class="v">${escapeHtml(formula.name)}</div></div>
            <div class="stat"><div class="k">×§×•×“</div><div class="v">${escapeHtml(formula.code || "â€”")}</div></div>
            <div class="stat"><div class="k">×›×ž×•×ª</div><div class="v">${formula.qtyMl} ml</div></div>
            <div class="stat"><div class="k">×¨×›×™×‘×™×</div><div class="v">${formula.rows.length}</div></div>
            <div class="stat"><div class="k">×¡×”"×›</div><div class="v">${fmt(calc.totalMl, 2)} ml (${fmt(calc.totalPct, 1)}%)</div></div>
          </div>
      `;

      if (formula.rows.length > 0) {
        previewHtml += `<div style="margin-bottom:12px"><strong>âœ… ×¨×›×™×‘×™× ×ž×–×•×”×™× (${formula.rows.length}):</strong></div><ul style="margin:0 20px 16px">`;
        formula.rows.forEach(r => {
          const m = getMaterial(r.materialId);
          const matchNote = r.matchedFrom && r.matchedFrom.toLowerCase() !== (m ? m.name.toLowerCase() : "")
            ? ` <span class="muted small">(×ž: ${escapeHtml(r.matchedFrom)})</span>`
            : "";
          previewHtml += `<li><strong>${escapeHtml(m ? m.name : "?")}</strong> - ${r.ml} ml${matchNote}</li>`;
        });
        previewHtml += `</ul>`;
      }

      if (unmatchedIngredients.length > 0) {
        previewHtml += `
          <div style="background:rgba(251,191,36,0.2);padding:12px;border-radius:8px;margin-bottom:16px">
            <strong style="color:#fbbf24">âš ï¸ ×¨×›×™×‘×™× ×œ× × ×ž×¦××• ×‘×ž××’×¨ (${unmatchedIngredients.length}):</strong>
            <ul style="margin:8px 20px 0">
              ${unmatchedIngredients.map(i => `<li>${escapeHtml(i.name)} - ${i.ml} ml</li>`).join("")}
            </ul>
            <button class="btn" id="smartCreateMaterials" style="margin-top:12px;width:100%;background:#f59e0b;border:none;color:#000">
              âž• ×¦×•×¨ ×—×•×ž×¨×™× ×—×¡×¨×™× ××•×˜×•×ž×˜×™×ª ×•×”×•×¡×£ ×œ×¤×•×¨×ž×•×œ×”
            </button>
          </div>
        `;
      }

      previewHtml += `
          <button class="btn primary" id="smartSave" style="width:100%;padding:14px;font-size:1.1rem">
            ðŸ’¾ ×©×ž×•×¨ ×œ×¤×™×ª×•×—×™× ${unmatchedIngredients.length > 0 ? "(×œ×œ× ×”×—×•×ž×¨×™× ×”×—×¡×¨×™×)" : ""}
          </button>
        </div>
      `;

      preview.innerHTML = previewHtml;

      // Button to create missing materials
      if ($("smartCreateMaterials")) {
        $("smartCreateMaterials").onclick = () => {
          unmatchedIngredients.forEach(ing => {
            const newMat = {
              id: uid(),
              name: ing.name,
              code: "",
              category: "×ª×•×¡×¤×•×ª",
              desc: "× ×•×¦×¨ ××•×˜×•×ž×˜×™×ª ×ž×™×™×‘×•× ×—×›×",
              pricePerKg: null,
              pricePerMl: null,
              diluted: false,
              dilutionPercent: null
            };
            state.materials.push(newMat);
            formula.rows.push({ materialId: newMat.id, ml: ing.ml });
          });
          saveState();
          alert("âœ… × ×•×¦×¨×• " + unmatchedIngredients.length + " ×—×•×ž×¨×™× ×—×“×©×™× ×•×”×ª×•×•×¡×¤×• ×œ×¤×•×¨×ž×•×œ×”!");
          // Re-parse to refresh preview
          parseSmartImport($("smartInput").value);
        };
      }

      $("smartSave").onclick = () => {
        state.perfumesDev.unshift(formula);
        saveState();
        closeFullPage();
        state.ui.tab = "dev";
        render();
        alert("âœ… ×”×¤×•×¨×ž×•×œ×” \"" + formula.name + "\" × ×•×¡×¤×” ×‘×”×¦×œ×—×”!");
      };

    } catch (e) {
      preview.innerHTML = '<div class="card" style="background:rgba(216,67,21,0.2);padding:16px">âŒ ×©×’×™××” ×‘×¤×¢× ×•×—: ' + escapeHtml(e.message) + '</div>';
    }
  };

  // Import formulas only (1-20)
  const importFormulas = async (file) => {
    try {
      const text = await file.text();
      const incoming = JSON.parse(text);
      
      let formulas = [];
      
      // Single formula object
      if (incoming && !Array.isArray(incoming) && (incoming.rows || incoming.name)) {
        formulas = [incoming];
      }
      // Array of formulas
      else if (Array.isArray(incoming)) {
        formulas = incoming;
      }
      // Old format with kind
      else if (incoming && incoming.kind === "enigma-dev-insert" && incoming.perfume) {
        formulas = [incoming.perfume];
      }
      else {
        alert("âŒ ×¤×•×¨×ž×˜ ×œ× ×ž×–×•×”×”.\n\n×¦×¨×™×š ×œ×”×™×•×ª:\n- ×¤×•×¨×ž×•×œ×” ×‘×•×“×“×ª {...}\n- ×ž×¢×¨×š ×¤×•×¨×ž×•×œ×•×ª [{...}, {...}]");
        return;
      }

      if (formulas.length === 0) {
        alert("âŒ ×œ× × ×ž×¦××• ×¤×•×¨×ž×•×œ×•×ª ×‘×§×•×‘×¥");
        return;
      }

      if (formulas.length > 20) {
        alert(`âŒ ×™×•×ª×¨ ×ž×“×™ ×¤×•×¨×ž×•×œ×•×ª (${formulas.length})!\n\n×ž×§×¡×™×ž×•× 20 ×¤×•×¨×ž×•×œ×•×ª ×‘×™×™×‘×•× ××—×“.\n×œ×›×ž×•×ª ×’×“×•×œ×” ×™×•×ª×¨ ×”×©×ª×ž×© ×‘"×™×™×‘×•× ×ž×œ×".`);
        return;
      }

      const existingIds = new Set(state.materials.map(m => m.id));
      let addedCount = 0;
      let missingMaterials = [];

      formulas.forEach(pp => {
        const newPerf = {
          id: uid(),
          name: String(pp.name || "").trim() || "Unnamed",
          code: String(pp.code || "").trim(),
          inspiredBy: String(pp.inspiredBy || "").trim(),
          notes: String(pp.notes || "").trim(),
          date: pp.date || todayISO(),
          updatedAt: todayISO(),
          qtyMl: clamp(num(pp.qtyMl, state.defaultQty), 0, 100000),
          rows: Array.isArray(pp.rows) ? pp.rows.map(r => ({
            id: uid(),
            materialId: String(r.materialId || "").trim(),
            ml: clamp(num(r.ml, 0), 0, 100000),
            catHint: r.catHint || r.category || null
          })) : [],
          marketingText: String(pp.marketingText || "").trim(),
          notesTop: String(pp.notesTop || "").trim(),
          notesHeart: String(pp.notesHeart || "").trim(),
          notesBase: String(pp.notesBase || "").trim()
        };

        // Check for missing materials (but don't create them!)
        newPerf.rows.forEach(r => {
          if (r.materialId && !existingIds.has(r.materialId)) {
            missingMaterials.push(r.materialId);
          }
        });

        state.perfumesDev.unshift(newPerf);
        addedCount++;
      });

      saveState();
      render();
      
      let msg = `âœ… × ×•×¡×¤×• ${addedCount} ×¤×•×¨×ž×•×œ×•×ª ×œ×¤×™×ª×•×—×™×!`;
      if (missingMaterials.length > 0) {
        msg += `\n\nâš ï¸ ×©×™× ×œ×‘: ${missingMaterials.length} ×—×•×ž×¨×™× ×œ× × ×ž×¦××• ×‘×ž×œ××™:\n${[...new Set(missingMaterials)].slice(0,5).join(", ")}${missingMaterials.length > 5 ? "..." : ""}`;
      }
      alert(msg);
    } catch (e) {
      console.error(e);
      alert("âŒ ×©×’×™××” ×‘×™×™×‘×•×: " + e.message);
    }
  };

  // Import materials only (adds new, doesn't overwrite)
  const importMaterials = async (file) => {
    try {
      const text = await file.text();
      const incoming = JSON.parse(text);
      
      let materials = [];
      
      // Array of materials
      if (Array.isArray(incoming)) {
        materials = incoming;
      }
      // Full backup - extract materials
      else if (incoming && Array.isArray(incoming.materials)) {
        materials = incoming.materials;
      }
      else {
        alert("âŒ ×¤×•×¨×ž×˜ ×œ× ×ž×–×•×”×”.\n\n×¦×¨×™×š ×œ×”×™×•×ª ×ž×¢×¨×š ×—×•×ž×¨×™× ××• ×§×•×‘×¥ ×’×™×‘×•×™ ×ž×œ×.");
        return;
      }

      if (materials.length === 0) {
        alert("âŒ ×œ× × ×ž×¦××• ×—×•×ž×¨×™× ×‘×§×•×‘×¥");
        return;
      }

      const existingIds = new Set(state.materials.map(m => m.id));
      const existingNames = new Set(state.materials.map(m => m.name.toLowerCase()));
      let addedCount = 0;
      let skippedCount = 0;

      materials.forEach(m => {
        const id = String(m.id || uid());
        const name = String(m.name || "").trim();
        
        // Skip if ID or name already exists
        if (existingIds.has(id) || existingNames.has(name.toLowerCase())) {
          skippedCount++;
          return;
        }

        state.materials.push({
          id: id,
          name: name || "Unnamed",
          code: String(m.code || "").trim(),
          category: CATEGORIES.includes(m.category) ? m.category : "×ª×ž×¦×™×•×ª",
          desc: String(m.desc || "").trim(),
          pricePerKg: (m.pricePerKg === null || m.pricePerKg === undefined || m.pricePerKg === "") ? null : num(m.pricePerKg),
          pricePerMl: (m.pricePerMl === null || m.pricePerMl === undefined || m.pricePerMl === "") ? null : num(m.pricePerMl),
          diluted: !!m.diluted,
          dilutionPercent: m.diluted ? clamp(num(m.dilutionPercent, 50), 0, 100) : null
        });
        existingIds.add(id);
        existingNames.add(name.toLowerCase());
        addedCount++;
      });

      saveState();
      render();
      alert(`âœ… × ×•×¡×¤×• ${addedCount} ×—×•×ž×¨×™× ×—×“×©×™×!\n${skippedCount > 0 ? `(${skippedCount} ×“×•×œ×’×• - ×›×‘×¨ ×§×™×™×ž×™×)` : ""}`);
    } catch (e) {
      console.error(e);
      alert("âŒ ×©×’×™××” ×‘×™×™×‘×•×: " + e.message);
    }
  };

  // Full import (replaces everything)
  const importJSON = async (file) => {
    try {
      const text = await file.text();
      const incoming = JSON.parse(text);

      // Verify it's a full backup
      if (!incoming.materials && !incoming.perfumesDev && !incoming.perfumesFinal) {
        alert("âŒ ×–×” ×œ× × ×¨××” ×›×ž×• ×§×•×‘×¥ ×’×™×‘×•×™ ×ž×œ×.\n\n×œ×™×™×‘×•× ×¤×•×¨×ž×•×œ×•×ª ×‘×œ×‘×“ ×”×©×ª×ž×© ×‘'×”×•×¡×£ ×¤×•×¨×ž×•×œ×•×ª'.");
        return;
      }

      if (!confirm("âš ï¸ ××–×”×¨×”!\n\n×¤×¢×•×œ×” ×–×• ×ª×ž×—×§ ××ª ×›×œ ×”× ×ª×•× ×™× ×”×§×™×™×ž×™× ×•×ª×—×œ×™×£ ××•×ª× ×‘×ª×•×›×Ÿ ×”×§×•×‘×¥.\n\n×¤×¢×•×œ×” ×–×• ×‘×œ×ª×™ ×”×¤×™×›×”!\n\n×œ×”×ž×©×™×š?")) return;
      if (!confirm("ðŸ”´ ××™×©×•×¨ ×¡×•×¤×™\n\n×›×œ ×”×¤×•×¨×ž×•×œ×•×ª, ×—×•×ž×¨×™ ×”×’×œ× ×•×”×”×’×“×¨×•×ª ×™×™×ž×—×§×•.\n\n×‘××ž×ª ×œ×”×ž×©×™×š?")) return;

      const next = defaultState();
      // Map old field names to new ones
      const incomingUI = incoming.ui || {};
      next.ui = {
        ...next.ui,
        tab: incomingUI.tab || "materials",
        showCodes: incomingUI.showCodes ?? incomingUI.showEssenceCodes ?? false,
        hideEssences: incomingUI.hideEssences ?? false,
        hideInspired: incomingUI.hideInspired ?? false,
        hidePrices: incomingUI.hidePrices ?? false,
        debugMode: incomingUI.debugMode ?? false,
        sortMaterials: incomingUI.sortMaterials || "new",
        sortDev: incomingUI.sortDev || "new",
        sortFinal: incomingUI.sortFinal || "new"
      };
      next.defaultQty = num(incoming.defaultQty ?? incoming._defaultQty, 50);

      if (Array.isArray(incoming.materials)) {
        next.materials = incoming.materials.map(m => ({
          id: String(m.id || uid()),
          name: String(m.name || "").trim() || "Unnamed",
          code: String(m.code || "").trim(),
          category: CATEGORIES.includes(m.category) ? m.category : "×ª×ž×¦×™×•×ª",
          desc: String(m.desc || "").trim(),
          pricePerKg: (m.pricePerKg === null || m.pricePerKg === undefined || m.pricePerKg === "") ? null : num(m.pricePerKg),
          pricePerMl: (m.pricePerMl === null || m.pricePerMl === undefined || m.pricePerMl === "") ? null : num(m.pricePerMl),
          diluted: !!m.diluted,
          dilutionPercent: m.diluted ? clamp(num(m.dilutionPercent, 50), 0, 100) : null
        }));
      }

      // Ensure DPG exists
      if (!next.materials.find(m => m.id === "MAT_DPG")) {
        next.materials.unshift({ id: "MAT_DPG", name: "DPG", code: "DPG", category: "×§×‘×•×¢×™×", desc: "Dipropylene Glycol", pricePerKg: null, pricePerMl: null, diluted: false, dilutionPercent: null });
      }
      // Ensure Citrofol F exists
      if (!next.materials.find(m => m.id === "MAT_CIT")) {
        next.materials.unshift({ id: "MAT_CIT", name: "Citrofol F", code: "CIT", category: "×§×‘×•×¢×™×", desc: "Triethyl Citrate", pricePerKg: null, pricePerMl: null, diluted: false, dilutionPercent: null });
      }

      const ingestPerf = (arr) => (Array.isArray(arr) ? arr : []).map(p => ({
        id: p.id || uid(),
        name: String(p.name || "").trim() || "Unnamed",
        code: String(p.code || "").trim(),
        inspiredBy: String(p.inspiredBy || "").trim(),
        notes: String(p.notes || "").trim(),
        date: p.date || todayISO(),
        updatedAt: p.updatedAt || todayISO(),
        qtyMl: clamp(num(p.qtyMl, next.defaultQty), 0, 100000),
        rows: Array.isArray(p.rows) ? p.rows.map(r => ({
          id: r.id || uid(),
          materialId: String(r.materialId || "").trim(),
          ml: clamp(num(r.ml, 0), 0, 100000),
          catHint: r.catHint || null
        })) : [],
        marketingText: String(p.marketingText || "").trim(),
        notesTop: String(p.notesTop || "").trim(),
        notesHeart: String(p.notesHeart || "").trim(),
        notesBase: String(p.notesBase || "").trim()
      }));

      next.perfumesDev = ingestPerf(incoming.perfumesDev);
      next.perfumesFinal = ingestPerf(incoming.perfumesFinal);

      state = next;
      saveState();
      render();
      alert(`âœ… ×™×™×‘×•× ×ž×œ× ×”×•×©×œ×!\n\n×—×•×ž×¨×™×: ${state.materials.length}\n×¤×™×ª×•×—×™×: ${state.perfumesDev.length}\n×¡×•×¤×™×™×: ${state.perfumesFinal.length}`);
    } catch (e) {
      console.error(e);
      alert("âŒ ×©×’×™××” ×‘×™×™×‘×•×: " + e.message);
    }
  };

  // ==================== TABS & RENDER ====================
  const tabs = $("tabs");
  tabs.querySelectorAll(".tab").forEach(t => {
    t.onclick = () => {
      state.ui.tab = t.getAttribute("data-tab");
      saveState();
      render();
    };
  });

  const setActiveTab = () => {
    tabs.querySelectorAll(".tab").forEach(t => {
      const tabName = t.getAttribute("data-tab");
      // Hide tabs guest can't see
      if (!isAdmin()) {
        if (tabName === "settings" || !canView(tabName)) {
          t.style.display = "none";
        } else {
          t.style.display = "";
        }
      } else {
        t.style.display = "";
      }
      t.classList.toggle("active", tabName === state.ui.tab);
    });
  };

  const render = () => {
    if (!isLoggedIn()) return; // Don't render if not logged in
    
    setActiveTab();
    updateUserBadge();
    
    // Hide admin-only buttons for guest
    const adminOnly = ["btnExport", "btnImportMenu", "btnSaveCloud", "btnLoadCloud"];
    adminOnly.forEach(id => {
      const el = $(id);
      if (el) el.style.display = isAdmin() ? "" : "none";
    });
    
    $("leftPanel").innerHTML = "";
    $("rightPanel").innerHTML = "";

    const tab = state.ui.tab;
    
    // Check permissions
    if (!canView(tab) && tab !== "settings") {
      // Redirect to first allowed tab
      if (canView("dev")) { state.ui.tab = "dev"; render(); return; }
      if (canView("final")) { state.ui.tab = "final"; render(); return; }
      if (canView("materials")) { state.ui.tab = "materials"; render(); return; }
      if (canView("pricing")) { state.ui.tab = "pricing"; render(); return; }
      $("leftPanel").innerHTML = "<p class='muted'>××™×Ÿ ×œ×š ×”×¨×©××•×ª ×¦×¤×™×™×”</p>";
      return;
    }
    
    if (tab === "materials") renderMaterials();
    else if (tab === "dev") renderPerfumes("dev");
    else if (tab === "final") renderPerfumes("final");
    else if (tab === "pricing") renderPricing();
    else if (tab === "wizard") renderWizard();
    else if (tab === "candle") renderCandle();
    else if (tab === "aibuilder") renderAIBuilder();
    else if (tab === "settings") renderSettings();
    else renderMaterials();
  };

  // ==================== INIT ====================
  $("btnExport").onclick = exportJSON;
  $("btnImportMenu").onclick = showImportMenu;
  $("importFile").onchange = async (e) => {
    const file = e.target.files && e.target.files[0];
    if (file) await importJSON(file);
    $("importFile").value = "";
  };
  $("importFormulasFile").onchange = async (e) => {
    const file = e.target.files && e.target.files[0];
    if (file) await importFormulas(file);
    $("importFormulasFile").value = "";
  };
  $("importMaterialsFile").onchange = async (e) => {
    const file = e.target.files && e.target.files[0];
    if (file) await importMaterials(file);
    $("importMaterialsFile").value = "";
  };
  
  // Save to cloud button
  $("btnSaveCloud").onclick = async () => {
    if (!firebaseReady) {
      alert("×ž×ª×—×‘×¨ ×œ×¢× ×Ÿ...");
      await initFirebase();
      if (!firebaseReady) {
        alert("âŒ ×œ× × ×™×ª×Ÿ ×œ×”×ª×—×‘×¨ ×œ×¢× ×Ÿ.\n×‘×“×•×§ ×—×™×‘×•×¨ ××™× ×˜×¨× ×˜.");
        return;
      }
    }
    
    if (!confirm("â˜ï¸â†‘ ×©×ž×•×¨ ×œ×¢× ×Ÿ\n\n×”× ×ª×•× ×™× ×”×ž×§×•×ž×™×™× ×™×¢×œ×• ×œ×¢× ×Ÿ ×•×™×—×œ×™×¤×• ××ª ×ž×” ×©×™×© ×©×.\n\n×œ×”×ž×©×™×š?")) return;
    
    const success = await saveToCloud();
    if (success) {
      alert("âœ… × ×©×ž×¨ ×œ×¢× ×Ÿ!\n\n×—×•×ž×¨×™×: " + state.materials.length + "\n×¤×™×ª×•×—×™×: " + state.perfumesDev.length);
    } else {
      alert("âŒ ×©×’×™××” ×‘×©×ž×™×¨×” ×œ×¢× ×Ÿ");
    }
  };
  
  // Load from cloud button
  $("btnLoadCloud").onclick = async () => {
    if (!firebaseReady) {
      alert("×ž×ª×—×‘×¨ ×œ×¢× ×Ÿ...");
      await initFirebase();
      if (!firebaseReady) {
        alert("âŒ ×œ× × ×™×ª×Ÿ ×œ×”×ª×—×‘×¨ ×œ×¢× ×Ÿ.\n×‘×“×•×§ ×—×™×‘×•×¨ ××™× ×˜×¨× ×˜.");
        return;
      }
    }
    
    if (!confirm("â˜ï¸â†“ ×˜×¢×Ÿ ×ž×¢× ×Ÿ\n\nâš ï¸ ×”× ×ª×•× ×™× ×”×ž×§×•×ž×™×™× ×™×™×ž×—×§×• ×•×™×•×—×œ×¤×• ×‘× ×ª×•× ×™× ×ž×”×¢× ×Ÿ!\n\n×œ×”×ž×©×™×š?")) return;
    
    const success = await loadFromCloud();
    render();
    if (success) {
      alert("âœ… × ×˜×¢×Ÿ ×ž×”×¢× ×Ÿ!\n\n×—×•×ž×¨×™×: " + state.materials.length + "\n×¤×™×ª×•×—×™×: " + state.perfumesDev.length);
    } else {
      alert("âŒ ×©×’×™××” ×‘×˜×¢×™× ×” ×ž×”×¢× ×Ÿ");
    }
  };

  // Logout button
  $("btnLogout").onclick = () => {
    if (confirm("×œ×”×ª× ×ª×§?")) logout();
  };

  // Login form handlers
  const loginBtn = $("loginBtn");
  const loginUser = $("loginUser");
  const loginPass = $("loginPass");
  const loginError = $("loginError");

  if (loginBtn) {
    loginBtn.onclick = () => {
      const user = loginUser.value.trim();
      const pass = loginPass.value;
      
      if (!user || !pass) {
        loginError.textContent = "× × ×œ×”×–×™×Ÿ ×©× ×ž×©×ª×ž×© ×•×¡×™×¡×ž×”";
        return;
      }
      
      if (login(user, pass)) {
        hideLoginScreen();
      } else {
        loginError.textContent = "âŒ ×©× ×ž×©×ª×ž×© ××• ×¡×™×¡×ž×” ×©×’×•×™×™×";
        loginPass.value = "";
        loginPass.focus();
      }
    };
  }

  if (loginPass) {
    loginPass.onkeydown = (e) => {
      if (e.key === "Enter") loginBtn.click();
    };
  }
  
  if (loginUser) {
    loginUser.onkeydown = (e) => {
      if (e.key === "Enter") loginPass.focus();
    };
  }

  // Initialize Firebase and show login
  initFirebase().then(() => {
    // Keep login screen visible until user logs in
  });

  // Don't render until logged in - show login screen
  // render() will be called after successful login
})();
</script>
</body>
</html>
